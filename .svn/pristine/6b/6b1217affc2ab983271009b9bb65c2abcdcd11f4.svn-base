function cancelTap(){tapValid=!1}function cancelHold(){rightClickPending&&(window.clearTimeout(holdTimeout),rightClickPending=!1,rightClickEvent=null)}function startHold(t){rightClickPending||(rightClickPending=!0,rightClickEvent=t.changedTouches[0],holdTimeout=window.setTimeout("doRightClick();",800))}function doRightClick(){rightClickPending=!1;var t=rightClickEvent,e=document.createEvent("MouseEvent");e.initMouseEvent("mouseup",!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(e),e=document.createEvent("MouseEvent"),e.initMouseEvent("mousedown",!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,2,null),t.target.dispatchEvent(e),e=document.createEvent("MouseEvent"),e.initMouseEvent("contextmenu",!0,!0,window,1,t.screenX+50,t.screenY+5,t.clientX+50,t.clientY+5,!1,!1,!1,!1,2,null),t.target.dispatchEvent(e),cancelMouseUp=!0,rightClickEvent=null}function iPadTouchStart(t){var e=t.changedTouches,i=e[0],n="mouseover",a=document.createEvent("MouseEvent");a.initMouseEvent(n,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(a),n="mousedown",a=document.createEvent("MouseEvent"),a.initMouseEvent(n,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(a),tapValid?(window.clearTimeout(tapTimeout),i.target==lastTap?(lastTap=null,tapValid=!1,n="click",a=document.createEvent("MouseEvent"),a.initMouseEvent(n,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(a),n="dblclick",a=document.createEvent("MouseEvent"),a.initMouseEvent(n,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(a)):(lastTap=i.target,tapValid=!0,tapTimeout=window.setTimeout("cancelTap();",600),startHold(t))):(lastTap=i.target,tapValid=!0,tapTimeout=window.setTimeout("cancelTap();",600),startHold(t))}function iPadTouchHandler(t){var e="",i=0;if(!(t.touches.length>1)){switch(t.type){case"touchstart":if($(t.changedTouches[0].target).is("select"))return;return iPadTouchStart(t),t.preventDefault(),!1;case"touchmove":cancelHold(),e="mousemove",t.preventDefault();break;case"touchend":if(cancelMouseUp)return cancelMouseUp=!1,t.preventDefault(),!1;cancelHold(),e="mouseup";break;default:return}var n=t.changedTouches,a=n[0],s=document.createEvent("MouseEvent");s.initMouseEvent(e,!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,i,null),a.target.dispatchEvent(s),"mouseup"==e&&tapValid&&a.target==lastTap&&(s=document.createEvent("MouseEvent"),s.initMouseEvent("click",!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,i,null),a.target.dispatchEvent(s))}}function t(t,e){var i;if(e&&void 0!=e.count&&(i=0==e.count?$.i18n.map[t+".zero"]||$.i18n.map[t+".other"]:1==e.count?$.i18n.map[t+".one"]:$.i18n.map[t+".other"]),i||(i=$.i18n.map[t]),i&&e){var n=/(\b|_|\.)html$/,a=!n.test(t);i=interp(i,e,a)}return i||t}function interp(t,e,i){return t.replace(/%{(.+?)}/g,function(t,n){return void 0!=e[n]?i&&_.escape(e[n])||e[n]:"%{"+_.escape(n)+"}"})}function l(e,i){i=i||"default";var n=t("date.formats."+i);return n=n.replace("%a",l_wday(e,!0)),n=n.replace("%A",l_wday(e)),n=n.replace("%b",l_month(e,!0)),n=n.replace("%B",l_month(e)),n=n.replace("%d",("0"+e.getDate()).substr(-2,2)),n=n.replace("%-d",e.getDate()),n=n.replace(/%[-_]?e/,e.getDate()),n=n.replace("%Y",e.getFullYear()),n=n.replace("%m",("0"+(e.getMonth()+1)).substr(-2,2)),n=n.replace("%-m",e.getMonth()+1)}function l_month(e,i){return t(i?"date.abbr_month_names."+(e.getMonth()+1):"date.month_names."+(e.getMonth()+1))}function l_wday(e,i){return t(i?"date.abbr_day_names."+e.getDay():"date.day_names."+e.getDay())}function gaTrackEvent(t,e,i,n){MyASICS.Utils.requestFromChina||_gaq.push(["_trackEvent",t,e,i,n])}function gaOriginalTrackEvent(t,e,i,n){MyASICS.Utils.requestFromChina||_gaq.push(["original._trackEvent",t,e,i,n])}function gaTrackPageview(t,e){if(e){if(!MyASICS.Utils.requestFromChina)try{_gat._getTrackerByName()._trackPageview(t)}catch(i){}document.location=e.href}else MyASICS.Utils.requestFromChina||_gaq.push(["_trackPageview",t]);return!0}function gearAutocomplete(t,e,i,n,a,s){var r=function(i){i&&(t.val(i.value),e.data("item",i),e.val(i.id))},o=function(){e.removeData("item"),e.val("")};t.autocomplete({source:function(t,e){var i={name:t.term};n&&(i.gender=n),$.ajax({url:MyASICS.Products.Route,data:i,success:function(t){e($.map(t.products,function(t){return{id:t.id,value:t.name,thumb:t.image_urls.icon}}))}})},minLength:2,delay:0,search:function(e,i){var n=t.data("autocomplete");n.options.delay=200,n.enableRefresh=!0,o()},select:function(i,n){13==i.which&&$(i.currentTarget).addClass("js-enter-from-autocomplete-menu"),r(n.item),"undefined"!=typeof a&&a(t,e)},change:function(){if(e){var n=e.data("item");n&&$(this).val()!==n.value&&o()}i&&$.trim(t.val())&&i.hide()},close:function(){t.data("autocomplete").options.delay=0}});var l=t.data("autocomplete");l.enableRefresh=!0,l.menu.options.focus=function(e,i){var n=i.item.data("item.autocomplete");/^key/.test(e.originalEvent.type)&&(l.enableRefresh=!1,t.val(n.value))},l.menu.options.blur=function(t,e){l.enableRefresh=!0},l._renderItem=function(n,s){var o=$('<a class="ui-autocomplete-gear"/>').data("item",s).text(s.value),l=$('<img style="width:70px;" />').attr("src",s.thumb),h=$("<li/>").data("item.autocomplete",s);n.append(h.append(o.prepend(l))),i&&h.click(function(){r(s),i.click(),"undefined"!=typeof a&&a(t,e)})},l._suggest=function(t){if(l.enableRefresh){var e=this.menu.element.empty().zIndex(1e3);this._renderMenu(e,t),this.menu.deactivate(),this.menu.refresh();var i=_.max(e.find("a").map(function(t,e){return $(e).text().length})),n=e.width("").width()+1,a=85+10*i;e.width(Math.max(n,a)),this.menu.element.show().position({my:"left top",at:"left bottom",of:this.element,collision:"none"})}},gearAutocomplete._move||(gearAutocomplete._move=l._move),l._move=function(t,e){gearAutocomplete._move.call(this,t,e),r($("#ui-active-menuitem").data("item"))},t.keydown(function(t){var e=$.ui.keyCode;switch(t.keyCode){case e.ESCAPE:o(),t.stopPropagation();break;case e.ENTER:case e.NUMPAD_ENTER:l.close(),t.preventDefault(),t.stopPropagation()}}),"undefined"==typeof s&&smart_button(i,t)}function smart_button(t,e){var i=function(){$.trim(e.val())?t.show():t.hide()};e.keyup(i).change(i).mouseover(i).bind("paste",function(){setTimeout(i,0)})}function setupRunOrRest(){$(".ranCon").click(function(){$(".routeSwitch").addClass("rIran").removeClass("rRest"),$(".rRestContent").hide(),$(".rIranContent").show(),$("#run_rest").val("0"),$(".post-message-content").show(),$(".js-share-run-bar-connected input[type='checkbox']").attr("disabled",!1).trigger("change")}),$(".restedCon").click(function(){$(".routeSwitch").removeClass("rIran").addClass("rRest"),$(".rIranContent").hide(),$(".rRestContent").show(),$("#run_rest").val("1"),$("#dropdownbox .js-share-run-bar-connected input[type='checkbox']").attr("checked",!1).trigger("change").attr("disabled",!0),$("#dropdownbox .post-message-content").hide().find("textarea").val("")});var t=$("#run_rest").val();("true"==t||"1"==t)&&$(".restedCon").trigger("click")}function setupSliders(){$(".sliderTipBottom").each(function(){var t=$(this).find("input").val();""!==t?$(this).find("a.score_"+t).addClass("current"):$(this).find("a").removeClass("current")}),$(".sliderTipBottom a").click(function(){var t=$(this).closest(".sliderTipBottom"),e=$("#"+t.attr("data-score-for")),i=$(this).attr("data-value"),n=e.val();i==n?($(this).toggleClass("current"),$(this).hasClass("current")?e.val(i):e.val("")):(t.find("a").removeClass("current"),$(this).addClass("current"),e.val(i))})}function setupFormInteraction(){setupSliders();$(".calcCon").click(function(){$(".calcShow").show()}),$(".moreDetails").click(function(){var t=$("#run_detail");"false"==t.val()?(showDetails(),t.val("true")):(hideDetails(),t.val("false"))}),$(".logarunTips").length>0&&showNotice("logarunTips"),$(".logarunTips a").click(function(){$(".logarunTips").hide()}),$(".calcShow .closeBtn").click(function(){$(".calcShow").hide()}),$(".selectDate").click(function(){$(".selectYPContent").hide(),$(".route").show(),$(".date li").removeClass("selected"),$(this).parent().addClass("selected")}),$(".selectYourPlan").click(function(){$(".selectYPContent").show(),$(".route").hide(),$(".selectYPContent .sypT span").center(),$(".date li").removeClass("selected"),$(this).parent().addClass("selected")}),$(".sliderPop a").click(function(){$(this).parent().parent().find("a").removeClass("current"),$(this).addClass("current")}),$(".larSelectaDate").datepicker("option","maxDate","today")}function showNotice(t){var e=$("."+t);e.show(),setTimeout(function(){$("."+t).hide()},1e4)}function toggleInjuryStateRadioStyle(){$(".iInjured input:first").attr("checked")?($(".iInjured input:first").parents("li").addClass("selected"),$(".iInjured input:last").parents("li").removeClass("selected")):($(".iInjured input:last").parents("li").addClass("selected"),$(".iInjured input:first").parents("li").removeClass("selected"))}function setupInjuryFields(){var t=function(){$(".iInjured input:last").attr("checked")?($("#run_injury_location, #run_injury_amount").show(),toggleInjuryStateRadioStyle()):($("#run_injury_location, #run_injury_amount").hide(),toggleInjuryStateRadioStyle())};$(".iInjured input").change(t),t()}function showDetails(){$(".moreDetailsShow").show(),$(".moreDetails").addClass("moreDetailsOpen"),$(".moreDetails").children(".more").hide(),$(".moreDetails").children(".less").show(),$(".simpleOption .rEditActionM").hide(),switchFbMessage(!0),$(".moreDetails").data("event-name","running:new:show detail")}function hideDetails(){$(".moreDetailsShow").hide(),$(".moreDetails").removeClass("moreDetailsOpen"),$(".moreDetails").children(".more").show(),$(".moreDetails").children(".less").hide(),$(".simpleOption .rEditActionM").show(),switchFbMessage(!1),$(".moreDetails").data("event-name","running:new:hide detail")}function switchFbMessage(t){$(".pRelative").css("height","auto"),t?$("#sharing-message").addClass("below"):$("#sharing-message").hasClass("below")&&$("#sharing-message").removeClass("below")}function setupDetailFields(){var t=$("#run_detail"),e="true"===t.val(),i=$(".moreDetailsShow .error_messages").length>0;e||i?(showDetails(),t.val("true")):(hideDetails(),t.val("false"))}function setupPace(t,e,i,n){var a=$(t),s=function(){var t=$(e).val(),s=MyASICS.Utils.delocalizeDecimal(a.val());if(""!=t&&""!=s){var r=extractComponents(t);r=3600*r[0]+60*r[1]+r[2];var o=r/(1*s);o!=1/0&&o>0&&(o=[Math.floor(o/60),Math.round(o%60)],$(i).val(formatComponents(o))),n&&$(n).trigger("paceChanged"),$(i).change()}};a.change(s),$("#calculatorInputs .placeholderInput").trigger("placeholder.update"),$(e).bind("timeChanged",s),$(i).hasClass("set")||s()}function setupLapControls(){$(".logLapEventControl").click(function(){var t=$(this).parents(".logLapEventBox");t.find(".logLapEventContent").toggle(),t.removeClass("logLapOpen"),t.find(".logLapEventContent").is(":visible")&&t.addClass("logLapOpen"),$(".logLapEventBox").css("min-height",""),$(".logLapContent").is(":visible")&&$(".logEventContent").is(":visible")&&$(".logLapEventBox").setEqualHeight()}),$(".logLap .error_messages").size()&&$("#logLapCon").click()}function setupLaps(){$(".lap-fields dd .delete").live("click",function(t){t.preventDefault(),0!=$(this).siblings(".id_field").length?($(this).siblings(".destroy_field").val("1"),$(this).closest("dd").addClass("mark-delete")):$(this).closest("dd").remove(),renumberLaps(),1==$(".lap-fields dd:not('.mark-delete')").length?$(".lap-fields .delete").hide():$(".lap-fields .delete").show()}),$(".lap-fields dd .add").live("click",function(t){t.preventDefault(),addLap(this),$(".lap-fields dd .delete").show()}),$(".lap-fields dd").live("mouseenter",function(){$(this).addClass("hover")}).live("mouseleave",function(){$(this).removeClass("hover")}),$(".lap-fields .pace_field").live("change",function(){$(this).addClass("set")})}function addLap(t){var e=$(t).closest("dd"),i=e.html(),n=$("<dd class='lap-fields' />");n.html(i);var a=n.find("input[class='distance_units_field']").val();n.find("input").val(""),n.find("input[class='distance_units_field']").val(a),n.find(".error").removeClass("error"),n.find(".inline-errors").remove(),e.after(n),renumberLaps()}function _renumberInputs(t,e){t=$(t);var i=t.attr("name");i=i.replace(/\[\d+\]/,"[]"),t.attr("name",i);var n=t.attr("id");n=n.replace(/_\d+_/,"_"+e+"_"),t.attr("id",n)}function renumberLaps(){$(".lap-fields .time_field, .lap-fields .di").unbind(),$(".lap-fields dd").each(function(t){var e=$(this).hasClass("mark-delete")?"":t;$(this).find(".order_field").val(e),$(this).find("input").each(function(){_renumberInputs(this,t)}),$(this).find("a").each(function(){$(this).data("event-source","lap "+t)}),setupPace("#run_laps_attributes_"+t+"_distance","#run_laps_attributes_"+t+"_time","#run_laps_attributes_"+t+"_pace")})}function setupPlanSlider(){var t=604800;$("#planSlider").easySlider({prevId:"logPlanPrev",prevText:"",nextId:"logPlanNext",nextText:"",orientation:"horizontal",continuous:!1,eventDriven:!0,controlsFade:!1,autoWidthSetting:!0});var e=function(e,i,n){var a=1*e.data("selected-date")+i,s=1*e.data("min-loaded-date"),r=1*e.data("max-loaded-date"),o=1*e.data("plan-start-date"),l=1*e.data("next-week-end-date");return o>a||a>l?!1:(o>a-t?$("#logPlanPrev").hide():$("#logPlanPrev").show(),a+t>l?$("#logPlanNext").hide():$("#logPlanNext").show(),e.trigger("easySlider.lock"),a>r||s>a?$.get("/my/running/planned_runs?date="+a,function(t){a>r?e.find("ul").append(t):(e.trigger("easySlider.insertedItem"),e.find("ul").prepend(t)),s>a&&e.data("min-loaded-date",a),a>r&&e.data("max-loaded-date",a),e.trigger(n)}):e.trigger(n),e.data("selected-date",a),a)};$("#planSlider").bind("easySlider.nextClicked",function(){e($(this),t,"easySlider.next")}),$("#planSlider").bind("easySlider.prevClicked",function(){e($(this),-t,"easySlider.prev")})}function setupGearFields(t,e){var i=$("#add-gear span").html();$(".add_gear_action").click(function(){var n=$("#add-gear input");if(n[1]){var a=$(n[0]),s=$(n[1]);n.each(function(){var t=$(this);t.attr("name",t.data("name"))}),a.hide();var r=$('<a class="radiusAll gearOptionButton selected" />').text(" "+a.val()).append(n),o=s.data("item");o&&o.thumb&&r.prepend($('<img class="gearThumb" />').attr("src",o.thumb)),$('<li class="gearNameList" />').insertBefore($("#add-gear")).append(r),a.autocomplete("destroy"),n=$("#add-gear span").html(i).find("input"),a=$(n[0]).val(""),s=$(n[1]).val(""),t&&gearAutocomplete(a,s,$(this),e),a.focus()}}).hide(),t&&gearAutocomplete($("#add-gear input:nth(0)"),$("#add-gear input:nth(1)"),$(".add_gear_action"),e),smart_button($(".add_gear_action"),$("#add-gear input:nth(0)"))}function setupGearOptionButton(){$(".gearOptionButton").die("click").live("click",function(t){$(this).hasClass("unselected")||!$(this).hasClass("selected")?($(this).removeClass("unselected").addClass("selected"),$(this).find("input").each(function(){$(this).attr("name",$(this).data("name"))})):$(this).hasClass("selected")&&($(this).removeClass("selected").addClass("unselected"),$(this).find("input").each(function(){$(this).attr("name","")}))}),$(".addSuggestedGear").click(function(){var t=$(this).data(),e=t.productId;if(0==$(".gear_list input[data-name='run[gear_attributes][][product_id]'][value="+e+"]").length){var i=t.productName,n=t.productImgSmall,a=$('#add-gear input[data-name="run[gear_attributes][][product_id]"]'),s={name:i,thumb:n},r=$('#add-gear input[data-name="run[gear_attributes][][name]"]');r.val(i),a.data("item",s),a.val(e),$(".add_gear_action").trigger("click")}$(this).closest("li").find(".suggestedGear").tooltip().hide()}),$(".suggestedGear").tooltip({relative:!0,events:{def:"click,blur"},onBeforeShow:function(t,e){$(".suggestedGear").each(function(){$(this).tooltip().hide()}),smart_tooltip_arrow(t,e,$(".tooltip-arrow"),4).show()},onHide:function(){0==$(".promotedGearDetails:visible").length&&$(".tooltip-arrow").hide()}})}function setupEventTracking(){$("form.run button.rEditActionM").click(function(){var t=$(this).data("hasPlan")?"has_plan":"has_no_plan";gaOriginalTrackEvent("engagement","log_a_run",t)})}function runningLogForm(){setupInjuryFields(),setupRunOrRest(),setupPace(".rIranContent #run_distance",".rIranContent #run_time_in_seconds",".rIranContent #run_pace"),MyASICS.Utils.activateTimePaceFields(),setupPlanSlider(),setupLapControls(),renumberLaps(),setupFormInteraction(),setupDetailFields(),setupEventTracking()}function formatHmsElement(t){return"00"===t||isNaN(t)||!isFinite(t)?"00":parseInt(t)<10?"0"+t:t}function messageEdited(){return $("body").data("sharedRunView").messageEdited}!function(t){var e=function(e){var i=t(".jqTransformSelectWrapper ul:visible");i.each(function(){var i=t(this).parents(".jqTransformSelectWrapper:first").find("select").get(0);e&&i.oLabel&&i.oLabel.get(0)==e.get(0)||t(this).hide()})},i=function(i){0===t(i.target).parents(".jqTransformSelectWrapper").length&&e(t(i.target))},n=function(){t(document).mousedown(i)},a=function(e){var i;t(".jqTransformSelectWrapper select",e).each(function(){i=this.selectedIndex<0?0:this.selectedIndex,t("ul",t(this).parent()).each(function(){t("a:eq("+i+")",this).click()})}),t("a.jqTransformCheckbox, a.jqTransformRadio",e).removeClass("jqTransformChecked"),t("input:checkbox, input:radio",e).each(function(){this.checked&&t("a",t(this).parent()).addClass("jqTransformChecked")})};t.fn.jqTransSelect=function(){return this.each(function(i){var n=t(this);if(!n.hasClass("jqTransformHidden")&&!n.attr("multiple")){var a=n.addClass("jqTransformHidden").wrap('<div class="jqTransformSelectWrapper"></div>').parent().css({zIndex:1800-i});a.prepend('<div><span></span><a href="#" class="jqTransformSelectOpen"></a></div><ul class="jqTransformSelectList"></ul>');var s=t("ul",a).css("width",n.width()+15).hide();t(".jqTransformSelectOpen",a).css("width",n.width()),n.parents(".jqTransformSelectWrapper").css("width",n.width()),t("option",this).each(function(e){var i=t('<li><a href="#" index="'+e+'">'+t(this).html()+"</a></li>");s.append(i)}),s.find("a").click(function(){return t("a.selected",a).removeClass("selected"),t(this).addClass("selected"),n[0].selectedIndex!=t(this).attr("index")&&n[0].onchange&&(n[0].selectedIndex=t(this).attr("index"),n[0].onchange()),n[0].selectedIndex=t(this).attr("index"),t("span:eq(0)",a).html(t(this).html()),s.hide(),!1}),t("a:eq("+this.selectedIndex+")",s).click(),t("span:first",a).click(function(){t("a.jqTransformSelectOpen",a).trigger("click")});t("a.jqTransformSelectOpen",a).click(function(){return"none"==s.css("display")&&e(),n.attr("disabled")?!1:(s.slideToggle("fast",function(){var e=t("a.selected",s).offset().top-s.offset().top;s.animate({scrollTop:e})}),!1)})}})},t.fn.jqTransform=function(e){t.extend({});return this.each(function(){var e=t(this);e.hasClass("jqtransformdone")||(e.addClass("jqtransformdone"),t("select",this).jqTransSelect().length>0&&n(),e.bind("reset",function(){var t=function(){a(this)};window.setTimeout(t,10)}))})}}(jQuery),/**
* jQuery.UI.iPad plugin
* Copyright (c) 2010 Stephen von Takach
* licensed under MIT.
* Date: 27/8/2010
*
* Project Home:
* http://code.google.com/p/jquery-ui-for-ipad-and-iphone/
*/
$(function(){$.extend($.support,{touch:"object"==typeof Touch}),$.fn.addTouch=function(){this.each(function(t,e){$.support.touch&&(e.addEventListener("touchstart",iPadTouchHandler,!1),e.addEventListener("touchmove",iPadTouchHandler,!1),e.addEventListener("touchend",iPadTouchHandler,!1),e.addEventListener("touchcancel",iPadTouchHandler,!1))})}});var lastTap=null,tapValid=!1,tapTimeout=null,rightClickPending=!1,rightClickEvent=null,holdTimeout=null,cancelMouseUp=!1;!new function(t){var e=t.separator||"&",i=t.spaces===!1?!1:!0,n=(t.suffix===!1?"":"[]",t.prefix===!1?!1:!0),a=n?t.hash===!0?"#":"?":"",s=t.numbers===!1?!1:!0;jQuery.query=new function(){var t=function(t,e){return void 0!=t&&null!==t&&(e?t.constructor==e:!0)},n=function(t){for(var e,i=/\[([^[]*)\]/g,n=/^([^[]+)(\[.*\])?$/.exec(t),a=n[1],s=[];e=i.exec(n[2]);)s.push(e[1]);return[a,s]},r=function(e,i,n){var a=i.shift();if("object"!=typeof e&&(e=null),""===a)if(e||(e=[]),t(e,Array))e.push(0==i.length?n:r(null,i.slice(0),n));else if(t(e,Object)){for(var s=0;null!=e[s++];);e[--s]=0==i.length?n:r(e[s],i.slice(0),n)}else e=[],e.push(0==i.length?n:r(null,i.slice(0),n));else if(a&&a.match(/^\s*[0-9]+\s*$/)){var o=parseInt(a,10);e||(e=[]),e[o]=0==i.length?n:r(e[o],i.slice(0),n)}else{if(!a)return n;var o=a.replace(/^\s*|\s*$/g,"");if(e||(e={}),t(e,Array)){for(var l={},s=0;s<e.length;++s)l[s]=e[s];e=l}e[o]=0==i.length?n:r(e[o],i.slice(0),n)}return e},o=function(t){var e=this;return e.keys={},t.queryObject?jQuery.each(t.get(),function(t,i){e.SET(t,i)}):jQuery.each(arguments,function(){var t=""+this;t=t.replace(/^[?#]/,""),t=t.replace(/[;&]$/,""),i&&(t=t.replace(/[+]/g," ")),jQuery.each(t.split(/[&;]/),function(){var t=decodeURIComponent(this.split("=")[0]||""),i=decodeURIComponent(this.split("=")[1]||"");t&&(s&&(/^[+-]?[0-9]+\.[0-9]*$/.test(i)?i=parseFloat(i):/^[+-]?[0-9]+$/.test(i)&&(i=parseInt(i,10))),i=i||0===i?i:!0,i!==!1&&i!==!0&&"number"!=typeof i&&(i=i),e.SET(t,i))})}),e};return o.prototype={queryObject:!0,has:function(e,i){var n=this.get(e);return t(n,i)},GET:function(e){if(!t(e))return this.keys;for(var i=n(e),a=i[0],s=i[1],r=this.keys[a];null!=r&&0!=s.length;)r=r[s.shift()];return"number"==typeof r?r:r||""},get:function(e){var i=this.GET(e);return t(i,Object)?jQuery.extend(!0,{},i):t(i,Array)?i.slice(0):i},SET:function(e,i){var a=t(i)?i:null,s=n(e),o=s[0],l=s[1],h=this.keys[o];return this.keys[o]=r(h,l.slice(0),a),this},set:function(t,e){return this.copy().SET(t,e)},REMOVE:function(t){return this.SET(t,null).COMPACT()},remove:function(t){return this.copy().REMOVE(t)},EMPTY:function(){var t=this;return jQuery.each(t.keys,function(e,i){delete t.keys[e]}),t},load:function(t){var e=t.replace(/^.*?[#](.+?)(?:\?.+)?$/,"$1"),i=t.replace(/^.*?[?](.+?)(?:#.+)?$/,"$1");return new o(t.length==i.length?"":i,t.length==e.length?"":e)},empty:function(){return this.copy().EMPTY()},copy:function(){return new o(this)},COMPACT:function(){function e(i){function n(e,i,n){t(e,Array)?e.push(n):e[i]=n}var a="object"==typeof i?t(i,Array)?[]:{}:i;return"object"==typeof i&&jQuery.each(i,function(i,s){return t(s)?void n(a,i,e(s)):!0}),a}return this.keys=e(this.keys),this},compact:function(){return this.copy().COMPACT()},toString:function(){var n=[],s=[],r=function(t){return t+="",i&&(t=t.replace(/ /g,"+")),encodeURIComponent(t)},o=function(e,i,n){if(t(n)&&n!==!1){var a=[r(i)];n!==!0&&(a.push("="),a.push(r(n))),e.push(a.join(""))}},l=function(t,e){var i=function(t){return e&&""!=e?[e,"[",t,"]"].join(""):[t].join("")};jQuery.each(t,function(t,e){"object"==typeof e?l(e,i(t)):o(s,i(t),e)})};return l(this.keys),s.length>0&&n.push(a),n.push(s.join(e)),n.join("")}},new o(location.search,location.hash)}}(jQuery.query||{}),/*
 * jQuery Templates Plugin 1.0.0pre
 * http://github.com/jquery/jquery-tmpl
 * Requires jQuery 1.4.2
 *
 * Copyright Software Freedom Conservancy, Inc.
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */
function(t){function e(e,i,n,a){var s={data:a||0===a||a===!1?a:i?i.data:{},_wrap:i?i._wrap:null,tmpl:null,parent:i||null,nodes:[],calls:h,nest:c,wrap:d,html:u,update:p};return e&&t.extend(s,e,{nodes:[],parent:i}),n&&(s.tmpl=n,s._ctnt=s._ctnt||s.tmpl(t,s),s.key=++x,(_.length?b:y)[x]=s),s}function i(e,a,s){var r,o=s?t.map(s,function(t){return"string"==typeof t?e.key?t.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+m+'="'+e.key+'" $2'):t:i(t,e,t._ctnt)}):e;return a?o:(o=o.join(""),o.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(e,i,a,s){r=t(a).get(),l(r),i&&(r=n(i).concat(r)),s&&(r=r.concat(n(s)))}),r?r:n(o))}function n(e){var i=document.createElement("div");return i.innerHTML=e,t.makeArray(i.childNodes)}function a(e){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+t.trim(e).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(e,i,n,a,s,o,l){var h,c,d,u=t.tmpl.tag[n];if(!u)throw"Unknown template tag: "+n;return h=u._default||[],o&&!/\w$/.test(s)&&(s+=o,o=""),s?(s=r(s),l=l?","+r(l)+")":o?")":"",c=o?s.indexOf(".")>-1?s+r(o):"("+s+").call($item"+l:s,d=o?c:"(typeof("+s+")==='function'?("+s+").call($item):("+s+"))"):d=c=h.$1||"null",a=r(a),"');"+u[i?"close":"open"].split("$notnull_1").join(s?"typeof("+s+")!=='undefined' && ("+s+")!=null":"true").split("$1a").join(d).split("$1").join(c).split("$2").join(a||h.$2||"")+"__.push('"})+"');}return __;")}function s(e,n){e._wrap=i(e,!0,t.isArray(n)?n:[v.test(n)?n:t(n).html()]).join("")}function r(t){return t?t.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function o(t){var e=document.createElement("div");return e.appendChild(t.cloneNode(!0)),e.innerHTML}function l(i){function n(i){function n(t){t+=h,r=c[t]=c[t]||e(r,y[r.parent.key+h]||r.parent)}var a,s,r,o,l=i;if(o=i.getAttribute(m)){for(;l.parentNode&&1===(l=l.parentNode).nodeType&&!(a=l.getAttribute(m)););a!==o&&(l=l.parentNode?11===l.nodeType?0:l.getAttribute(m)||0:0,(r=y[o])||(r=b[o],r=e(r,y[l]||b[l]),r.key=++x,y[x]=r),$&&n(o)),i.removeAttribute(m)}else $&&(r=t.data(i,"tmplItem"))&&(n(r.key),y[r.key]=r,l=t.data(i.parentNode,"tmplItem"),l=l?l.key:0);if(r){for(s=r;s&&s.key!=l;)s.nodes.push(i),s=s.parent;delete r._ctnt,delete r._wrap,t.data(i,"tmplItem",r)}}var a,s,r,o,l,h="_"+$,c={};for(r=0,o=i.length;o>r;r++)if(1===(a=i[r]).nodeType){for(s=a.getElementsByTagName("*"),l=s.length-1;l>=0;l--)n(s[l]);n(a)}}function h(t,e,i,n){return t?void _.push({_:t,tmpl:e,item:this,data:i,options:n}):_.pop()}function c(e,i,n){return t.tmpl(t.template(e),i,n,this)}function d(e,i){var n=e.options||{};return n.wrapped=i,t.tmpl(t.template(e.tmpl),e.data,n,e.item)}function u(e,i){var n=this._wrap;return t.map(t(t.isArray(n)?n.join(""):n).filter(e||"*"),function(t){return i?t.innerText||t.textContent:t.outerHTML||o(t)})}function p(){var e=this.nodes;t.tmpl(null,null,null,this).insertBefore(e[0]),t(e).remove()}var f,g=t.fn.domManip,m="_tmplitem",v=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,y={},b={},w={key:0,data:{}},x=0,$=0,_=[];t.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,i){t.fn[e]=function(n){var a,s,r,o,l=[],h=t(n),c=1===this.length&&this[0].parentNode;if(f=y||{},c&&11===c.nodeType&&1===c.childNodes.length&&1===h.length)h[i](this[0]),l=this;else{for(s=0,r=h.length;r>s;s++)$=s,a=(s>0?this.clone(!0):this).get(),t(h[s])[i](a),l=l.concat(a);$=0,l=this.pushStack(l,e,h.selector)}return o=f,f=null,t.tmpl.complete(o),l}}),t.fn.extend({tmpl:function(e,i,n){return t.tmpl(this[0],e,i,n)},tmplItem:function(){return t.tmplItem(this[0])},template:function(e){return t.template(e,this[0])},domManip:function(e,i,n){if(e[0]&&t.isArray(e[0])){for(var a,s=t.makeArray(arguments),r=e[0],o=r.length,l=0;o>l&&!(a=t.data(r[l++],"tmplItem")););a&&$&&(s[2]=function(e){t.tmpl.afterManip(this,e,n)}),g.apply(this,s)}else g.apply(this,arguments);return $=0,!f&&t.tmpl.complete(y),this}}),t.extend({tmpl:function(n,a,r,o){var l,h=!o;if(h)o=w,n=t.template[n]||t.template(null,n),b={};else if(!n)return n=o.tmpl,y[o.key]=o,o.nodes=[],o.wrapped&&s(o,o.wrapped),t(i(o,null,o.tmpl(t,o)));return n?("function"==typeof a&&(a=a.call(o||{})),r&&r.wrapped&&s(r,r.wrapped),l=t.isArray(a)?t.map(a,function(t){return t?e(r,o,n,t):null}):[e(r,o,n,a)],h?t(i(o,null,l)):l):[]},tmplItem:function(e){var i;for(e instanceof t&&(e=e[0]);e&&1===e.nodeType&&!(i=t.data(e,"tmplItem"))&&(e=e.parentNode););return i||w},template:function(e,i){return i?("string"==typeof i?i=a(i):i instanceof t&&(i=i[0]||{}),i.nodeType&&(i=t.data(i,"tmpl")||t.data(i,"tmpl",a(i.innerHTML))),"string"==typeof e?t.template[e]=i:i):e?"string"!=typeof e?t.template(null,e):t.template[e]||t.template(null,v.test(e)?e:t(e)):null},encode:function(t){return(""+t).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}}),t.extend(t.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){y={}},afterManip:function(e,i,n){var a=11===i.nodeType?t.makeArray(i.childNodes):1===i.nodeType?[i]:[];n.call(e,i),l(a),$++}})}(jQuery),/*!
 * jQuery Tools v1.2.6 - The missing UI library for the Web
 * 
 * tooltip/tooltip.js
 * 
 * NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.
 * 
 * http://flowplayer.org/tools/
 * 
 */
function(t){function e(e,i,n){var a=n.relative?e.position().top:e.offset().top,s=n.relative?e.position().left:e.offset().left,r=n.position[0];a-=i.outerHeight()-n.offset[0],s+=e.outerWidth()+n.offset[1],/iPad/i.test(navigator.userAgent)&&(a-=t(window).scrollTop());var o=i.outerHeight()+e.outerHeight();"center"==r&&(a+=o/2),"bottom"==r&&(a+=o),r=n.position[1];var l=i.outerWidth()+e.outerWidth();return"center"==r&&(s-=l/2),"left"==r&&(s-=l),{top:a,left:s}}function i(i,a){var s,r,o=this,l=i.add(o),h=0,c=0,d=i.attr("title"),u=i.attr("data-tooltip"),p=n[a.effect],f=i.is(":input"),g=f&&i.is(":checkbox, :radio, select, :button, :submit"),m=i.attr("type"),v=a.events[m]||a.events[f?g?"widget":"input":"def"];if(!p)throw'Nonexistent effect "'+a.effect+'"';if(v=v.split(/,\s*/),2!=v.length)throw"Tooltip: bad events configuration for "+m;i.bind(v[0],function(t){clearTimeout(h),a.predelay?c=setTimeout(function(){o.show(t)},a.predelay):o.show(t)}).bind(v[1],function(t){clearTimeout(c),a.delay?h=setTimeout(function(){o.hide(t)},a.delay):o.hide(t)}),d&&a.cancelDefault&&(i.removeAttr("title"),i.data("title",d)),t.extend(o,{show:function(n){if(!s&&(u?s=t(u):a.tip?s=t(a.tip).eq(0):d?s=t(a.layout).addClass(a.tipClass).appendTo(document.body).hide().append(d):(s=i.next(),s.length||(s=i.parent().next())),!s.length))throw"Cannot find tooltip for "+i;if(o.isShown())return o;s.stop(!0,!0);var f=e(i,s,a);if(a.tip&&s.html(i.data("title")),n=t.Event(),n.type="onBeforeShow",l.trigger(n,[f]),n.isDefaultPrevented())return o;f=e(i,s,a),s.css({position:"absolute",top:f.top,left:f.left}),r=!0,p[0].call(o,function(){n.type="onShow",r="full",l.trigger(n)});var g=a.events.tooltip.split(/,\s*/);return s.data("__set")||(s.unbind(g[0]).bind(g[0],function(){clearTimeout(h),clearTimeout(c)}),g[1]&&!i.is("input:not(:checkbox, :radio), textarea")&&s.unbind(g[1]).bind(g[1],function(t){t.relatedTarget!=i[0]&&i.trigger(v[1].split(" ")[0])}),a.tip||s.data("__set",!0)),o},hide:function(e){return s&&o.isShown()?(e=t.Event(),e.type="onBeforeHide",l.trigger(e),e.isDefaultPrevented()?void 0:(r=!1,n[a.effect][1].call(o,function(){e.type="onHide",l.trigger(e)}),o)):o},isShown:function(t){return t?"full"==r:r},getConf:function(){return a},getTip:function(){return s},getTrigger:function(){return i}}),t.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(e,i){t.isFunction(a[i])&&t(o).bind(i,a[i]),o[i]=function(e){return e&&t(o).bind(i,e),o}})}t.tools=t.tools||{version:"v1.2.6"},t.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0,delay:30,opacity:1,tip:0,fadeIE:!1,position:["top","center"],offset:[0,0],relative:!1,cancelDefault:!0,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(t,e,i){n[t]=[e,i]}};var n={toggle:[function(t){var e=this.getConf(),i=this.getTip(),n=e.opacity;1>n&&i.css({opacity:n}),i.show(),t.call()},function(t){this.getTip().hide(),t.call()}],fade:[function(e){var i=this.getConf();!t.browser.msie||i.fadeIE?this.getTip().fadeTo(i.fadeInSpeed,i.opacity,e):(this.getTip().show(),e())},function(e){var i=this.getConf();!t.browser.msie||i.fadeIE?this.getTip().fadeOut(i.fadeOutSpeed,e):(this.getTip().hide(),e())}]};t.fn.tooltip=function(e){var n=this.data("tooltip");return n?n:(e=t.extend(!0,{},t.tools.tooltip.conf,e),"string"==typeof e.position&&(e.position=e.position.split(/,?\s/)),this.each(function(){n=new i(t(this),e),t(this).data("tooltip",n)}),e.api?n:this)}}(jQuery),/*
jQuery Url Plugin
	* Version 1.0
	* 2009-03-22 19:30:05
	* URL: http://ajaxcssblog.com/jquery/url-read-get-variables/
	* Description: jQuery Url Plugin gives the ability to read GET parameters from the actual URL
	* Author: Matthias Jäggli
	* Copyright: Copyright (c) 2009 Matthias Jäggli 
	* Licence: dual, MIT/GPLv2
*/
function(t){t.url={},t.extend(t.url,{_params:{},init:function(){var t="";try{t=(document.location.href.split("?",2)[1]||"").split("#")[0].split("&")||[];for(var e=0;e<t.length;e++){var i=t[e].split("=");i[0]&&(this._params[i[0]]=unescape(i[1]))}}catch(n){alert(n)}},param:function(t){return this._params[t]||""},paramAll:function(){return this._params}}),t.url.init()}(jQuery),function($){function loadAndParseFile(t,e,i){$.ajax({url:t,async:!1,cache:!0,contentType:"text/plain;charset=UTF-8",dataType:"text",success:function(t,e){parseData(t,i)}})}function parseData(data,mode){for(var parsed="",parameters=data.split(/\n/),regPlaceHolder=/(\{\d+\})/g,regRepPlaceHolder=/\{(\d+)\}/g,unicodeRE=/(\\u.{4})/gi,i=0;i<parameters.length;i++)if(parameters[i]=parameters[i].replace(/^\s\s*/,"").replace(/\s\s*$/,""),parameters[i].length>0&&"#"!=parameters[i].match("^#")){var pair=parameters[i].split("=");if(pair.length>0){for(var name=unescape(pair[0]).replace(/^\s\s*/,"").replace(/\s\s*$/,""),value=1==pair.length?"":pair[1];"\\"==value.match(/\\$/);)value=value.substring(0,value.length-1),value+=parameters[++i].replace(/\s\s*$/,"");for(var s=2;s<pair.length;s++)value+="="+pair[s];if(value=value.replace(/"/g,'\\"'),value=value.replace(/^\s\s*/,"").replace(/\s\s*$/,""),"map"==mode||"both"==mode){var unicodeMatches=value.match(unicodeRE);if(unicodeMatches)for(var u=0;u<unicodeMatches.length;u++)value=value.replace(unicodeMatches[u],unescapeUnicode(unicodeMatches[u]));$.i18n.map[name]=value}if("vars"==mode||"both"==mode)if(checkKeyNamespace(name),regPlaceHolder.test(value)){for(var parts=value.split(regPlaceHolder),first=!0,fnArgs="",usedArgs=[],p=0;p<parts.length;p++)!regPlaceHolder.test(parts[p])||0!=usedArgs.length&&-1!=usedArgs.indexOf(parts[p])||(first||(fnArgs+=","),fnArgs+=parts[p].replace(regRepPlaceHolder,"v$1"),usedArgs.push(parts[p]),first=!1);parsed+=name+"=function("+fnArgs+"){";var fnExpr='"'+value.replace(regRepPlaceHolder,'"+v$1+"')+'"';parsed+="return "+fnExpr+";};"}else parsed+=name+'="'+value+'";'}}eval(parsed)}function checkKeyNamespace(key){var regDot=/\./;if(regDot.test(key))for(var fullname="",names=key.split(/\./),i=0;i<names.length;i++)i>0&&(fullname+="."),fullname+=names[i],eval("typeof "+fullname+' == "undefined"')&&eval(fullname+"={};")}function getFiles(t){return t&&t.constructor==Array?t:[t]}function normaliseLanguageCode(t){return t=t.toLowerCase(),t.length>3&&(t=t.substring(0,3)+t.substring(3).toUpperCase()),t}function unescapeUnicode(t){var e=[],i=parseInt(t.substr(2),16);i>=0&&i<Math.pow(2,16)&&e.push(i);for(var n="",a=0;a<e.length;++a)n+=String.fromCharCode(e[a]);return n}$.i18n={},$.i18n.map={},$.i18n.properties=function(t){var e={name:"Messages",language:"",path:"",mode:"vars",callback:function(){}};t=$.extend(e,t),(null===t.language||""==t.language)&&(t.language=$.i18n.browserLang()),null===t.language&&(t.language=""),loadAndParseFile(t.path+t.name+"_"+t.language+".properties",t.language,t.mode),t.callback&&t.callback()},$.i18n.prop=function(t,e){var i=$.i18n.map[t];if(null==i)return alert("Translation not found for: "+t),"["+t+"]";if(e){for(var n=0;n<e.length;n++){var a=new RegExp("\\{("+n+")\\}","g");i=i.replace(a,e[n])}return i}return i},$.i18n.browserLang=function(){return normaliseLanguageCode(navigator.language||navigator.userLanguage)};var cbSplit;cbSplit||(cbSplit=function(t,e,i){if("[object RegExp]"!==Object.prototype.toString.call(e))return"undefined"==typeof cbSplit._nativeSplit?t.split(e,i):cbSplit._nativeSplit.call(t,e,i);var n,a,s,r,o=[],l=0,h=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.sticky?"y":""),e=RegExp(e.source,h+"g");if(t+="",cbSplit._compliantExecNpcg||(n=RegExp("^"+e.source+"$(?!\\s)",h)),void 0===i||0>+i)i=1/0;else if(i=Math.floor(+i),!i)return[];for(;(a=e.exec(t))&&(s=a.index+a[0].length,!(s>l&&(o.push(t.slice(l,a.index)),!cbSplit._compliantExecNpcg&&a.length>1&&a[0].replace(n,function(){for(var t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(a[t]=void 0)}),a.length>1&&a.index<t.length&&Array.prototype.push.apply(o,a.slice(1)),r=a[0].length,l=s,o.length>=i)));)e.lastIndex===a.index&&e.lastIndex++;return l===t.length?(r||!e.test(""))&&o.push(""):o.push(t.slice(l)),o.length>i?o.slice(0,i):o},cbSplit._compliantExecNpcg=void 0===/()??/.exec("")[1],cbSplit._nativeSplit=String.prototype.split),String.prototype.split=function(t,e){return cbSplit(this,t,e)}}(jQuery),/*
 *   Easy Slider 1.7 - jQuery plugin
 *  written by Alen Grakalic
 *  http://cssglobe.com/post/4004/easy-slider-15-the-easiest-jquery-plugin-for-sliding
 *
 *  Copyright (c) 2009 Alen Grakalic (http://cssglobe.com)
 *  Dual licensed under the MIT (MIT-LICENSE.txt)
 *  and GPL (GPL-LICENSE.txt) licenses.
 *
 *  Built for jQuery library
 *  http://jquery.com
 *
 */
function(t){t.fn.easySlider=function(e){var i={prevId:"prevBtn",prevText:"Previous",nextId:"nextBtn",nextText:"Next",controlsShow:!0,controlsBefore:"",controlsAfter:"",controlsFade:!0,firstId:"firstBtn",firstText:"First",firstShow:!1,lastId:"lastBtn",lastText:"Last",lastShow:!1,vertical:!1,speed:800,auto:!1,pause:2e3,continuous:!1,numeric:!1,numericId:"controls",eventDriven:!1,autoWidthSetting:!1},e=t.extend(i,e);this.each(function(){function i(i){i=parseInt(i)+1,t("li","#"+e.numericId).removeClass("current"),t("li#"+e.numericId+i).addClass("current")}function n(){d>c()&&(d=0),0>d&&(d=c()),e.vertical?t("ul",s).css("margin-top",d*l()*-1):t("ul",s).css("margin-left",d*o()*-1),h=!0,e.numeric&&i(d)}function a(i,r){if(e.vertical||t("li",s).css("float","left"),h){h=!1;var u=d;switch(i){case"next":d=u>=c()?e.continuous?d+1:c():d+1;break;case"prev":d=0>=d?e.continuous?d-1:0:d-1;break;case"first":d=0;break;case"last":d=c();break;default:d=i}var p=Math.abs(u-d),g=p*e.speed;if(e.vertical){var m=d*l*-1;t("ul",s).animate({marginTop:m},{queue:!1,duration:g,complete:n})}else{var m=d*o()*-1;t("ul",s).animate({marginLeft:m},{queue:!1,duration:g,complete:n})}!e.continuous&&e.controlsFade&&(d==c()?(t("a","#"+e.nextId).hide(),t("a","#"+e.lastId).hide()):(t("a","#"+e.nextId).show(),t("a","#"+e.lastId).show()),0==d?(t("a","#"+e.prevId).hide(),t("a","#"+e.firstId).hide()):(t("a","#"+e.prevId).show(),t("a","#"+e.firstId).show())),r&&clearTimeout(f),e.auto&&"next"==i&&!r&&(f=setTimeout(function(){a("next",!1)},p*e.speed+e.pause))}}var s=t(this),r=function(){return t("li",s).length},o=function(){return t("li",s).width()},l=function(){return t("li",s).height()},h=!0,c=function(){return r()-1},d=0;if(e.autoWidthSetting&&t("ul",s).css("width",r()*o()),e.continuous&&(t("ul",s).prepend(t("ul li:last-child",s).clone().css("margin-left","-"+o()+"px")),t("ul",s).append(t("ul li:nth-child(2)",s).clone()),e.autoWidthSetting&&t("ul",s).css("width",(r()+1)*o())),e.vertical||t("li",s).css("float","left"),e.controlsShow){var u=e.controlsBefore;e.numeric?u+='<ol id="'+e.numericId+'"></ol>':(e.firstShow&&(u+='<span id="'+e.firstId+'"><a href="javascript:void(0);">'+e.firstText+"</a></span>"),u+=' <span id="'+e.prevId+'"><a href="javascript:void(0);" class="dbPrevBtn">'+e.prevText+"</a></span>",u+=' <span id="'+e.nextId+'"><a href="javascript:void(0);" class="dbNextBtn">'+e.nextText+"</a></span>",e.lastShow&&(u+=' <span id="'+e.lastId+'"><a href="javascript:void(0);">'+e.lastText+"</a></span>")),u+=e.controlsAfter,t(s).after(u)}if(e.numeric)for(var p=0;r>p;p++)t(document.createElement("li")).attr("id",e.numericId+(p+1)).html("<a rel="+p+' href="javascript:void(0);">'+(p+1)+"</a>").appendTo(t("#"+e.numericId)).click(function(){a(t("a",t(this)).attr("rel"),!0)});else t("a","#"+e.nextId).click(function(){e.eventDriven?h&&s.trigger("easySlider.nextClicked"):a("next",!0)}),t("a","#"+e.prevId).click(function(){e.eventDriven?h&&s.trigger("easySlider.prevClicked"):a("prev",!0)}),t("a","#"+e.firstId).click(function(){e.eventDriven?h&&s.trigger("easySlider.firstClicked"):a("first",!0)}),t("a","#"+e.lastId).click(function(){e.eventDriven?h&&s.trigger("easySlider.lastClicked"):a("last",!0)}),e.eventDriven&&(s.bind("easySlider.next",function(){t("ul",s).css("width",r()*o()),h=!0,a("next",!0)}),s.bind("easySlider.prev",function(){t("ul",s).css("width",r()*o()),h=!0,a("prev",!0)}),s.bind("easySlider.first",function(){h=!0,a("first",!0)}),s.bind("easySlider.last",function(){h=!0,a("last",!0)}),s.bind("easySlider.insertedItem",function(){d+=1,e.vertical?t("ul",s).css("margin-top",d*l()*-1):t("ul",s).css("margin-left",d*o()*-1)}),s.bind("easySlider.lock",function(){h=!1}),s.bind("easySlider.unlock",function(){h=!0}));var f;e.auto&&(f=setTimeout(function(){a("next",!1)},e.pause)),e.numeric&&i(0),!e.continuous&&e.controlsFade&&(t("a","#"+e.prevId).hide(),t("a","#"+e.firstId).hide())})}}(jQuery);/**
 * Dragdealer JS v0.9.5
 * http://code.ovidiu.ch/dragdealer-js
 *
 * Copyright (c) 2010, Ovidiu Chereches
 * MIT License
 * http://legal.ovidiu.ch/licenses/MIT
 */
var Cursor={x:0,y:0,init:function(){this.setEvent("mouse"),this.setEvent("touch")},setEvent:function(t){var e=document["on"+t+"move"]||function(){};document["on"+t+"move"]=function(t){e(t),Cursor.refresh(t)}},refresh:function(t){t||(t=window.event),"mousemove"==t.type?this.set(t):t.touches&&this.set(t.touches[0])},set:function(t){t.pageX||t.pageY?(this.x=t.pageX,this.y=t.pageY):(t.clientX||t.clientY)&&(this.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop)}};Cursor.init();var Position={get:function(t){var e=curtop=0;if(t.offsetParent)do e+=t.offsetLeft,curtop+=t.offsetTop;while(t=t.offsetParent);return[e,curtop]}},Dragdealer=function(t,e){if("string"==typeof t&&(t=document.getElementById(t)),t){var i=t.getElementsByTagName("div")[0];i&&-1!=i.className.search(/(^|\s)handle(\s|$)/)&&(this.init(t,i,e||{}),this.setup())}};Dragdealer.prototype={init:function(t,e,i){this.wrapper=t,this.handle=e,this.options=i,this.disabled=this.getOption("disabled",!1),this.horizontal=this.getOption("horizontal",!0),this.vertical=this.getOption("vertical",!1),this.slide=this.getOption("slide",!0),this.steps=this.getOption("steps",0),this.snap=this.getOption("snap",!1),this.loose=this.getOption("loose",!1),this.speed=this.getOption("speed",10)/100,this.xPrecision=this.getOption("xPrecision",0),this.yPrecision=this.getOption("yPrecision",0),this.callback=i.callback||null,this.animationCallback=i.animationCallback||null,this.bounds={left:i.left||0,right:-(i.right||0),top:i.top||0,bottom:-(i.bottom||0),x0:0,x1:0,xRange:0,y0:0,y1:0,yRange:0},this.value={prev:[-1,-1],current:[i.x||0,i.y||0],target:[i.x||0,i.y||0]},this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]},this.change=[0,0],this.activity=!1,this.dragging=!1,this.tapping=!1},getOption:function(t,e){return void 0!==this.options[t]?this.options[t]:e},setup:function(){this.setWrapperOffset(),this.setBoundsPadding(),this.setBounds(),this.setSteps(),this.addListeners()},setWrapperOffset:function(){this.offset.wrapper=Position.get(this.wrapper)},setBoundsPadding:function(){this.bounds.left||this.bounds.right||(this.bounds.left=Position.get(this.handle)[0]-this.offset.wrapper[0],this.bounds.right=-this.bounds.left),this.bounds.top||this.bounds.bottom||(this.bounds.top=Position.get(this.handle)[1]-this.offset.wrapper[1],this.bounds.bottom=-this.bounds.top)},setBounds:function(){this.bounds.x0=this.bounds.left,this.bounds.x1=this.wrapper.offsetWidth+this.bounds.right,this.bounds.xRange=this.bounds.x1-this.bounds.x0-this.handle.offsetWidth,this.bounds.y0=this.bounds.top,this.bounds.y1=this.wrapper.offsetHeight+this.bounds.bottom,this.bounds.yRange=this.bounds.y1-this.bounds.y0-this.handle.offsetHeight,this.bounds.xStep=1/(this.xPrecision||Math.max(this.wrapper.offsetWidth,this.handle.offsetWidth)),this.bounds.yStep=1/(this.yPrecision||Math.max(this.wrapper.offsetHeight,this.handle.offsetHeight))},setSteps:function(){if(this.steps>1){this.stepRatios=[];for(var t=0;t<=this.steps-1;t++)this.stepRatios[t]=t/(this.steps-1)}},addListeners:function(){var t=this;this.wrapper.onselectstart=function(){return!1},this.handle.onmousedown=this.handle.ontouchstart=function(e){t.handleDownHandler(e)},this.wrapper.onmousedown=this.wrapper.ontouchstart=function(e){t.wrapperDownHandler(e)};var e=document.onmouseup||function(){};document.onmouseup=function(i){e(i),t.documentUpHandler(i)};var i=document.ontouchend||function(){};document.ontouchend=function(e){i(e),t.documentUpHandler(e)};var n=window.onresize||function(){};window.onresize=function(e){n(e),t.documentResizeHandler(e)},this.wrapper.onmousemove=function(e){t.activity=!0},this.wrapper.onclick=function(e){return!t.activity},this.interval=setInterval(function(){t.animate()},25),t.animate(!1,!0)},handleDownHandler:function(t){this.activity=!1,Cursor.refresh(t),this.preventDefaults(t,!0),this.startDrag(),this.cancelEvent(t)},wrapperDownHandler:function(t){Cursor.refresh(t),this.preventDefaults(t,!0),this.startTap()},documentUpHandler:function(t){this.stopDrag(),this.stopTap()},documentResizeHandler:function(t){this.setWrapperOffset(),this.setBounds(),this.update()},enable:function(){this.disabled=!1,this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=!0,this.handle.className+=" disabled"},setStep:function(t,e,i){this.setValue(this.steps&&t>1?(t-1)/(this.steps-1):0,this.steps&&e>1?(e-1)/(this.steps-1):0,i)},setValue:function(t,e,i){this.setTargetValue([t,e||0]),i&&this.groupCopy(this.value.current,this.value.target)},startTap:function(t){this.disabled||(this.tapping=!0,void 0===t&&(t=[Cursor.x-this.offset.wrapper[0]-this.handle.offsetWidth/2,Cursor.y-this.offset.wrapper[1]-this.handle.offsetHeight/2]),this.setTargetOffset(t))},stopTap:function(){!this.disabled&&this.tapping&&(this.tapping=!1,this.setTargetValue(this.value.current),this.result())},startDrag:function(){this.disabled||(this.offset.mouse=[Cursor.x-Position.get(this.handle)[0],Cursor.y-Position.get(this.handle)[1]],this.dragging=!0)},stopDrag:function(){if(!this.disabled&&this.dragging){this.dragging=!1;var t=this.groupClone(this.value.current);if(this.slide){var e=this.change;t[0]+=4*e[0],t[1]+=4*e[1]}this.setTargetValue(t),this.result()}},feedback:function(){var t=this.value.current;this.snap&&this.steps>1&&(t=this.getClosestSteps(t)),this.groupCompare(t,this.value.prev)||("function"==typeof this.animationCallback&&this.animationCallback(t[0],t[1]),this.groupCopy(this.value.prev,t))},result:function(){"function"==typeof this.callback&&this.callback(this.value.target[0],this.value.target[1])},animate:function(t,e){if(!t||this.dragging){if(this.dragging){var i=this.groupClone(this.value.target),n=[Cursor.x-this.offset.wrapper[0]-this.offset.mouse[0],Cursor.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetOffset(n,this.loose),this.change=[this.value.target[0]-i[0],this.value.target[1]-i[1]]}(this.dragging||e)&&this.groupCopy(this.value.current,this.value.target),(this.dragging||this.glide()||e)&&(this.update(),this.feedback())}},glide:function(){var t=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];return t[0]||t[1]?(Math.abs(t[0])>this.bounds.xStep||Math.abs(t[1])>this.bounds.yStep?(this.value.current[0]+=t[0]*this.speed,this.value.current[1]+=t[1]*this.speed):this.groupCopy(this.value.current,this.value.target),!0):!1},update:function(){this.snap?this.offset.current=this.getOffsetsByRatios(this.getClosestSteps(this.value.current)):this.offset.current=this.getOffsetsByRatios(this.value.current),this.show()},show:function(){this.groupCompare(this.offset.current,this.offset.prev)||(this.horizontal&&(this.handle.style.left=String(this.offset.current[0])+"px"),this.vertical&&(this.handle.style.top=String(this.offset.current[1])+"px"),this.groupCopy(this.offset.prev,this.offset.current))},setTargetValue:function(t,e){var i=e?this.getLooseValue(t):this.getProperValue(t);this.groupCopy(this.value.target,i),this.offset.target=this.getOffsetsByRatios(i)},setTargetOffset:function(t,e){var i=this.getRatiosByOffsets(t),n=e?this.getLooseValue(i):this.getProperValue(i);this.groupCopy(this.value.target,n),this.offset.target=this.getOffsetsByRatios(n)},getLooseValue:function(t){var e=this.getProperValue(t);return[e[0]+(t[0]-e[0])/4,e[1]+(t[1]-e[1])/4]},getProperValue:function(t){var e=this.groupClone(t);return e[0]=Math.max(e[0],0),e[1]=Math.max(e[1],0),e[0]=Math.min(e[0],1),e[1]=Math.min(e[1],1),(!this.dragging&&!this.tapping||this.snap)&&this.steps>1&&(e=this.getClosestSteps(e)),e},getRatiosByOffsets:function(t){return[this.getRatioByOffset(t[0],this.bounds.xRange,this.bounds.x0),this.getRatioByOffset(t[1],this.bounds.yRange,this.bounds.y0)]},getRatioByOffset:function(t,e,i){return e?(t-i)/e:0},getOffsetsByRatios:function(t){return[this.getOffsetByRatio(t[0],this.bounds.xRange,this.bounds.x0),this.getOffsetByRatio(t[1],this.bounds.yRange,this.bounds.y0)]},getOffsetByRatio:function(t,e,i){return Math.round(t*e)+i},getClosestSteps:function(t){return[this.getClosestStep(t[0]),this.getClosestStep(t[1])]},getClosestStep:function(t){for(var e=0,i=1,n=0;n<=this.steps-1;n++)Math.abs(this.stepRatios[n]-t)<i&&(i=Math.abs(this.stepRatios[n]-t),e=n);return this.stepRatios[e]},groupCompare:function(t,e){return t[0]==e[0]&&t[1]==e[1]},groupCopy:function(t,e){t[0]=e[0],t[1]=e[1]},groupClone:function(t){return[t[0],t[1]]},preventDefaults:function(t,e){t||(t=window.event),t.preventDefault&&t.preventDefault(),t.returnValue=!1,e&&document.selection&&document.selection.empty()},cancelEvent:function(t){t||(t=window.event),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0}};var Kicksend={mailcheck:{threshold:3,defaultDomains:"yahoo.com google.com hotmail.com gmail.com me.com aol.com mac.com live.com comcast.net googlemail.com msn.com hotmail.co.uk yahoo.co.uk facebook.com verizon.net sbcglobal.net att.net gmx.com mail.com".split(" "),defaultTopLevelDomains:"co.uk com net org info edu gov mil".split(" "),run:function(t){t.domains=t.domains||Kicksend.mailcheck.defaultDomains,t.topLevelDomains=t.topLevelDomains||Kicksend.mailcheck.defaultTopLevelDomains,t.distanceFunction=t.distanceFunction||Kicksend.sift3Distance;var e=Kicksend.mailcheck.suggest(encodeURI(t.email),t.domains,t.topLevelDomains,t.distanceFunction);e?t.suggested&&t.suggested(e):t.empty&&t.empty()},suggest:function(t,e,i,n){if(t=t.toLowerCase(),t=this.splitEmail(t),e=this.findClosestDomain(t.domain,e,n)){if(e!=t.domain)return{address:t.address,domain:e,full:t.address+"@"+e}}else if(i=this.findClosestDomain(t.topLevelDomain,i),t.domain&&i&&i!=t.topLevelDomain)return e=t.domain,e=e.substring(0,e.lastIndexOf(t.topLevelDomain))+i,{address:t.address,domain:e,full:t.address+"@"+e};return!1},findClosestDomain:function(t,e,i){var n,a=99,s=null;if(!t||!e)return!1;i||(i=this.sift3Distance);for(var r=0;r<e.length;r++){if(t===e[r])return t;n=i(t,e[r]),a>n&&(a=n,s=e[r])}return a<=this.threshold&&null!==s?s:!1},sift3Distance:function(t,e){if(null==t||0===t.length)return null==e||0===e.length?0:e.length;if(null==e||0===e.length)return t.length;for(var i=0,n=0,a=0,s=0;i+n<t.length&&i+a<e.length;){if(t.charAt(i+n)==e.charAt(i+a))s++;else for(var r=a=n=0;5>r;r++){if(i+r<t.length&&t.charAt(i+r)==e.charAt(i)){n=r;break}if(i+r<e.length&&t.charAt(i)==e.charAt(i+r)){a=r;break}}i++}return(t.length+e.length)/2-s},splitEmail:function(t){if(t=t.split("@"),2>t.length)return!1;for(var e=0;e<t.length;e++)if(""===t[e])return!1;var i=t.pop(),n=i.split("."),a="";if(0==n.length)return!1;if(1==n.length)a=n[0];else{for(e=1;e<n.length;e++)a+=n[e]+".";2<=n.length&&(a=a.substring(0,a.length-1))}return{topLevelDomain:a,domain:i,address:t.join("@")}}}};window.jQuery&&function(t){t.fn.mailcheck=function(t){var e=this;if(t.suggested){var i=t.suggested;t.suggested=function(t){i(e,t)}}if(t.empty){var n=t.empty;t.empty=function(){n.call(null,e)}}t.email=this.val(),Kicksend.mailcheck.run(t)}}(jQuery),/*!
 * Raphael 1.5.2 - JavaScript Vector Library
 *
 * Copyright (c) 2010 Dmitry Baranovskiy (http://raphaeljs.com)
 * Licensed under the MIT (http://raphaeljs.com/license.html) license.
 */
function(){function t(){if(t.is(arguments[0],V)){for(var e=arguments[0],i=Zt[y](t,e.splice(0,3+t.is(e[0],E))),n=i.set(),a=0,s=e[D];s>a;a++){var r=e[a]||{};h[u](r.type)&&n[W](i[r.type]().attr(r))}return n}return Zt[y](t,arguments)}function e(){for(var t=[],e=0;32>e;e++)t[e]=(~~(16*I.random()))[L](16);return t[12]=4,t[16]=(3&t[16]|8)[L](16),"r-"+t[M]("")}function i(t,e,i){function n(){var a=Array[d].slice.call(arguments,0),s=a[M]("\u25ba"),r=n.cache=n.cache||{},o=n.count=n.count||[];return r[u](s)?i?i(r[s]):r[s]:(o[D]>=1e3&&delete r[o.shift()],o[W](s),r[s]=t[y](e,a),i?i(r[s]):r[s])}return n}function n(e,i,n,a,s){return s?t.format("M{0},{1}l{2},0a{3},{3},0,0,1,{3},{3}l0,{5}a{3},{3},0,0,1,{4},{3}l{6},0a{3},{3},0,0,1,{4},{4}l0,{7}a{3},{3},0,0,1,{3},{4}z",e+s,i,n-2*s,s,-s,a-2*s,2*s-n,2*s-a):t.format("M{0},{1}l{2},0,0,{3},{4},0z",e,i,n,a,-n)}function a(){return this.x+$+this.y}function s(e){return function(i,n,a,s){var r={back:e};return t.is(a,"function")?s=a:r.rot=a,i&&i.constructor==Wt&&(i=i.attrs.path),i&&(r.along=i),this.animate(r,n,s)}}function r(t,e,i,n,a,s){function r(t){return((d*t+c)*t+h)*t}function o(t,e){var i=l(t,e);return((f*i+p)*i+u)*i}function l(t,e){var i,n,a,s,o,l;for(a=t,l=0;8>l;l++){if(s=r(a)-t,R(s)<e)return a;if(o=(3*d*a+2*c)*a+h,R(o)<1e-6)break;a-=s/o}if(i=0,n=1,a=t,i>a)return i;if(a>n)return n;for(;n>i;){if(s=r(a),R(s-t)<e)return a;t>s?i=a:n=a,a=(n-i)/2+i}return a}var h=3*e,c=3*(n-e)-h,d=1-h-c,u=3*i,p=3*(a-i)-u,f=1-u-p;return o(t,1/(200*s))}t.version="1.5.2";var o,l=/[, ]+/,h={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},c=/\{(\d+)\}/g,d="prototype",u="hasOwnProperty",p=document,f=window,g={was:Object[d][u].call(f,"Raphael"),is:f.Raphael},m=function(){this.customAttributes={}},v="appendChild",y="apply",b="concat",w="createTouch"in p,x="",$=" ",_=String,C="split",k="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend orientationchange touchcancel gesturestart gesturechange gestureend"[C]($),S={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},M="join",D="length",T=_[d].toLowerCase,I=Math,P=I.max,A=I.min,R=I.abs,j=I.pow,B=I.PI,E="number",F="string",V="array",L="toString",N="fill",O=Object[d][L],W="push",z=/^url\(['"]?([^\)]+?)['"]?\)$/i,H=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,U={NaN:1,Infinity:1,"-Infinity":1},G=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,q=I.round,Y="setAttribute",X=parseFloat,Z=parseInt,Q=" progid:DXImageTransform.Microsoft",K=_[d].toUpperCase,J={blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rotation:0,rx:0,ry:0,scale:"1 1",src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",translation:"0 0",width:0,x:0,y:0},tt={along:"along",blur:E,"clip-rect":"csv",cx:E,cy:E,fill:"colour","fill-opacity":E,"font-size":E,height:E,opacity:E,path:"path",r:E,rotation:"csv",rx:E,ry:E,scale:"csv",stroke:"colour","stroke-opacity":E,"stroke-width":E,translation:"csv",width:E,x:E,y:E},et="replace",it=/^(from|to|\d+%?)$/,nt=/\s*,\s*/,at={hs:1,rg:1},st=/,?([achlmqrstvxz]),?/gi,rt=/([achlmqstvz])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?\s*,?\s*)+)/gi,ot=/(-?\d*\.?\d*(?:e[-+]?\d+)?)\s*,?\s*/gi,lt=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/,ht=function(t,e){return t.key-e.key};if(t.type=f.SVGAngle||p.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==t.type){var ct,dt=p.createElement("div");if(dt.innerHTML='<v:shape adj="1"/>',ct=dt.firstChild,ct.style.behavior="url(#default#VML)",!ct||"object"!=typeof ct.adj)return t.type=null;dt=null}t.svg=!(t.vml="VML"==t.type),m[d]=t[d],o=m[d],t._id=0,t._oid=0,t.fn={},t.is=function(t,e){return e=T.call(e),"finite"==e?!U[u](+t):"null"==e&&null===t||e==typeof t||"object"==e&&t===Object(t)||"array"==e&&Array.isArray&&Array.isArray(t)||O.call(t).slice(8,-1).toLowerCase()==e},t.angle=function(e,i,n,a,s,r){if(null==s){var o=e-n,l=i-a;return o||l?(180*(0>o)+180*I.atan(-l/-o)/B+360)%360:0}return t.angle(e,i,s,r)-t.angle(n,a,s,r)},t.rad=function(t){return t%360*B/180},t.deg=function(t){return 180*t/B%360},t.snapTo=function(e,i,n){if(n=t.is(n,"finite")?n:10,t.is(e,V)){for(var a=e.length;a--;)if(R(e[a]-i)<=n)return e[a]}else{e=+e;var s=i%e;if(n>s)return i-s;if(s>e-n)return i-s+e}return i},t.setWindow=function(t){f=t,p=f.document};var ut=function(e){if(t.vml){var n,a=/^\s+|\s+$/g;try{var s=new ActiveXObject("htmlfile");s.write("<body>"),s.close(),n=s.body}catch(r){n=createPopup().document.body}var o=n.createTextRange();ut=i(function(t){try{n.style.color=_(t)[et](a,x);var e=o.queryCommandValue("ForeColor");return e=(255&e)<<16|65280&e|(16711680&e)>>>16,"#"+("000000"+e[L](16)).slice(-6)}catch(i){return"none"}})}else{var l=p.createElement("i");l.title="Rapha\xebl Colour Picker",l.style.display="none",p.body[v](l),ut=i(function(t){return l.style.color=t,p.defaultView.getComputedStyle(l,x).getPropertyValue("color")})}return ut(e)},pt=function(){return"hsb("+[this.h,this.s,this.b]+")"},ft=function(){return"hsl("+[this.h,this.s,this.l]+")"},gt=function(){return this.hex};t.hsb2rgb=function(e,i,n,a){return t.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(n=e.b,i=e.s,e=e.h,a=e.o),t.hsl2rgb(e,i,n/2,a)},t.hsl2rgb=function(e,i,n,a){t.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(n=e.l,i=e.s,e=e.h),(e>1||i>1||n>1)&&(e/=360,i/=100,n/=100);var s,r,o,l={},h=["r","g","b"];if(i){s=.5>n?n*(1+i):n+i-n*i,r=2*n-s;for(var c=0;3>c;c++)o=e+1/3*-(c-1),0>o&&o++,o>1&&o--,1>6*o?l[h[c]]=r+6*(s-r)*o:1>2*o?l[h[c]]=s:2>3*o?l[h[c]]=r+(s-r)*(2/3-o)*6:l[h[c]]=r}else l={r:n,g:n,b:n};return l.r*=255,l.g*=255,l.b*=255,l.hex="#"+(16777216|l.b|l.g<<8|l.r<<16).toString(16).slice(1),t.is(a,"finite")&&(l.opacity=a),l.toString=gt,l},t.rgb2hsb=function(e,i,n){if(null==i&&t.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(n=e.b,i=e.g,e=e.r),null==i&&t.is(e,F)){var a=t.getRGB(e);e=a.r,i=a.g,n=a.b}(e>1||i>1||n>1)&&(e/=255,i/=255,n/=255);var s,r,o=P(e,i,n),l=A(e,i,n),h=o;if(l==o)return{h:0,s:0,b:o,toString:pt};var c=o-l;return r=c/o,s=e==o?(i-n)/c:i==o?2+(n-e)/c:4+(e-i)/c,s/=6,0>s&&s++,s>1&&s--,{h:s,s:r,b:h,toString:pt}},t.rgb2hsl=function(e,i,n){if(null==i&&t.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(n=e.b,i=e.g,e=e.r),null==i&&t.is(e,F)){var a=t.getRGB(e);e=a.r,i=a.g,n=a.b}(e>1||i>1||n>1)&&(e/=255,i/=255,n/=255);var s,r,o,l=P(e,i,n),h=A(e,i,n),c=(l+h)/2;if(h==l)o={h:0,s:0,l:c};else{var d=l-h;r=.5>c?d/(l+h):d/(2-l-h),s=e==l?(i-n)/d:i==l?2+(n-e)/d:4+(e-i)/d,s/=6,0>s&&s++,s>1&&s--,o={h:s,s:r,l:c}}return o.toString=ft,o},t._path2string=function(){return this.join(",")[et](st,"$1")},t.getRGB=i(function(e){if(!e||(e=_(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1};if("none"==e)return{r:-1,g:-1,b:-1,hex:"none"};!(at[u](e.toLowerCase().substring(0,2))||"#"==e.charAt())&&(e=ut(e));var i,n,a,s,r,o,l=e.match(H);return l?(l[2]&&(a=Z(l[2].substring(5),16),n=Z(l[2].substring(3,5),16),i=Z(l[2].substring(1,3),16)),l[3]&&(a=Z((r=l[3].charAt(3))+r,16),n=Z((r=l[3].charAt(2))+r,16),i=Z((r=l[3].charAt(1))+r,16)),l[4]&&(o=l[4][C](nt),i=X(o[0]),"%"==o[0].slice(-1)&&(i*=2.55),n=X(o[1]),"%"==o[1].slice(-1)&&(n*=2.55),a=X(o[2]),"%"==o[2].slice(-1)&&(a*=2.55),"rgba"==l[1].toLowerCase().slice(0,4)&&(s=X(o[3])),o[3]&&"%"==o[3].slice(-1)&&(s/=100)),l[5]?(o=l[5][C](nt),i=X(o[0]),"%"==o[0].slice(-1)&&(i*=2.55),n=X(o[1]),"%"==o[1].slice(-1)&&(n*=2.55),a=X(o[2]),"%"==o[2].slice(-1)&&(a*=2.55),("deg"==o[0].slice(-3)||"\xb0"==o[0].slice(-1))&&(i/=360),"hsba"==l[1].toLowerCase().slice(0,4)&&(s=X(o[3])),o[3]&&"%"==o[3].slice(-1)&&(s/=100),t.hsb2rgb(i,n,a,s)):l[6]?(o=l[6][C](nt),i=X(o[0]),"%"==o[0].slice(-1)&&(i*=2.55),n=X(o[1]),"%"==o[1].slice(-1)&&(n*=2.55),a=X(o[2]),"%"==o[2].slice(-1)&&(a*=2.55),("deg"==o[0].slice(-3)||"\xb0"==o[0].slice(-1))&&(i/=360),"hsla"==l[1].toLowerCase().slice(0,4)&&(s=X(o[3])),o[3]&&"%"==o[3].slice(-1)&&(s/=100),t.hsl2rgb(i,n,a,s)):(l={r:i,g:n,b:a},l.hex="#"+(16777216|a|n<<8|i<<16).toString(16).slice(1),t.is(s,"finite")&&(l.opacity=s),l)):{r:-1,g:-1,b:-1,hex:"none",error:1}},t),t.getColor=function(t){var e=this.getColor.start=this.getColor.start||{h:0,s:1,b:t||.75},i=this.hsb2rgb(e.h,e.s,e.b);return e.h+=.075,e.h>1&&(e.h=0,e.s-=.2,e.s<=0&&(this.getColor.start={h:0,s:1,b:e.b})),i.hex},t.getColor.reset=function(){delete this.start},t.parsePathString=i(function(e){if(!e)return null;var i={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},n=[];return t.is(e,V)&&t.is(e[0],V)&&(n=vt(e)),n[D]||_(e)[et](rt,function(t,e,a){var s=[],r=T.call(e);for(a[et](ot,function(t,e){e&&s[W](+e)}),"m"==r&&s[D]>2&&(n[W]([e][b](s.splice(0,2))),r="l",e="m"==e?"l":"L");s[D]>=i[r]&&(n[W]([e][b](s.splice(0,i[r]))),i[r]););}),n[L]=t._path2string,n}),t.findDotsAtSegment=function(t,e,i,n,a,s,r,o,l){var h=1-l,c=j(h,3)*t+3*j(h,2)*l*i+3*h*l*l*a+j(l,3)*r,d=j(h,3)*e+3*j(h,2)*l*n+3*h*l*l*s+j(l,3)*o,u=t+2*l*(i-t)+l*l*(a-2*i+t),p=e+2*l*(n-e)+l*l*(s-2*n+e),f=i+2*l*(a-i)+l*l*(r-2*a+i),g=n+2*l*(s-n)+l*l*(o-2*s+n),m=(1-l)*t+l*i,v=(1-l)*e+l*n,y=(1-l)*a+l*r,b=(1-l)*s+l*o,w=90-180*I.atan((u-f)/(p-g))/B;return(u>f||g>p)&&(w+=180),{x:c,y:d,m:{x:u,y:p},n:{x:f,y:g},start:{x:m,y:v},end:{x:y,y:b},alpha:w}};var mt=i(function(t){if(!t)return{x:0,y:0,width:0,height:0};t=kt(t);for(var e,i=0,n=0,a=[],s=[],r=0,o=t[D];o>r;r++)if(e=t[r],"M"==e[0])i=e[1],n=e[2],a[W](i),s[W](n);else{var l=Ct(i,n,e[1],e[2],e[3],e[4],e[5],e[6]);a=a[b](l.min.x,l.max.x),s=s[b](l.min.y,l.max.y),i=e[5],n=e[6]}var h=A[y](0,a),c=A[y](0,s);return{x:h,y:c,width:P[y](0,a)-h,height:P[y](0,s)-c}}),vt=function(e){var i=[];t.is(e,V)&&t.is(e&&e[0],V)||(e=t.parsePathString(e));for(var n=0,a=e[D];a>n;n++){i[n]=[];for(var s=0,r=e[n][D];r>s;s++)i[n][s]=e[n][s]}return i[L]=t._path2string,i},yt=i(function(e){t.is(e,V)&&t.is(e&&e[0],V)||(e=t.parsePathString(e));var i=[],n=0,a=0,s=0,r=0,o=0;"M"==e[0][0]&&(n=e[0][1],a=e[0][2],s=n,r=a,o++,i[W](["M",n,a]));for(var l=o,h=e[D];h>l;l++){var c=i[l]=[],d=e[l];if(d[0]!=T.call(d[0]))switch(c[0]=T.call(d[0]),c[0]){case"a":c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=+(d[6]-n).toFixed(3),c[7]=+(d[7]-a).toFixed(3);break;case"v":c[1]=+(d[1]-a).toFixed(3);break;case"m":s=d[1],r=d[2];default:for(var u=1,p=d[D];p>u;u++)c[u]=+(d[u]-(u%2?n:a)).toFixed(3)}else{c=i[l]=[],"m"==d[0]&&(s=d[1]+n,r=d[2]+a);for(var f=0,g=d[D];g>f;f++)i[l][f]=d[f]}var m=i[l][D];switch(i[l][0]){case"z":n=s,a=r;break;case"h":n+=+i[l][m-1];break;case"v":a+=+i[l][m-1];break;default:n+=+i[l][m-2],a+=+i[l][m-1]}}return i[L]=t._path2string,i},0,vt),bt=i(function(e){t.is(e,V)&&t.is(e&&e[0],V)||(e=t.parsePathString(e));var i=[],n=0,a=0,s=0,r=0,o=0;"M"==e[0][0]&&(n=+e[0][1],a=+e[0][2],s=n,r=a,o++,i[0]=["M",n,a]);for(var l=o,h=e[D];h>l;l++){var c=i[l]=[],d=e[l];if(d[0]!=K.call(d[0]))switch(c[0]=K.call(d[0]),c[0]){case"A":c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=+(d[6]+n),c[7]=+(d[7]+a);break;case"V":c[1]=+d[1]+a;break;case"H":c[1]=+d[1]+n;break;case"M":s=+d[1]+n,r=+d[2]+a;default:for(var u=1,p=d[D];p>u;u++)c[u]=+d[u]+(u%2?n:a)}else for(var f=0,g=d[D];g>f;f++)i[l][f]=d[f];switch(c[0]){case"Z":n=s,a=r;break;case"H":n=c[1];break;case"V":a=c[1];break;case"M":s=i[l][i[l][D]-2],r=i[l][i[l][D]-1];default:n=i[l][i[l][D]-2],a=i[l][i[l][D]-1]}}return i[L]=t._path2string,i},null,vt),wt=function(t,e,i,n){return[t,e,i,n,i,n]},xt=function(t,e,i,n,a,s){var r=1/3,o=2/3;return[r*t+o*i,r*e+o*n,r*a+o*i,r*s+o*n,a,s]},$t=function(t,e,n,a,s,r,o,l,h,c){var d,u=120*B/180,p=B/180*(+s||0),f=[],g=i(function(t,e,i){var n=t*I.cos(i)-e*I.sin(i),a=t*I.sin(i)+e*I.cos(i);return{x:n,y:a}});if(c)S=c[0],T=c[1],_=c[2],k=c[3];else{d=g(t,e,-p),t=d.x,e=d.y,d=g(l,h,-p),l=d.x,h=d.y;var m=(I.cos(B/180*s),I.sin(B/180*s),(t-l)/2),v=(e-h)/2,y=m*m/(n*n)+v*v/(a*a);y>1&&(y=I.sqrt(y),n=y*n,a=y*a);var w=n*n,x=a*a,$=(r==o?-1:1)*I.sqrt(R((w*x-w*v*v-x*m*m)/(w*v*v+x*m*m))),_=$*n*v/a+(t+l)/2,k=$*-a*m/n+(e+h)/2,S=I.asin(((e-k)/a).toFixed(9)),T=I.asin(((h-k)/a).toFixed(9));S=_>t?B-S:S,T=_>l?B-T:T,0>S&&(S=2*B+S),0>T&&(T=2*B+T),o&&S>T&&(S-=2*B),!o&&T>S&&(T-=2*B)}var P=T-S;if(R(P)>u){var A=T,j=l,E=h;T=S+u*(o&&T>S?1:-1),l=_+n*I.cos(T),h=k+a*I.sin(T),f=$t(l,h,n,a,s,0,o,j,E,[T,A,_,k])}P=T-S;var F=I.cos(S),V=I.sin(S),L=I.cos(T),N=I.sin(T),O=I.tan(P/4),W=4/3*n*O,z=4/3*a*O,H=[t,e],U=[t+W*V,e-z*F],G=[l+W*N,h-z*L],q=[l,h];if(U[0]=2*H[0]-U[0],U[1]=2*H[1]-U[1],c)return[U,G,q][b](f);f=[U,G,q][b](f)[M]()[C](",");for(var Y=[],X=0,Z=f[D];Z>X;X++)Y[X]=X%2?g(f[X-1],f[X],p).y:g(f[X],f[X+1],p).x;return Y},_t=function(t,e,i,n,a,s,r,o,l){var h=1-l;return{x:j(h,3)*t+3*j(h,2)*l*i+3*h*l*l*a+j(l,3)*r,y:j(h,3)*e+3*j(h,2)*l*n+3*h*l*l*s+j(l,3)*o}},Ct=i(function(t,e,i,n,a,s,r,o){var l,h=a-2*i+t-(r-2*a+i),c=2*(i-t)-2*(a-i),d=t-i,u=(-c+I.sqrt(c*c-4*h*d))/2/h,p=(-c-I.sqrt(c*c-4*h*d))/2/h,f=[e,o],g=[t,r];return R(u)>"1e12"&&(u=.5),R(p)>"1e12"&&(p=.5),u>0&&1>u&&(l=_t(t,e,i,n,a,s,r,o,u),g[W](l.x),f[W](l.y)),p>0&&1>p&&(l=_t(t,e,i,n,a,s,r,o,p),g[W](l.x),f[W](l.y)),h=s-2*n+e-(o-2*s+n),c=2*(n-e)-2*(s-n),d=e-n,u=(-c+I.sqrt(c*c-4*h*d))/2/h,p=(-c-I.sqrt(c*c-4*h*d))/2/h,R(u)>"1e12"&&(u=.5),R(p)>"1e12"&&(p=.5),u>0&&1>u&&(l=_t(t,e,i,n,a,s,r,o,u),g[W](l.x),f[W](l.y)),p>0&&1>p&&(l=_t(t,e,i,n,a,s,r,o,p),g[W](l.x),f[W](l.y)),{min:{x:A[y](0,g),y:A[y](0,f)},max:{x:P[y](0,g),y:P[y](0,f)}}}),kt=i(function(t,e){for(var i=bt(t),n=e&&bt(e),a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},r=(function(t,e){var i,n;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"][b]($t[y](0,[e.x,e.y][b](t.slice(1))));break;case"S":i=e.x+(e.x-(e.bx||e.x)),n=e.y+(e.y-(e.by||e.y)),t=["C",i,n][b](t.slice(1));break;case"T":e.qx=e.x+(e.x-(e.qx||e.x)),e.qy=e.y+(e.y-(e.qy||e.y)),t=["C"][b](xt(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"][b](xt(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"][b](wt(e.x,e.y,t[1],t[2]));break;case"H":t=["C"][b](wt(e.x,e.y,t[1],e.y));break;case"V":t=["C"][b](wt(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"][b](wt(e.x,e.y,e.X,e.Y))}return t}),o=function(t,e){if(t[e][D]>7){t[e].shift();for(var a=t[e];a[D];)t.splice(e++,0,["C"][b](a.splice(0,6)));t.splice(e,1),c=P(i[D],n&&n[D]||0)}},l=function(t,e,a,s,r){t&&e&&"M"==t[r][0]&&"M"!=e[r][0]&&(e.splice(r,0,["M",s.x,s.y]),a.bx=0,a.by=0,a.x=t[r][1],a.y=t[r][2],c=P(i[D],n&&n[D]||0))},h=0,c=P(i[D],n&&n[D]||0);c>h;h++){i[h]=r(i[h],a),o(i,h),n&&(n[h]=r(n[h],s)),n&&o(n,h),l(i,n,a,s,h),l(n,i,s,a,h);var d=i[h],u=n&&n[h],p=d[D],f=n&&u[D];a.x=d[p-2],a.y=d[p-1],a.bx=X(d[p-4])||a.x,a.by=X(d[p-3])||a.y,s.bx=n&&(X(u[f-4])||s.x),s.by=n&&(X(u[f-3])||s.y),s.x=n&&u[f-2],s.y=n&&u[f-1]}return n?[i,n]:i},null,vt),St=i(function(e){for(var i=[],n=0,a=e[D];a>n;n++){var s={},r=e[n].match(/^([^:]*):?([\d\.]*)/);if(s.color=t.getRGB(r[1]),s.color.error)return null;s.color=s.color.hex,r[2]&&(s.offset=r[2]+"%"),i[W](s)}for(n=1,a=i[D]-1;a>n;n++)if(!i[n].offset){for(var o=X(i[n-1].offset||0),l=0,h=n+1;a>h;h++)if(i[h].offset){l=i[h].offset;break}l||(l=100,h=a),l=X(l);for(var c=(l-o)/(h-n+1);h>n;n++)o+=c,i[n].offset=o+"%"}return i}),Mt=function(e,i,n,a){var s;return t.is(e,F)||t.is(e,"object")?(s=t.is(e,F)?p.getElementById(e):e,s.tagName?null==i?{container:s,width:s.style.pixelWidth||s.offsetWidth,height:s.style.pixelHeight||s.offsetHeight}:{container:s,width:i,height:n}:void 0):{container:1,x:e,y:i,width:n,height:a}},Dt=function(t,e){var i=this;for(var n in e)if(e[u](n)&&!(n in t))switch(typeof e[n]){case"function":!function(e){t[n]=t===i?e:function(){return e[y](i,arguments)}}(e[n]);break;case"object":t[n]=t[n]||{},Dt.call(this,t[n],e[n]);break;default:t[n]=e[n]}},Tt=function(t,e){t==e.top&&(e.top=t.prev),t==e.bottom&&(e.bottom=t.next),t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next)},It=function(t,e){e.top!==t&&(Tt(t,e),t.next=null,t.prev=e.top,e.top.next=t,e.top=t)},Pt=function(t,e){e.bottom!==t&&(Tt(t,e),t.next=e.bottom,t.prev=null,e.bottom.prev=t,e.bottom=t)},At=function(t,e,i){Tt(t,i),e==i.top&&(i.top=t),e.next&&(e.next.prev=t),t.next=e.next,t.prev=e,e.next=t},Rt=function(t,e,i){Tt(t,i),e==i.bottom&&(i.bottom=t),e.prev&&(e.prev.next=t),t.prev=e.prev,e.prev=t,t.next=e},jt=function(t){return function(){throw new Error("Rapha\xebl: you are calling to method \u201c"+t+"\u201d of removed object")}};if(t.pathToRelative=yt,t.svg){o.svgns="http://www.w3.org/2000/svg",o.xlink="http://www.w3.org/1999/xlink",q=function(t){return+t+.5*(~~t===t)};var Bt=function(t,e){if(!e)return t=p.createElementNS(o.svgns,t),t.style.webkitTapHighlightColor="rgba(0,0,0,0)",t;for(var i in e)e[u](i)&&t[Y](i,_(e[i]))};t[L]=function(){return"Your browser supports SVG.\nYou are running Rapha\xebl "+this.version};var Et=function(t,e){var i=Bt("path");e.canvas&&e.canvas[v](i);var n=new Wt(i,e);return n.type="path",Lt(n,{fill:"none",stroke:"#000",path:t}),n},Ft=function(t,i,n){var a="linear",s=.5,r=.5,o=t.style;if(i=_(i)[et](lt,function(t,e,i){if(a="radial",e&&i){s=X(e),r=X(i);var n=2*(r>.5)-1;j(s-.5,2)+j(r-.5,2)>.25&&(r=I.sqrt(.25-j(s-.5,2))*n+.5)&&.5!=r&&(r=r.toFixed(5)-1e-5*n)}return x}),i=i[C](/\s*\-\s*/),"linear"==a){var l=i.shift();if(l=-X(l),isNaN(l))return null;var h=[0,0,I.cos(l*B/180),I.sin(l*B/180)],c=1/(P(R(h[2]),R(h[3]))||1);h[2]*=c,h[3]*=c,h[2]<0&&(h[0]=-h[2],h[2]=0),h[3]<0&&(h[1]=-h[3],h[3]=0)}var d=St(i);if(!d)return null;var u=t.getAttribute(N);u=u.match(/^url\(#(.*)\)$/),u&&n.defs.removeChild(p.getElementById(u[1]));var f=Bt(a+"Gradient");f.id=e(),Bt(f,"radial"==a?{fx:s,fy:r}:{x1:h[0],y1:h[1],x2:h[2],y2:h[3]}),n.defs[v](f);for(var g=0,m=d[D];m>g;g++){var y=Bt("stop");Bt(y,{offset:d[g].offset?d[g].offset:g?"100%":"0%","stop-color":d[g].color||"#fff"}),f[v](y)}return Bt(t,{fill:"url(#"+f.id+")",opacity:1,"fill-opacity":1}),o.fill=x,o.opacity=1,o.fillOpacity=1,1},Vt=function(e){var i=e.getBBox();Bt(e.pattern,{patternTransform:t.format("translate({0},{1})",i.x,i.y)})},Lt=function(i,n){var a={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},s=i.node,r=i.attrs,o=i.rotate(),h=function(t,e){if(e=a[T.call(e)]){for(var i=t.attrs["stroke-width"]||"1",r={round:i,square:i,butt:0}[t.attrs["stroke-linecap"]||n["stroke-linecap"]]||0,o=[],l=e[D];l--;)o[l]=e[l]*i+(l%2?1:-1)*r;Bt(s,{"stroke-dasharray":o[M](",")})}};n[u]("rotation")&&(o=n.rotation);var c=_(o)[C](l);c.length-1?(c[1]=+c[1],c[2]=+c[2]):c=null,X(o)&&i.rotate(0,!0);for(var d in n)if(n[u](d)){if(!J[u](d))continue;var f=n[d];switch(r[d]=f,d){case"blur":i.blur(f);break;case"rotation":i.rotate(f,!0);break;case"href":case"title":case"target":var g=s.parentNode;if("a"!=T.call(g.tagName)){var m=Bt("a");g.insertBefore(m,s),m[v](s),g=m}"target"==d&&"blank"==f?g.setAttributeNS(i.paper.xlink,"show","new"):g.setAttributeNS(i.paper.xlink,d,f);break;case"cursor":s.style.cursor=f;break;case"clip-rect":var y=_(f)[C](l);if(4==y[D]){i.clip&&i.clip.parentNode.parentNode.removeChild(i.clip.parentNode);var b=Bt("clipPath"),w=Bt("rect");b.id=e(),Bt(w,{x:y[0],y:y[1],width:y[2],height:y[3]}),b[v](w),i.paper.defs[v](b),Bt(s,{"clip-path":"url(#"+b.id+")"}),i.clip=w}if(!f){var k=p.getElementById(s.getAttribute("clip-path")[et](/(^url\(#|\)$)/g,x));k&&k.parentNode.removeChild(k),Bt(s,{"clip-path":x}),delete i.clip}break;case"path":"path"==i.type&&Bt(s,{d:f?r.path=bt(f):"M0,0"});break;case"width":if(s[Y](d,f),!r.fx)break;d="x",f=r.x;case"x":r.fx&&(f=-r.x-(r.width||0));case"rx":if("rx"==d&&"rect"==i.type)break;case"cx":c&&("x"==d||"cx"==d)&&(c[1]+=f-r[d]),s[Y](d,f),i.pattern&&Vt(i);break;case"height":if(s[Y](d,f),!r.fy)break;d="y",f=r.y;case"y":r.fy&&(f=-r.y-(r.height||0));case"ry":if("ry"==d&&"rect"==i.type)break;case"cy":c&&("y"==d||"cy"==d)&&(c[2]+=f-r[d]),s[Y](d,f),i.pattern&&Vt(i);break;case"r":"rect"==i.type?Bt(s,{rx:f,ry:f}):s[Y](d,f);break;case"src":"image"==i.type&&s.setAttributeNS(i.paper.xlink,"href",f);break;case"stroke-width":s.style.strokeWidth=f,s[Y](d,f),r["stroke-dasharray"]&&h(i,r["stroke-dasharray"]);break;case"stroke-dasharray":h(i,f);break;case"translation":var S=_(f)[C](l);S[0]=+S[0]||0,S[1]=+S[1]||0,c&&(c[1]+=S[0],c[2]+=S[1]),Me.call(i,S[0],S[1]);break;case"scale":S=_(f)[C](l),i.scale(+S[0]||1,+S[1]||+S[0]||1,isNaN(X(S[2]))?null:+S[2],isNaN(X(S[3]))?null:+S[3]);break;case N:var I=_(f).match(z);if(I){b=Bt("pattern");var P=Bt("image");b.id=e(),Bt(b,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),Bt(P,{x:0,y:0}),P.setAttributeNS(i.paper.xlink,"href",I[1]),b[v](P);var A=p.createElement("img");A.style.cssText="position:absolute;left:-9999em;top-9999em",A.onload=function(){Bt(b,{width:this.offsetWidth,height:this.offsetHeight}),Bt(P,{width:this.offsetWidth,height:this.offsetHeight}),p.body.removeChild(this),i.paper.safari()},p.body[v](A),A.src=I[1],i.paper.defs[v](b),s.style.fill="url(#"+b.id+")",Bt(s,{fill:"url(#"+b.id+")"}),i.pattern=b,i.pattern&&Vt(i);break}var R=t.getRGB(f);if(R.error){if(({circle:1,ellipse:1}[u](i.type)||"r"!=_(f).charAt())&&Ft(s,f,i.paper)){r.gradient=f,r.fill="none";break}}else delete n.gradient,delete r.gradient,!t.is(r.opacity,"undefined")&&t.is(n.opacity,"undefined")&&Bt(s,{opacity:r.opacity}),!t.is(r["fill-opacity"],"undefined")&&t.is(n["fill-opacity"],"undefined")&&Bt(s,{"fill-opacity":r["fill-opacity"]});R[u]("opacity")&&Bt(s,{"fill-opacity":R.opacity>1?R.opacity/100:R.opacity});case"stroke":R=t.getRGB(f),s[Y](d,R.hex),"stroke"==d&&R[u]("opacity")&&Bt(s,{"stroke-opacity":R.opacity>1?R.opacity/100:R.opacity});break;case"gradient":(({circle:1,ellipse:1})[u](i.type)||"r"!=_(f).charAt())&&Ft(s,f,i.paper);break;case"opacity":r.gradient&&!r[u]("stroke-opacity")&&Bt(s,{"stroke-opacity":f>1?f/100:f});case"fill-opacity":if(r.gradient){var j=p.getElementById(s.getAttribute(N)[et](/^url\(#|\)$/g,x));if(j){var B=j.getElementsByTagName("stop");B[B[D]-1][Y]("stop-opacity",f)}break}default:"font-size"==d&&(f=Z(f,10)+"px");var E=d[et](/(\-.)/g,function(t){return K.call(t.substring(1))});s.style[E]=f,s[Y](d,f)}}Ot(i,n),c?i.rotate(c.join($)):X(o)&&i.rotate(o,!0)},Nt=1.2,Ot=function(e,i){if("text"==e.type&&(i[u]("text")||i[u]("font")||i[u]("font-size")||i[u]("x")||i[u]("y"))){var n=e.attrs,a=e.node,s=a.firstChild?Z(p.defaultView.getComputedStyle(a.firstChild,x).getPropertyValue("font-size"),10):10;if(i[u]("text")){for(n.text=i.text;a.firstChild;)a.removeChild(a.firstChild);for(var r=_(i.text)[C]("\n"),o=0,l=r[D];l>o;o++)if(r[o]){var h=Bt("tspan");o&&Bt(h,{dy:s*Nt,x:n.x}),h[v](p.createTextNode(r[o])),a[v](h)}}else for(r=a.getElementsByTagName("tspan"),o=0,l=r[D];l>o;o++)o&&Bt(r[o],{dy:s*Nt,x:n.x});Bt(a,{y:n.y});var c=e.getBBox(),d=n.y-(c.y+c.height/2);d&&t.is(d,"finite")&&Bt(a,{y:n.y+d})}},Wt=function(e,i){this[0]=e,this.id=t._oid++,this.node=e,e.raphael=this,this.paper=i,this.attrs=this.attrs||{},this.transformations=[],this._={tx:0,ty:0,rt:{deg:0,cx:0,cy:0},sx:1,sy:1},!i.bottom&&(i.bottom=this),this.prev=i.top,i.top&&(i.top.next=this),i.top=this,this.next=null},zt=Wt[d];Wt[d].rotate=function(e,i,n){if(this.removed)return this;if(null==e)return this._.rt.cx?[this._.rt.deg,this._.rt.cx,this._.rt.cy][M]($):this._.rt.deg;var a=this.getBBox();return e=_(e)[C](l),e[D]-1&&(i=X(e[1]),n=X(e[2])),e=X(e[0]),null!=i&&i!==!1?this._.rt.deg=e:this._.rt.deg+=e,null==n&&(i=null),this._.rt.cx=i,this._.rt.cy=n,i=null==i?a.x+a.width/2:i,n=null==n?a.y+a.height/2:n,this._.rt.deg?(this.transformations[0]=t.format("rotate({0} {1} {2})",this._.rt.deg,i,n),this.clip&&Bt(this.clip,{transform:t.format("rotate({0} {1} {2})",-this._.rt.deg,i,n)})):(this.transformations[0]=x,this.clip&&Bt(this.clip,{transform:x})),Bt(this.node,{transform:this.transformations[M]($)}),this},Wt[d].hide=function(){return!this.removed&&(this.node.style.display="none"),this},Wt[d].show=function(){return!this.removed&&(this.node.style.display=""),this},Wt[d].remove=function(){if(!this.removed){Tt(this,this.paper),this.node.parentNode.removeChild(this.node);for(var t in this)delete this[t];this.removed=!0}},Wt[d].getBBox=function(){if(this.removed)return this;if("path"==this.type)return mt(this.attrs.path);if("none"==this.node.style.display){this.show();var t=!0}var e={};try{e=this.node.getBBox()}catch(i){}finally{e=e||{}}if("text"==this.type){e={x:e.x,y:1/0,width:0,height:0};for(var n=0,a=this.node.getNumberOfChars();a>n;n++){var s=this.node.getExtentOfChar(n);s.y<e.y&&(e.y=s.y),s.y+s.height-e.y>e.height&&(e.height=s.y+s.height-e.y),s.x+s.width-e.x>e.width&&(e.width=s.x+s.width-e.x)}}return t&&this.hide(),e},Wt[d].attr=function(e,i){if(this.removed)return this;if(null==e){var n={};for(var a in this.attrs)this.attrs[u](a)&&(n[a]=this.attrs[a]);return this._.rt.deg&&(n.rotation=this.rotate()),(1!=this._.sx||1!=this._.sy)&&(n.scale=this.scale()),n.gradient&&"none"==n.fill&&(n.fill=n.gradient)&&delete n.gradient,n}if(null==i&&t.is(e,F))return"translation"==e?Me.call(this):"rotation"==e?this.rotate():"scale"==e?this.scale():e==N&&"none"==this.attrs.fill&&this.attrs.gradient?this.attrs.gradient:this.attrs[e];if(null==i&&t.is(e,V)){for(var s={},r=0,o=e.length;o>r;r++)s[e[r]]=this.attr(e[r]);return s}if(null!=i){var l={};l[e]=i}else null!=e&&t.is(e,"object")&&(l=e);for(var h in this.paper.customAttributes)if(this.paper.customAttributes[u](h)&&l[u](h)&&t.is(this.paper.customAttributes[h],"function")){var c=this.paper.customAttributes[h].apply(this,[][b](l[h]));this.attrs[h]=l[h];for(var d in c)c[u](d)&&(l[d]=c[d])}return Lt(this,l),this},Wt[d].toFront=function(){if(this.removed)return this;this.node.parentNode[v](this.node);var t=this.paper;return t.top!=this&&It(this,t),this},Wt[d].toBack=function(){if(this.removed)return this;if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),Pt(this,this.paper);this.paper}return this},Wt[d].insertAfter=function(t){if(this.removed)return this;var e=t.node||t[t.length-1].node;return e.nextSibling?e.parentNode.insertBefore(this.node,e.nextSibling):e.parentNode[v](this.node),At(this,t,this.paper),this},Wt[d].insertBefore=function(t){if(this.removed)return this;var e=t.node||t[0].node;return e.parentNode.insertBefore(this.node,e),Rt(this,t,this.paper),this},Wt[d].blur=function(t){var i=this;if(0!==+t){var n=Bt("filter"),a=Bt("feGaussianBlur");i.attrs.blur=t,n.id=e(),Bt(a,{stdDeviation:+t||1.5}),n.appendChild(a),i.paper.defs.appendChild(n),i._blur=n,Bt(i.node,{filter:"url(#"+n.id+")"})}else i._blur&&(i._blur.parentNode.removeChild(i._blur),delete i._blur,delete i.attrs.blur),i.node.removeAttribute("filter")};var Ht=function(t,e,i,n){var a=Bt("circle");t.canvas&&t.canvas[v](a);var s=new Wt(a,t);return s.attrs={cx:e,cy:i,r:n,fill:"none",stroke:"#000"},s.type="circle",Bt(a,s.attrs),s},Ut=function(t,e,i,n,a,s){var r=Bt("rect");t.canvas&&t.canvas[v](r);var o=new Wt(r,t);return o.attrs={x:e,y:i,width:n,height:a,r:s||0,rx:s||0,ry:s||0,fill:"none",stroke:"#000"},o.type="rect",Bt(r,o.attrs),o},Gt=function(t,e,i,n,a){var s=Bt("ellipse");t.canvas&&t.canvas[v](s);var r=new Wt(s,t);return r.attrs={cx:e,cy:i,rx:n,ry:a,fill:"none",stroke:"#000"},r.type="ellipse",Bt(s,r.attrs),r},qt=function(t,e,i,n,a,s){var r=Bt("image");Bt(r,{x:i,y:n,width:a,height:s,preserveAspectRatio:"none"}),r.setAttributeNS(t.xlink,"href",e),t.canvas&&t.canvas[v](r);var o=new Wt(r,t);return o.attrs={x:i,y:n,width:a,height:s,src:e},o.type="image",o},Yt=function(t,e,i,n){var a=Bt("text");Bt(a,{x:e,y:i,"text-anchor":"middle"}),t.canvas&&t.canvas[v](a);var s=new Wt(a,t);return s.attrs={x:e,y:i,"text-anchor":"middle",text:n,font:J.font,stroke:"none",fill:"#000"},s.type="text",Lt(s,s.attrs),s},Xt=function(t,e){return this.width=t||this.width,this.height=e||this.height,this.canvas[Y]("width",this.width),this.canvas[Y]("height",this.height),this},Zt=function(){var e=Mt[y](0,arguments),i=e&&e.container,n=e.x,a=e.y,s=e.width,r=e.height;if(!i)throw new Error("SVG container not found.");var o=Bt("svg");return n=n||0,a=a||0,s=s||512,r=r||342,Bt(o,{xmlns:"http://www.w3.org/2000/svg",version:1.1,width:s,height:r}),1==i?(o.style.cssText="position:absolute;left:"+n+"px;top:"+a+"px",p.body[v](o)):i.firstChild?i.insertBefore(o,i.firstChild):i[v](o),i=new m,i.width=s,i.height=r,i.canvas=o,Dt.call(i,i,t.fn),i.clear(),i};o.clear=function(){for(var t=this.canvas;t.firstChild;)t.removeChild(t.firstChild);this.bottom=this.top=null,(this.desc=Bt("desc"))[v](p.createTextNode("Created with Rapha\xebl")),t[v](this.desc),t[v](this.defs=Bt("defs"))},o.remove=function(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var t in this)this[t]=jt(t)}}if(t.vml){var Qt={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},Kt=/([clmz]),?([^clmz]*)/gi,Jt=/ progid:\S+Blur\([^\)]+\)/g,te=/-?[^,\s-]+/g,ee=1e3+$+1e3,ie=10,ne={path:1,rect:1},ae=function(t){var e=/[ahqstv]/gi,i=bt;if(_(t).match(e)&&(i=kt),e=/[clmz]/g,i==bt&&!_(t).match(e)){var n=_(t)[et](Kt,function(t,e,i){var n=[],a="m"==T.call(e),s=Qt[e];return i[et](te,function(t){a&&2==n[D]&&(s+=n+Qt["m"==e?"l":"L"],n=[]),n[W](q(t*ie))}),s+n});return n}var a,s,r=i(t);n=[];for(var o=0,l=r[D];l>o;o++){a=r[o],s=T.call(r[o][0]),"z"==s&&(s="x");for(var h=1,c=a[D];c>h;h++)s+=q(a[h]*ie)+(h!=c-1?",":x);n[W](s)}return n[M]($)};t[L]=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\xebl "+this.version},Et=function(t,e){var i=se("group");i.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px",i.coordsize=e.coordsize,i.coordorigin=e.coordorigin;var n=se("shape"),a=n.style;a.width=e.width+"px",a.height=e.height+"px",n.coordsize=ee,n.coordorigin=e.coordorigin,i[v](n);var s=new Wt(n,i,e),r={fill:"none",stroke:"#000"};return t&&(r.path=t),s.type="path",s.path=[],s.Path=x,Lt(s,r),e.canvas[v](i),s},Lt=function(e,i){e.attrs=e.attrs||{};var a,s=e.node,r=e.attrs,o=s.style,h=(i.x!=r.x||i.y!=r.y||i.width!=r.width||i.height!=r.height||i.r!=r.r)&&"rect"==e.type,c=e;for(var d in i)i[u](d)&&(r[d]=i[d]);if(h&&(r.path=n(r.x,r.y,r.width,r.height,r.r),e.X=r.x,e.Y=r.y,e.W=r.width,e.H=r.height),i.href&&(s.href=i.href),i.title&&(s.title=i.title),i.target&&(s.target=i.target),i.cursor&&(o.cursor=i.cursor),"blur"in i&&e.blur(i.blur),(i.path&&"path"==e.type||h)&&(s.path=ae(r.path)),null!=i.rotation&&e.rotate(i.rotation,!0),i.translation&&(a=_(i.translation)[C](l),Me.call(e,a[0],a[1]),null!=e._.rt.cx&&(e._.rt.cx+=+a[0],e._.rt.cy+=+a[1],e.setBox(e.attrs,a[0],a[1]))),i.scale&&(a=_(i.scale)[C](l),e.scale(+a[0]||1,+a[1]||+a[0]||1,+a[2]||null,+a[3]||null)),"clip-rect"in i){var f=_(i["clip-rect"])[C](l);if(4==f[D]){f[2]=+f[2]+ +f[0],f[3]=+f[3]+ +f[1];var g=s.clipRect||p.createElement("div"),m=g.style,y=s.parentNode;m.clip=t.format("rect({1}px {2}px {3}px {0}px)",f),s.clipRect||(m.position="absolute",m.top=0,m.left=0,m.width=e.paper.width+"px",m.height=e.paper.height+"px",y.parentNode.insertBefore(g,y),g[v](y),s.clipRect=g)}i["clip-rect"]||s.clipRect&&(s.clipRect.style.clip=x)}if("image"==e.type&&i.src&&(s.src=i.src),"image"==e.type&&i.opacity&&(s.filterOpacity=Q+".Alpha(opacity="+100*i.opacity+")",o.filter=(s.filterMatrix||x)+(s.filterOpacity||x)),i.font&&(o.font=i.font),i["font-family"]&&(o.fontFamily='"'+i["font-family"][C](",")[0][et](/^['"]+|['"]+$/g,x)+'"'),i["font-size"]&&(o.fontSize=i["font-size"]),i["font-weight"]&&(o.fontWeight=i["font-weight"]),i["font-style"]&&(o.fontStyle=i["font-style"]),null!=i.opacity||null!=i["stroke-width"]||null!=i.fill||null!=i.stroke||null!=i["stroke-width"]||null!=i["stroke-opacity"]||null!=i["fill-opacity"]||null!=i["stroke-dasharray"]||null!=i["stroke-miterlimit"]||null!=i["stroke-linejoin"]||null!=i["stroke-linecap"]){s=e.shape||s;var b=s.getElementsByTagName(N)&&s.getElementsByTagName(N)[0],w=!1;if(!b&&(w=b=se(N)),"fill-opacity"in i||"opacity"in i){var $=((+r["fill-opacity"]+1||2)-1)*((+r.opacity+1||2)-1)*((+t.getRGB(i.fill).o+1||2)-1);$=A(P($,0),1),b.opacity=$}if(i.fill&&(b.on=!0),(null==b.on||"none"==i.fill)&&(b.on=!1),b.on&&i.fill){var k=i.fill.match(z);k?(b.src=k[1],b.type="tile"):(b.color=t.getRGB(i.fill).hex,b.src=x,b.type="solid",t.getRGB(i.fill).error&&(c.type in{circle:1,ellipse:1}||"r"!=_(i.fill).charAt())&&Ft(c,i.fill)&&(r.fill="none",r.gradient=i.fill))}w&&s[v](b);var S=s.getElementsByTagName("stroke")&&s.getElementsByTagName("stroke")[0],M=!1;!S&&(M=S=se("stroke")),(i.stroke&&"none"!=i.stroke||i["stroke-width"]||null!=i["stroke-opacity"]||i["stroke-dasharray"]||i["stroke-miterlimit"]||i["stroke-linejoin"]||i["stroke-linecap"])&&(S.on=!0),
("none"==i.stroke||null==S.on||0==i.stroke||0==i["stroke-width"])&&(S.on=!1);var T=t.getRGB(i.stroke);S.on&&i.stroke&&(S.color=T.hex),$=((+r["stroke-opacity"]+1||2)-1)*((+r.opacity+1||2)-1)*((+T.o+1||2)-1);var I=.75*(X(i["stroke-width"])||1);if($=A(P($,0),1),null==i["stroke-width"]&&(I=r["stroke-width"]),i["stroke-width"]&&(S.weight=I),I&&1>I&&($*=I)&&(S.weight=1),S.opacity=$,i["stroke-linejoin"]&&(S.joinstyle=i["stroke-linejoin"]||"miter"),S.miterlimit=i["stroke-miterlimit"]||8,i["stroke-linecap"]&&(S.endcap="butt"==i["stroke-linecap"]?"flat":"square"==i["stroke-linecap"]?"square":"round"),i["stroke-dasharray"]){var R={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};S.dashstyle=R[u](i["stroke-dasharray"])?R[i["stroke-dasharray"]]:x}M&&s[v](S)}if("text"==c.type)switch(o=c.paper.span.style,r.font&&(o.font=r.font),r["font-family"]&&(o.fontFamily=r["font-family"]),r["font-size"]&&(o.fontSize=r["font-size"]),r["font-weight"]&&(o.fontWeight=r["font-weight"]),r["font-style"]&&(o.fontStyle=r["font-style"]),c.node.string&&(c.paper.span.innerHTML=_(c.node.string)[et](/</g,"&#60;")[et](/&/g,"&#38;")[et](/\n/g,"<br>")),c.W=r.w=c.paper.span.offsetWidth,c.H=r.h=c.paper.span.offsetHeight,c.X=r.x,c.Y=r.y+q(c.H/2),r["text-anchor"]){case"start":c.node.style["v-text-align"]="left",c.bbx=q(c.W/2);break;case"end":c.node.style["v-text-align"]="right",c.bbx=-q(c.W/2);break;default:c.node.style["v-text-align"]="center"}},Ft=function(t,e){t.attrs=t.attrs||{};var i,n=(t.attrs,"linear"),a=".5 .5";if(t.attrs.gradient=e,e=_(e)[et](lt,function(t,e,i){return n="radial",e&&i&&(e=X(e),i=X(i),j(e-.5,2)+j(i-.5,2)>.25&&(i=I.sqrt(.25-j(e-.5,2))*(2*(i>.5)-1)+.5),a=e+$+i),x}),e=e[C](/\s*\-\s*/),"linear"==n){var s=e.shift();if(s=-X(s),isNaN(s))return null}var r=St(e);if(!r)return null;if(t=t.shape||t.node,i=t.getElementsByTagName(N)[0]||se(N),!i.parentNode&&t.appendChild(i),r[D]){i.on=!0,i.method="none",i.color=r[0].color,i.color2=r[r[D]-1].color;for(var o=[],l=0,h=r[D];h>l;l++)r[l].offset&&o[W](r[l].offset+$+r[l].color);i.colors&&(i.colors.value=o[D]?o[M]():"0% "+i.color),"radial"==n?(i.type="gradientradial",i.focus="100%",i.focussize=a,i.focusposition=a):(i.type="gradient",i.angle=(270-s)%360)}return 1},Wt=function(e,i,n){this[0]=e,this.id=t._oid++,this.node=e,e.raphael=this,this.X=0,this.Y=0,this.attrs={},this.Group=i,this.paper=n,this._={tx:0,ty:0,rt:{deg:0},sx:1,sy:1},!n.bottom&&(n.bottom=this),this.prev=n.top,n.top&&(n.top.next=this),n.top=this,this.next=null},zt=Wt[d],zt.rotate=function(t,e,i){return this.removed?this:null==t?this._.rt.cx?[this._.rt.deg,this._.rt.cx,this._.rt.cy][M]($):this._.rt.deg:(t=_(t)[C](l),t[D]-1&&(e=X(t[1]),i=X(t[2])),t=X(t[0]),null!=e?this._.rt.deg=t:this._.rt.deg+=t,null==i&&(e=null),this._.rt.cx=e,this._.rt.cy=i,this.setBox(this.attrs,e,i),this.Group.style.rotation=this._.rt.deg,this)},zt.setBox=function(t,e,i){if(this.removed)return this;var n=this.Group.style,a=this.shape&&this.shape.style||this.node.style;t=t||{};for(var s in t)t[u](s)&&(this.attrs[s]=t[s]);e=e||this._.rt.cx,i=i||this._.rt.cy;var r,o,l,h,c=this.attrs;switch(this.type){case"circle":r=c.cx-c.r,o=c.cy-c.r,l=h=2*c.r;break;case"ellipse":r=c.cx-c.rx,o=c.cy-c.ry,l=2*c.rx,h=2*c.ry;break;case"image":r=+c.x,o=+c.y,l=c.width||0,h=c.height||0;break;case"text":this.textpath.v=["m",q(c.x),", ",q(c.y-2),"l",q(c.x)+1,", ",q(c.y-2)][M](x),r=c.x-q(this.W/2),o=c.y-this.H/2,l=this.W,h=this.H;break;case"rect":case"path":if(this.attrs.path){var d=mt(this.attrs.path);r=d.x,o=d.y,l=d.width,h=d.height}else r=0,o=0,l=this.paper.width,h=this.paper.height;break;default:r=0,o=0,l=this.paper.width,h=this.paper.height}e=null==e?r+l/2:e,i=null==i?o+h/2:i;var p,f=e-this.paper.width/2,g=i-this.paper.height/2;n.left!=(p=f+"px")&&(n.left=p),n.top!=(p=g+"px")&&(n.top=p),this.X=ne[u](this.type)?-f:r,this.Y=ne[u](this.type)?-g:o,this.W=l,this.H=h,ne[u](this.type)?(a.left!=(p=-f*ie+"px")&&(a.left=p),a.top!=(p=-g*ie+"px")&&(a.top=p)):"text"==this.type?(a.left!=(p=-f+"px")&&(a.left=p),a.top!=(p=-g+"px")&&(a.top=p)):(n.width!=(p=this.paper.width+"px")&&(n.width=p),n.height!=(p=this.paper.height+"px")&&(n.height=p),a.left!=(p=r-f+"px")&&(a.left=p),a.top!=(p=o-g+"px")&&(a.top=p),a.width!=(p=l+"px")&&(a.width=p),a.height!=(p=h+"px")&&(a.height=p))},zt.hide=function(){return!this.removed&&(this.Group.style.display="none"),this},zt.show=function(){return!this.removed&&(this.Group.style.display="block"),this},zt.getBBox=function(){return this.removed?this:ne[u](this.type)?mt(this.attrs.path):{x:this.X+(this.bbx||0),y:this.Y,width:this.W,height:this.H}},zt.remove=function(){if(!this.removed){Tt(this,this.paper),this.node.parentNode.removeChild(this.node),this.Group.parentNode.removeChild(this.Group),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var t in this)delete this[t];this.removed=!0}},zt.attr=function(e,i){if(this.removed)return this;if(null==e){var n={};for(var a in this.attrs)this.attrs[u](a)&&(n[a]=this.attrs[a]);return this._.rt.deg&&(n.rotation=this.rotate()),(1!=this._.sx||1!=this._.sy)&&(n.scale=this.scale()),n.gradient&&"none"==n.fill&&(n.fill=n.gradient)&&delete n.gradient,n}if(null==i&&t.is(e,"string"))return"translation"==e?Me.call(this):"rotation"==e?this.rotate():"scale"==e?this.scale():e==N&&"none"==this.attrs.fill&&this.attrs.gradient?this.attrs.gradient:this.attrs[e];if(this.attrs&&null==i&&t.is(e,V)){var s,r={};for(a=0,s=e[D];s>a;a++)r[e[a]]=this.attr(e[a]);return r}var o;if(null!=i&&(o={},o[e]=i),null==i&&t.is(e,"object")&&(o=e),o){for(var l in this.paper.customAttributes)if(this.paper.customAttributes[u](l)&&o[u](l)&&t.is(this.paper.customAttributes[l],"function")){var h=this.paper.customAttributes[l].apply(this,[][b](o[l]));this.attrs[l]=o[l];for(var c in h)h[u](c)&&(o[c]=h[c])}o.text&&"text"==this.type&&(this.node.string=o.text),Lt(this,o),o.gradient&&({circle:1,ellipse:1}[u](this.type)||"r"!=_(o.gradient).charAt())&&Ft(this,o.gradient),(!ne[u](this.type)||this._.rt.deg)&&this.setBox(this.attrs)}return this},zt.toFront=function(){return!this.removed&&this.Group.parentNode[v](this.Group),this.paper.top!=this&&It(this,this.paper),this},zt.toBack=function(){return this.removed?this:(this.Group.parentNode.firstChild!=this.Group&&(this.Group.parentNode.insertBefore(this.Group,this.Group.parentNode.firstChild),Pt(this,this.paper)),this)},zt.insertAfter=function(t){return this.removed?this:(t.constructor==De&&(t=t[t.length-1]),t.Group.nextSibling?t.Group.parentNode.insertBefore(this.Group,t.Group.nextSibling):t.Group.parentNode[v](this.Group),At(this,t,this.paper),this)},zt.insertBefore=function(t){return this.removed?this:(t.constructor==De&&(t=t[0]),t.Group.parentNode.insertBefore(this.Group,t.Group),Rt(this,t,this.paper),this)},zt.blur=function(e){var i=this.node.runtimeStyle,n=i.filter;n=n.replace(Jt,x),0!==+e?(this.attrs.blur=e,i.filter=n+$+Q+".Blur(pixelradius="+(+e||1.5)+")",i.margin=t.format("-{0}px 0 0 -{0}px",q(+e||1.5))):(i.filter=n,i.margin=0,delete this.attrs.blur)},Ht=function(t,e,i,n){var a=se("group"),s=se("oval");s.style;a.style.cssText="position:absolute;left:0;top:0;width:"+t.width+"px;height:"+t.height+"px",a.coordsize=ee,a.coordorigin=t.coordorigin,a[v](s);var r=new Wt(s,a,t);return r.type="circle",Lt(r,{stroke:"#000",fill:"none"}),r.attrs.cx=e,r.attrs.cy=i,r.attrs.r=n,r.setBox({x:e-n,y:i-n,width:2*n,height:2*n}),t.canvas[v](a),r},Ut=function(t,e,i,a,s,r){var o=n(e,i,a,s,r),l=t.path(o),h=l.attrs;return l.X=h.x=e,l.Y=h.y=i,l.W=h.width=a,l.H=h.height=s,h.r=r,h.path=o,l.type="rect",l},Gt=function(t,e,i,n,a){var s=se("group"),r=se("oval");r.style;s.style.cssText="position:absolute;left:0;top:0;width:"+t.width+"px;height:"+t.height+"px",s.coordsize=ee,s.coordorigin=t.coordorigin,s[v](r);var o=new Wt(r,s,t);return o.type="ellipse",Lt(o,{stroke:"#000"}),o.attrs.cx=e,o.attrs.cy=i,o.attrs.rx=n,o.attrs.ry=a,o.setBox({x:e-n,y:i-a,width:2*n,height:2*a}),t.canvas[v](s),o},qt=function(t,e,i,n,a,s){var r=se("group"),o=se("image");r.style.cssText="position:absolute;left:0;top:0;width:"+t.width+"px;height:"+t.height+"px",r.coordsize=ee,r.coordorigin=t.coordorigin,o.src=e,r[v](o);var l=new Wt(o,r,t);return l.type="image",l.attrs.src=e,l.attrs.x=i,l.attrs.y=n,l.attrs.w=a,l.attrs.h=s,l.setBox({x:i,y:n,width:a,height:s}),t.canvas[v](r),l},Yt=function(e,i,n,a){var s=se("group"),r=se("shape"),o=r.style,l=se("path"),h=(l.style,se("textpath"));s.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px",s.coordsize=ee,s.coordorigin=e.coordorigin,l.v=t.format("m{0},{1}l{2},{1}",q(10*i),q(10*n),q(10*i)+1),l.textpathok=!0,o.width=e.width,o.height=e.height,h.string=_(a),h.on=!0,r[v](h),r[v](l),s[v](r);var c=new Wt(h,s,e);return c.shape=r,c.textpath=l,c.type="text",c.attrs.text=a,c.attrs.x=i,c.attrs.y=n,c.attrs.w=1,c.attrs.h=1,Lt(c,{font:J.font,stroke:"none",fill:"#000"}),c.setBox(),e.canvas[v](s),c},Xt=function(t,e){var i=this.canvas.style;return t==+t&&(t+="px"),e==+e&&(e+="px"),i.width=t,i.height=e,i.clip="rect(0 "+t+" "+e+" 0)",this};var se;p.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!p.namespaces.rvml&&p.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),se=function(t){return p.createElement("<rvml:"+t+' class="rvml">')}}catch(re){se=function(t){return p.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}Zt=function(){var e=Mt[y](0,arguments),i=e.container,n=e.height,a=e.width,s=e.x,r=e.y;if(!i)throw new Error("VML container not found.");var o=new m,l=o.canvas=p.createElement("div"),h=l.style;return s=s||0,r=r||0,a=a||512,n=n||342,a==+a&&(a+="px"),n==+n&&(n+="px"),o.width=1e3,o.height=1e3,o.coordsize=1e3*ie+$+1e3*ie,o.coordorigin="0 0",o.span=p.createElement("span"),o.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",l[v](o.span),h.cssText=t.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",a,n),1==i?(p.body[v](l),h.left=s+"px",h.top=r+"px",h.position="absolute"):i.firstChild?i.insertBefore(l,i.firstChild):i[v](l),Dt.call(o,o,t.fn),o},o.clear=function(){this.canvas.innerHTML=x,this.span=p.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas[v](this.span),this.bottom=this.top=null},o.remove=function(){this.canvas.parentNode.removeChild(this.canvas);for(var t in this)this[t]=jt(t);return!0}}var oe=navigator.userAgent.match(/Version\/(.*?)\s/);"Apple Computer, Inc."==navigator.vendor&&(oe&&oe[1]<4||"iP"==navigator.platform.slice(0,2))?o.safari=function(){var t=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});f.setTimeout(function(){t.remove()})}:o.safari=function(){};for(var le=function(){this.returnValue=!1},he=function(){return this.originalEvent.preventDefault()},ce=function(){this.cancelBubble=!0},de=function(){return this.originalEvent.stopPropagation()},ue=function(){return p.addEventListener?function(t,e,i,n){var a=w&&S[e]?S[e]:e,s=function(a){if(w&&S[u](e))for(var s=0,r=a.targetTouches&&a.targetTouches.length;r>s;s++)if(a.targetTouches[s].target==t){var o=a;a=a.targetTouches[s],a.originalEvent=o,a.preventDefault=he,a.stopPropagation=de;break}return i.call(n,a)};return t.addEventListener(a,s,!1),function(){return t.removeEventListener(a,s,!1),!0}}:p.attachEvent?function(t,e,i,n){var a=function(t){return t=t||f.event,t.preventDefault=t.preventDefault||le,t.stopPropagation=t.stopPropagation||ce,i.call(n,t)};t.attachEvent("on"+e,a);var s=function(){return t.detachEvent("on"+e,a),!0};return s}:void 0}(),pe=[],fe=function(t){for(var e,i=t.clientX,n=t.clientY,a=p.documentElement.scrollTop||p.body.scrollTop,s=p.documentElement.scrollLeft||p.body.scrollLeft,r=pe.length;r--;){if(e=pe[r],w){for(var o,l=t.touches.length;l--;)if(o=t.touches[l],o.identifier==e.el._drag.id){i=o.clientX,n=o.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();i+=s,n+=a,e.move&&e.move.call(e.move_scope||e.el,i-e.el._drag.x,n-e.el._drag.y,i,n,t)}},ge=function(e){t.unmousemove(fe).unmouseup(ge);for(var i,n=pe.length;n--;)i=pe[n],i.el._drag={},i.end&&i.end.call(i.end_scope||i.start_scope||i.move_scope||i.el,e);pe=[]},me=k[D];me--;)!function(e){t[e]=Wt[d][e]=function(i,n){return t.is(i,"function")&&(this.events=this.events||[],this.events.push({name:e,f:i,unbind:ue(this.shape||this.node||p,e,i,n||this)})),this},t["un"+e]=Wt[d]["un"+e]=function(t){for(var i=this.events,n=i[D];n--;)if(i[n].name==e&&i[n].f==t)return i[n].unbind(),i.splice(n,1),!i.length&&delete this.events,this;return this}}(k[me]);zt.hover=function(t,e,i,n){return this.mouseover(t,i).mouseout(e,n||i)},zt.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)},zt.drag=function(e,i,n,a,s,r){return this._drag={},this.mousedown(function(o){(o.originalEvent||o).preventDefault();var l=p.documentElement.scrollTop||p.body.scrollTop,h=p.documentElement.scrollLeft||p.body.scrollLeft;this._drag.x=o.clientX+h,this._drag.y=o.clientY+l,this._drag.id=o.identifier,i&&i.call(s||a||this,o.clientX+h,o.clientY+l,o),!pe.length&&t.mousemove(fe).mouseup(ge),pe.push({el:this,move:e,end:n,move_scope:a,start_scope:s,end_scope:r})}),this},zt.undrag=function(e,i,n){for(var a=pe.length;a--;)pe[a].el==this&&pe[a].move==e&&pe[a].end==n&&pe.splice(a++,1);!pe.length&&t.unmousemove(fe).unmouseup(ge)},o.circle=function(t,e,i){return Ht(this,t||0,e||0,i||0)},o.rect=function(t,e,i,n,a){return Ut(this,t||0,e||0,i||0,n||0,a||0)},o.ellipse=function(t,e,i,n){return Gt(this,t||0,e||0,i||0,n||0)},o.path=function(e){return e&&!t.is(e,F)&&!t.is(e[0],V)&&(e+=x),Et(t.format[y](t,arguments),this)},o.image=function(t,e,i,n,a){return qt(this,t||"about:blank",e||0,i||0,n||0,a||0)},o.text=function(t,e,i){return Yt(this,t||0,e||0,_(i))},o.set=function(t){return arguments[D]>1&&(t=Array[d].splice.call(arguments,0,arguments[D])),new De(t)},o.setSize=Xt,o.top=o.bottom=null,o.raphael=t,zt.resetScale=function(){return this.removed?this:(this._.sx=1,this._.sy=1,void(this.attrs.scale="1 1"))},zt.scale=function(t,e,i,n){if(this.removed)return this;if(null==t&&null==e)return{x:this._.sx,y:this._.sy,toString:a};e=e||t,!+e&&(e=t);var s,r,o=this.attrs;if(0!=t){var l=this.getBBox(),h=l.x+l.width/2,c=l.y+l.height/2,d=R(t/this._.sx),u=R(e/this._.sy);i=+i||0==i?i:h,n=+n||0==n?n:c;var p=this._.sx>0,f=this._.sy>0,g=~~(t/R(t)),m=~~(e/R(e)),v=d*g,y=u*m,w=this.node.style,_=i+R(h-i)*v*(h>i==p?1:-1),C=n+R(c-n)*y*(c>n==f?1:-1),k=t*g>e*m?u:d;switch(this.type){case"rect":case"image":var S=o.width*d,T=o.height*u;this.attr({height:T,r:o.r*k,width:S,x:_-S/2,y:C-T/2});break;case"circle":case"ellipse":this.attr({rx:o.rx*d,ry:o.ry*u,r:o.r*k,cx:_,cy:C});break;case"text":this.attr({x:_,y:C});break;case"path":for(var I=yt(o.path),P=!0,A=p?v:d,j=f?y:u,B=0,E=I[D];E>B;B++){var F=I[B],V=K.call(F[0]);if("M"!=V||!P)if(P=!1,"A"==V)F[I[B][D]-2]*=A,F[I[B][D]-1]*=j,F[1]*=d,F[2]*=u,F[5]=+(g+m?!!+F[5]:!+F[5]);else if("H"==V)for(var L=1,N=F[D];N>L;L++)F[L]*=A;else if("V"==V)for(L=1,N=F[D];N>L;L++)F[L]*=j;else for(L=1,N=F[D];N>L;L++)F[L]*=L%2?A:j}var O=mt(I);s=_-O.x-O.width/2,r=C-O.y-O.height/2,I[0][1]+=s,I[0][2]+=r,this.attr({path:I})}this.type in{text:1,image:1}&&(1!=g||1!=m)?this.transformations?(this.transformations[2]="scale("[b](g,",",m,")"),this.node[Y]("transform",this.transformations[M]($)),s=-1==g?-o.x-(S||0):o.x,r=-1==m?-o.y-(T||0):o.y,this.attr({x:s,y:r}),o.fx=g-1,o.fy=m-1):(this.node.filterMatrix=Q+".Matrix(M11="[b](g,", M12=0, M21=0, M22=",m,", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')"),w.filter=(this.node.filterMatrix||x)+(this.node.filterOpacity||x)):this.transformations?(this.transformations[2]=x,this.node[Y]("transform",this.transformations[M]($)),o.fx=0,o.fy=0):(this.node.filterMatrix=x,w.filter=(this.node.filterMatrix||x)+(this.node.filterOpacity||x)),o.scale=[t,e,i,n][M]($),this._.sx=t,this._.sy=e}return this},zt.clone=function(){if(this.removed)return null;var t=this.attr();return delete t.scale,delete t.translation,this.paper[this.type]().attr(t)};var ve={},ye=function(e,i,n,a,s,r,o,l,h){var c,d,u=0,p=100,f=[e,i,n,a,s,r,o,l].join(),g=ve[f];if(!g&&(ve[f]=g={data:[]}),g.timer&&clearTimeout(g.timer),g.timer=setTimeout(function(){delete ve[f]},2e3),null!=h){var m=ye(e,i,n,a,s,r,o,l);p=10*~~m}for(var v=0;p+1>v;v++){if(g.data[h]>v?d=g.data[v*p]:(d=t.findDotsAtSegment(e,i,n,a,s,r,o,l,v/p),g.data[v]=d),v&&(u+=j(j(c.x-d.x,2)+j(c.y-d.y,2),.5)),null!=h&&u>=h)return d;c=d}return null==h?u:void 0},be=function(e,i){return function(n,a,s){n=kt(n);for(var r,o,l,h,c,d="",u={},p=0,f=0,g=n.length;g>f;f++){if(l=n[f],"M"==l[0])r=+l[1],o=+l[2];else{if(h=ye(r,o,l[1],l[2],l[3],l[4],l[5],l[6]),p+h>a){if(i&&!u.start){if(c=ye(r,o,l[1],l[2],l[3],l[4],l[5],l[6],a-p),d+=["C",c.start.x,c.start.y,c.m.x,c.m.y,c.x,c.y],s)return d;u.start=d,d=["M",c.x,c.y+"C",c.n.x,c.n.y,c.end.x,c.end.y,l[5],l[6]][M](),p+=h,r=+l[5],o=+l[6];continue}if(!e&&!i)return c=ye(r,o,l[1],l[2],l[3],l[4],l[5],l[6],a-p),{x:c.x,y:c.y,alpha:c.alpha}}p+=h,r=+l[5],o=+l[6]}d+=l}return u.end=d,c=e?p:i?u:t.findDotsAtSegment(r,o,l[1],l[2],l[3],l[4],l[5],l[6],1),c.alpha&&(c={x:c.x,y:c.y,alpha:c.alpha}),c}},we=be(1),xe=be(),$e=be(0,1);zt.getTotalLength=function(){return"path"==this.type?this.node.getTotalLength?this.node.getTotalLength():we(this.attrs.path):void 0},zt.getPointAtLength=function(t){return"path"==this.type?xe(this.attrs.path,t):void 0},zt.getSubpath=function(t,e){if("path"==this.type){if(R(this.getTotalLength()-e)<"1e-6")return $e(this.attrs.path,t).end;var i=$e(this.attrs.path,e,1);return t?$e(i,t).end:i}},t.easing_formulas={linear:function(t){return t},"<":function(t){return j(t,3)},">":function(t){return j(t-1,3)+1},"<>":function(t){return t=2*t,1>t?j(t,3)/2:(t-=2,(j(t,3)+2)/2)},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){t-=1;var e=1.70158;return t*t*((e+1)*t+e)+1},elastic:function(t){if(0==t||1==t)return t;var e=.3,i=e/4;return j(2,-10*t)*I.sin((t-i)*(2*B)/e)+1},bounce:function(t){var e,i=7.5625,n=2.75;return 1/n>t?e=i*t*t:2/n>t?(t-=1.5/n,e=i*t*t+.75):2.5/n>t?(t-=2.25/n,e=i*t*t+.9375):(t-=2.625/n,e=i*t*t+.984375),e}};var _e=[],Ce=function(){for(var e=+new Date,i=0;i<_e[D];i++){var n=_e[i];if(!n.stop&&!n.el.removed){var a,s=e-n.start,r=n.ms,o=n.easing,l=n.from,h=n.diff,c=n.to,d=n.t,p=n.el,f={};if(r>s){var g=o(s/r);for(var m in l)if(l[u](m)){switch(tt[m]){case"along":a=g*r*h[m],c.back&&(a=c.len-a);var v=xe(c[m],a);p.translate(h.sx-h.x||0,h.sy-h.y||0),h.x=v.x,h.y=v.y,p.translate(v.x-h.sx,v.y-h.sy),c.rot&&p.rotate(h.r+v.alpha,v.x,v.y);break;case E:a=+l[m]+g*r*h[m];break;case"colour":a="rgb("+[Se(q(l[m].r+g*r*h[m].r)),Se(q(l[m].g+g*r*h[m].g)),Se(q(l[m].b+g*r*h[m].b))][M](",")+")";break;case"path":a=[];for(var y=0,b=l[m][D];b>y;y++){a[y]=[l[m][y][0]];for(var w=1,_=l[m][y][D];_>w;w++)a[y][w]=+l[m][y][w]+g*r*h[m][y][w];a[y]=a[y][M]($)}a=a[M]($);break;case"csv":switch(m){case"translation":var C=g*r*h[m][0]-d.x,k=g*r*h[m][1]-d.y;d.x+=C,d.y+=k,a=C+$+k;break;case"rotation":a=+l[m][0]+g*r*h[m][0],l[m][1]&&(a+=","+l[m][1]+","+l[m][2]);break;case"scale":a=[+l[m][0]+g*r*h[m][0],+l[m][1]+g*r*h[m][1],2 in c[m]?c[m][2]:x,3 in c[m]?c[m][3]:x][M]($);break;case"clip-rect":for(a=[],y=4;y--;)a[y]=+l[m][y]+g*r*h[m][y]}break;default:var S=[].concat(l[m]);for(a=[],y=p.paper.customAttributes[m].length;y--;)a[y]=+S[y]+g*r*h[m][y]}f[m]=a}p.attr(f),p._run&&p._run.call(p)}else c.along&&(v=xe(c.along,c.len*!c.back),p.translate(h.sx-(h.x||0)+v.x-h.sx,h.sy-(h.y||0)+v.y-h.sy),c.rot&&p.rotate(h.r+v.alpha,v.x,v.y)),(d.x||d.y)&&p.translate(-d.x,-d.y),c.scale&&(c.scale+=x),p.attr(c),_e.splice(i--,1)}}t.svg&&p&&p.paper&&p.paper.safari(),_e[D]&&setTimeout(Ce)},ke=function(e,i,n,a,s){var r=n-a;i.timeouts.push(setTimeout(function(){t.is(s,"function")&&s.call(i),i.animate(e,r,e.easing)},a))},Se=function(t){return P(A(t,255),0)},Me=function(t,e){if(null==t)return{x:this._.tx,y:this._.ty,toString:a};switch(this._.tx+=+t,this._.ty+=+e,this.type){case"circle":case"ellipse":this.attr({cx:+t+this.attrs.cx,cy:+e+this.attrs.cy});break;case"rect":case"image":case"text":this.attr({x:+t+this.attrs.x,y:+e+this.attrs.y});break;case"path":var i=yt(this.attrs.path);i[0][1]+=+t,i[0][2]+=+e,this.attr({path:i})}return this};zt.animateWith=function(t,e,i,n,a){for(var s=0,r=_e.length;r>s;s++)_e[s].el.id==t.id&&(e.start=_e[s].start);return this.animate(e,i,n,a)},zt.animateAlong=s(),zt.animateAlongBack=s(1),zt.onAnimation=function(t){return this._run=t||0,this},zt.animate=function(e,i,n,a){var s=this;if(s.timeouts=s.timeouts||[],(t.is(n,"function")||!n)&&(a=n||null),s.removed)return a&&a.call(s),s;var o={},h={},c=!1,d={};for(var p in e)if(e[u](p)&&(tt[u](p)||s.paper.customAttributes[u](p)))switch(c=!0,o[p]=s.attr(p),null==o[p]&&(o[p]=J[p]),h[p]=e[p],tt[p]){case"along":var f=we(e[p]),g=xe(e[p],f*!!e.back),m=s.getBBox();d[p]=f/i,d.tx=m.x,d.ty=m.y,d.sx=g.x,d.sy=g.y,h.rot=e.rot,h.back=e.back,h.len=f,e.rot&&(d.r=X(s.rotate())||0);break;case E:d[p]=(h[p]-o[p])/i;break;case"colour":o[p]=t.getRGB(o[p]);var v=t.getRGB(h[p]);d[p]={r:(v.r-o[p].r)/i,g:(v.g-o[p].g)/i,b:(v.b-o[p].b)/i};break;case"path":var y=kt(o[p],h[p]);o[p]=y[0];var b=y[1];d[p]=[];for(var w=0,x=o[p][D];x>w;w++){d[p][w]=[0];for(var $=1,k=o[p][w][D];k>$;$++)d[p][w][$]=(b[w][$]-o[p][w][$])/i}break;case"csv":var S=_(e[p])[C](l),M=_(o[p])[C](l);switch(p){case"translation":o[p]=[0,0],d[p]=[S[0]/i,S[1]/i];break;case"rotation":o[p]=M[1]==S[1]&&M[2]==S[2]?M:[0,S[1],S[2]],d[p]=[(S[0]-o[p][0])/i,0,0];break;case"scale":e[p]=S,o[p]=_(o[p])[C](l),d[p]=[(S[0]-o[p][0])/i,(S[1]-o[p][1])/i,0,0];break;case"clip-rect":for(o[p]=_(o[p])[C](l),d[p]=[],w=4;w--;)d[p][w]=(S[w]-o[p][w])/i}h[p]=S;break;default:for(S=[].concat(e[p]),M=[].concat(o[p]),d[p]=[],w=s.paper.customAttributes[p][D];w--;)d[p][w]=((S[w]||0)-(M[w]||0))/i}if(c){var T=t.easing_formulas[n];if(!T)if(T=_(n).match(G),T&&5==T[D]){var I=T;T=function(t){return r(t,+I[1],+I[2],+I[3],+I[4],i)}}else T=function(t){return t};_e.push({start:e.start||+new Date,ms:i,easing:T,from:o,diff:d,to:h,el:s,t:{x:0,y:0}}),t.is(a,"function")&&(s._ac=setTimeout(function(){a.call(s)},i)),1==_e[D]&&setTimeout(Ce)}else{var P,A=[];for(var R in e)e[u](R)&&it.test(R)&&(p={value:e[R]},"from"==R&&(R=0),"to"==R&&(R=100),p.key=Z(R,10),A.push(p));for(A.sort(ht),A[0].key&&A.unshift({key:0,value:s.attrs}),w=0,x=A[D];x>w;w++)ke(A[w].value,s,i/100*A[w].key,i/100*(A[w-1]&&A[w-1].key||0),A[w-1]&&A[w-1].value.callback);P=A[A[D]-1].value.callback,P&&s.timeouts.push(setTimeout(function(){P.call(s)},i))}return this},zt.stop=function(){for(var t=0;t<_e.length;t++)_e[t].el.id==this.id&&_e.splice(t--,1);for(t=0,ii=this.timeouts&&this.timeouts.length;t<ii;t++)clearTimeout(this.timeouts[t]);return this.timeouts=[],clearTimeout(this._ac),delete this._ac,this},zt.translate=function(t,e){return this.attr({translation:t+" "+e})},zt[L]=function(){return"Rapha\xebl\u2019s object"},t.ae=_e;var De=function(t){if(this.items=[],this[D]=0,this.type="set",t)for(var e=0,i=t[D];i>e;e++)!t[e]||t[e].constructor!=Wt&&t[e].constructor!=De||(this[this.items[D]]=this.items[this.items[D]]=t[e],this[D]++)};De[d][W]=function(){for(var t,e,i=0,n=arguments[D];n>i;i++)t=arguments[i],!t||t.constructor!=Wt&&t.constructor!=De||(e=this.items[D],this[e]=this.items[e]=t,this[D]++);return this},De[d].pop=function(){return delete this[this[D]--],this.items.pop()};for(var Te in zt)zt[u](Te)&&(De[d][Te]=function(t){return function(){for(var e=0,i=this.items[D];i>e;e++)this.items[e][t][y](this.items[e],arguments);return this}}(Te));De[d].attr=function(e,i){if(e&&t.is(e,V)&&t.is(e[0],"object"))for(var n=0,a=e[D];a>n;n++)this.items[n].attr(e[n]);else for(var s=0,r=this.items[D];r>s;s++)this.items[s].attr(e,i);return this},De[d].animate=function(e,i,n,a){(t.is(n,"function")||!n)&&(a=n||null);var s,r,o=this.items[D],l=o,h=this;for(a&&(r=function(){!--o&&a.call(h)}),n=t.is(n,F)?n:r,s=this.items[--l].animate(e,i,n,r);l--;)this.items[l]&&!this.items[l].removed&&this.items[l].animateWith(s,e,i,n,r);return this},De[d].insertAfter=function(t){for(var e=this.items[D];e--;)this.items[e].insertAfter(t);return this},De[d].getBBox=function(){for(var t=[],e=[],i=[],n=[],a=this.items[D];a--;){var s=this.items[a].getBBox();t[W](s.x),e[W](s.y),i[W](s.x+s.width),n[W](s.y+s.height)}return t=A[y](0,t),e=A[y](0,e),{x:t,y:e,width:P[y](0,i)-t,height:P[y](0,n)-e}},De[d].clone=function(t){t=new De;for(var e=0,i=this.items[D];i>e;e++)t[W](this.items[e].clone());return t},t.registerFont=function(t){if(!t.face)return t;this.fonts=this.fonts||{};var e={w:t.w,face:{},glyphs:{}},i=t.face["font-family"];for(var n in t.face)t.face[u](n)&&(e.face[n]=t.face[n]);if(this.fonts[i]?this.fonts[i][W](e):this.fonts[i]=[e],!t.svg){e.face["units-per-em"]=Z(t.face["units-per-em"],10);for(var a in t.glyphs)if(t.glyphs[u](a)){var s=t.glyphs[a];if(e.glyphs[a]={w:s.w,k:{},d:s.d&&"M"+s.d[et](/[mlcxtrv]/g,function(t){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[t]||"M"})+"z"},s.k)for(var r in s.k)s[u](r)&&(e.glyphs[a].k[r]=s.k[r])}}return t},o.getFont=function(e,i,n,a){if(a=a||"normal",n=n||"normal",i=+i||{normal:400,bold:700,lighter:300,bolder:800}[i]||400,t.fonts){var s=t.fonts[e];if(!s){var r=new RegExp("(^|\\s)"+e[et](/[^\w\d\s+!~.:_-]/g,x)+"(\\s|$)","i");for(var o in t.fonts)if(t.fonts[u](o)&&r.test(o)){s=t.fonts[o];break}}var l;if(s)for(var h=0,c=s[D];c>h&&(l=s[h],l.face["font-weight"]!=i||l.face["font-style"]!=n&&l.face["font-style"]||l.face["font-stretch"]!=a);h++);return l}},o.print=function(e,i,n,a,s,r,o){r=r||"middle",o=P(A(o||0,1),-1);var h,c=this.set(),d=_(n)[C](x),u=0;if(t.is(a,n)&&(a=this.getFont(a)),a){h=(s||16)/a.face["units-per-em"];for(var p=a.face.bbox.split(l),f=+p[0],g=+p[1]+("baseline"==r?p[3]-p[1]+ +a.face.descent:(p[3]-p[1])/2),m=0,v=d[D];v>m;m++){var y=m&&a.glyphs[d[m-1]]||{},b=a.glyphs[d[m]];u+=m?(y.w||a.w)+(y.k&&y.k[d[m]]||0)+a.w*o:0,b&&b.d&&c[W](this.path(b.d).attr({fill:"#000",stroke:"none",translation:[u,0]}))}c.scale(h,h,f,g).translate(e-f,i-g)}return c},t.format=function(e,i){var n=t.is(i,V)?[0][b](i):arguments;return e&&t.is(e,F)&&n[D]-1&&(e=e[et](c,function(t,e){return null==n[++e]?x:n[e]})),e||x},t.ninja=function(){return g.was?f.Raphael=g.is:delete Raphael,t},t.el=zt,t.st=De[d],g.was?f.Raphael=t:Raphael=t}();var _gaq=_gaq||[],_gat=_gat||[];$(function(){switch($("#footer a[href^=http]").live("click",function(){return gaTrackEvent("External Link",this.href,"Link Clicked"),setTimeout('document.location="'+this.href+'"',90),!1}),document.location.pathname){case"/my/plan/new":;$("#popup-popup").click(function(){gaTrackPageview("/my/plan/start-training-plan/save-plan")}),$("#real-new-plan").live("submit",function(){gaTrackPageview("/my/plan/start-training-plan/start-plan")});default:document.location.pathname.match(/^\/my\/plan\/\d+\/edit/)&&$("#popup-popup").click(function(){gaTrackPageview("/my/plan/edit/plan-changed")})}}),MyASICS.Avatar=Backbone.View.extend({events:{"change #avatar-field":"loadAvatar"},isFileAPISupported:function(){return!!(File&&FileReader&&FileList&&Blob)},loadAvatar:function(t){if(!this.isFileAPISupported())return!1;$(".change-profile-photo").empty();var e=t.target;if(e.files&&e.files[0]){var i=new FileReader,n=e.files[0],a=this;i.onload=function(){var t=URL.createObjectURL(n);$("#preview-avatar img").attr("src",t),$("#preview-avatar").removeClass("hidden"),$(".save-avatar").removeClass("hidden"),a.bindCropping()},i.readAsDataURL(n)}},bindCropping:function(){var t=$("#preview-avatar img"),e=$("#x"),i=$("#y"),n=$("#width"),a=$("#height");t.cropper("destroy"),t.cropper({aspectRatio:1,highlight:!1,dragCrop:!1,rotatable:!1,background:!1,cropBoxMovable:!0,cropBoxResizable:!1,built:function(){$(this).cropper("setCropBoxData",{width:150})},crop:function(t){e.attr("value",t.x),i.attr("value",t.y),n.attr("value",t.width),a.attr("value",t.height)}})}}),MyASICS.Dashboard={NoPlanDashboardView:Backbone.View.extend({events:{"focus #log-run input":"focus"},initialize:function(){this.runView=new MyASICS.Plans.RunView({el:"#log-run",date:date2Mjd(new Date),noAutofocus:!0,page:this.options.page}),this.goalView=new MyASICS.Dashboard.GoalView({el:"#goal"})},focus:function(t){this.$("#log-run").addClass("focused")}}),PlanDashboardView:Backbone.View.extend({initialize:function(){this.calendarView=new MyASICS.Dashboard.CalendarView({el:".dashboard-content",page:this.options.page}),this.comparisonView=new MyASICS.widgets.views.Comparison({el:"#compare-box"}),this.goalView=new MyASICS.Dashboard.GoalView({el:"#goal"})}}),GoalView:Backbone.View.extend({events:{"click .label":"showForm","blur #goal-text-input":"saveGoal","ajax:send":"updateGoalText","focus #goal-text-input":"focus","submit form":"submit"},updateGoalText:function(t){var e=$("#goal-text-input").val();this.$(".label").text(e),_.isEmpty(e)||this.hideForm()},showForm:function(){this.$el.addClass("editing"),this.$("#goal-text-input").focus()},hideForm:function(){this.$el.removeClass("editing"),this.alignEdit()},saveGoal:function(){this.$el.hasClass("editing")&&this.$("#goal-text-input").hasClass("focus")&&this.$("form").submit()},initialize:function(){this.alignEdit()},alignEdit:function(){this.$("small").offset({left:this.$(".label").outerWidth()/2-this.$("small").outerWidth()/2})},focus:function(){this.$("#goal-text-input").addClass("focus")},submit:function(){this.$("#goal-text-input").removeClass("focus"),this.$("#goal-text-input").blur()}}),CalendarView:Backbone.View.extend({events:{"click #plan-view-controls #previous-week":"changeCalendar","click #plan-view-controls #next-week":"changeCalendar","click #reschedule-runs":"startRescheduling"},initialize:function(){this.calendar=new MyASICS.Plans.CalendarView({el:this.$("#schedule")[0],page:this.options.page}),this.calendar.render(),this.calendar.hideAllPhaseDescription(),this.calendarDate=beginningOfWeek(advanceDate(new Date,-1)),this.updateDateRange(this.calendarDate),this.rescheduler=new MyASICS.Plans.RescheduleCalendarView({control:this.$("#reschedule-title"),calendar:this.calendar,page:this.options.page}),this.rescheduler.on("reschedule:success",this.stopRescheduling,this),this.rescheduler.on("reschedule:cancel",this.stopRescheduling,this)},changeCalendar:function(t){var e=$(t.currentTarget).data("increment");this.updateDateRange(advanceDate(this.calendarDate,e))},updateDateRange:function(e){this.calendarDate=this.calendar.makeDatesVisible(e,3);var i=l(this.calendarDate,"dashboard"),n=l(advanceDate(this.calendarDate,3,-1),"dashboard"),a=t("js.%{from_date}-%{to_date}",{from_date:i,to_date:n});this.$("#date-range").text(a)},startRescheduling:function(){this.$("#plan-title").hide(),this.$("#plan-view-controls").hide(),this.$("#reschedule-title").show(),this.rescheduler.render()},stopRescheduling:function(){this.$("#plan-title").show(),this.$("#plan-view-controls").show(),this.$("#reschedule-title").hide(),this.updateDateRange(this.calendarDate)}})},MyASICS.Evernote={NotebookView:Backbone.View.extend({events:{"change select#notebook_guid":"toggleNotebookName"},initialize:function(){this.toggleNotebookName()},toggleNotebookName:function(){""==this.$("select#notebook_guid").val()?(this.$(".notebook-name").show(),this.$(".new-notebook").val(1)):(this.$(".notebook-name").hide(),this.$(".new-notebook").val(""))}})},MyASICS.GraphView=Backbone.View.extend({defaults:{xOffset:$.browser.msie&&$.browser.version<9?.5:0,yOffset:$.browser.msie&&$.browser.version<9?.5:0,xInset:0,yInset:0,offsetToTop:0,width:6,gap:1,markInjuries:!0,markStilInjuries:!0,markEvents:!0,markRests:!0,drawOrdinateAxis:!0,markFirstDate:!1,dateLabelCount:12,markPoints:!0,interpolatePoints:!0,ordinateInterval:7},initialize:function(t){_.defaults(this,_.defaults(this.options,this.defaults));var e=$(this.el);this.logs=new MyASICS.LogSet({graph:this}),this.raphael=Raphael(this.el,e.width(),e.height()),this.maxHeight=e.height()-30,this.maxWidth=e.width()-this.xInset,this.xOffset=this.xOffset+this.xInset,this.yOffset=this.yOffset+this.yInset,this.on("data:loaded",this.setWidth,this),this.on("field:changed",this.onFieldChange,this),this.on("column:mouseover",this.onColumnMouseover,this),this.on("column:mouseout",this.onColumnMouseout,this)},onColumnMouseout:function(){$(".runPopup").hide()},showPopup:function(t,i,n,a){var s=this.popupFormat(n,a),r=$("#runPopupTemplate").tmpl(s),o=t.node.getBoundingClientRect(),l=this.el.getBoundingClientRect(),h=o.right-o.left,c=80,d=o.left+h/2-c-l.left;if("mouse_pointer"===$(this.el).parent().attr("data-popup-appear-position"))var u=e.pageY,p=this.offsetToTop-u;else var f=i,p=$(this.el).height()-f;$(this.el).parent().append(r).find(".runPopup").css({left:d,bottom:p})},percentage:function(t){var e=1*t/this.maxPrimary;
return 1>e?e:1},xP:function(t){return Math.round(t*(this.width+this.gap)+this.width/2)+this.xOffset},yP:function(t){return Math.round(this.maxHeight*(1-t))+this.yOffset},span:function(){return Math.ceil(this.maxWidth/(this.width+this.gap))},setField:function(t){this.field=t,this.trigger("field:changed")},onFieldChange:function(t){this.setMaxPrimary(),this.render()},setMaxPrimary:function(){var t=this.field,e=this.logs.max(function(e){return parseFloat(e.get(t))});this.maxPrimary=_.isObject(e)?e.get(t):e;var i=this.maxPrimary/this.ordinateInterval,n=Math.pow(10,(Math.ceil(i)+"").length-1);i=Math.ceil(i/n)*n,this.maxPrimary=this.ordinateInterval*i},setWidth:function(){var t=this.logs.days();this.maxWidth>=t?this.width=Math.floor(this.maxWidth/t):this.width=1,this.width<3?this.gap=0:this.width>9?(this.width=9,this.gap=1):(this.width-=1,this.gap=1)},interp:function(t){var e,i=this.field;if(e=this.logs.getValue(t))return[e,e,e];var n=this.logs.prevLog(t,function(t){return t.get(i)}),a=this.logs.nextLog(t,function(t){return t.get(i)});if(n&&a){var s=(a.get(i)-n.get(i))/(a.day()-n.day()),r=n.get(i),o=t-n.day();return[r+s*(o-.5),r+s*o,r+s*(o+.5)]}return(log=n||a)?(e=log.get(i),[e,e,e]):null},point:function(t){var e=t.day(),i=this.percentage(t.get(this.field));if(i){var n=this.raphael.rect(this.xP(e-.5),this.yP(i)-Math.round(this.width/2),this.width,this.width),a=this.getPointOptions(t);n.attr(a)}},text:function(t,e,i,n){return n||(e=this.yP(e)),this.raphael.text(t,e,i)},path:function(t,e){var i=[],n="L";return _.each(t,function(t){t[1]||0===t[1]?(i.push(n),n="L",e?i.push([t[0]+.5,t[1]+.5]):i.push([this.xP(t[0])-.5,this.yP(t[1])+.5])):n="M"},this),i[0]="M",this.raphael.path(i.join(" "))},drawColumns:function(){for(var t=0;t<this.span();++t)this.column(t),this.column(t,!0)},column:function(t,e){var i,n=this.getColumnOptions(t,e),a=this.yP(n.y1),s=this.yP(n.y2);if(null==s||a==s)i=this.raphael.rect(t*(this.width+this.gap)+this.xOffset,a,this.width,this.maxHeight-a+this.yOffset);else{var r=t*(this.width+this.gap)+this.xOffset,o=r+this.width,l=["M",r,this.maxHeight+this.yOffset,"L",o,this.maxHeight+this.yOffset,"L",o,s,"L",r,a,"Z"];i=this.raphael.path(l.join(" "))}if(i.attr(_.pick(n,"fill","y1","y2","stroke","opacity")),e){var h=this;i.mouseover(function(e){h.trigger("column:mouseover",this,t)}),i.mouseout(function(e){h.trigger("column:mouseout",this,t)})}return i},drawAxes:function(){this.drawAbscissa(),this.drawOrdinateAxis&&this.drawOrdinate()},drawAbscissa:function(){var t=this.path([[this.xP(-1),this.yP(0)],[this.$el.parent().width(),this.yP(0)]],!0);t.attr("stroke",this.colors.axis),this.prevMonth=null;for(var e=0;e<=this.logs.days();e+=this.getSpan())this.dateMarker(e),this.dateText(e)},drawOrdinate:function(){var t=this.path([[this.xP(-.5),this.yP(1)],[this.xP(-.5),this.yP(-.2)]],!0);t.attr({stroke:this.colors.axis,"stroke-width":"1px"});for(var e=1;e<this.ordinateInterval;e+=1){var i=e/this.ordinateInterval;this.ordinateText(i)}},getSpan:function(){for(var t=7;this.logs.days()/t>this.dateLabelCount;)t+=7;return t},dateMarker:function(t){var e=[[this.xP(t-.5),this.yP(0)+.5],[this.xP(t-.5),this.yP(0)+20.5]],i=this.path(e,!0);i.attr({stroke:this.colors.dateMarker,"stroke-width":"1px"})},dateText:function(t){var e=mjd2Date(t+this.logs.min_day),i=l(e,e.getMonth()==this.prevMonth?"grass_short":"grass");this.prevMonth=e.getMonth();var n=this.text(this.xP(t)+5,this.yP(0)+10,i,!0);n.attr({"text-anchor":"start",fill:this.colors.dateText})},ordinateText:function(t){var e=this.ordinateFormat(this.field,Math.round(this.maxPrimary*t)),i=this.text(30,this.yP(t)+8,e,!0);i.attr("text-anchor","end");var n=this.path([[5.5,this.yP(t)],[34.5,this.yP(t)]],!0);n.attr("stroke",this.colors.axis)}}),MyASICS.Log=Backbone.Model.extend({day:function(){return this.get("mjd")-this.collection.min_day}}),MyASICS.LogSet=Backbone.Collection.extend({model:MyASICS.Log,initialize:function(t){this.graph=t.graph},loadData:function(t){_.extend(this,_.omit(t,"runs")),this.reset(t.runs||[]),this.graph.trigger("data:loaded"),t.field&&this.graph.setField(t.field)},days:function(){return this.max_day-this.min_day},getValue:function(t){var e=this.graph.field,i=this.findLog(t,function(t){return t.get(e)});return i?i.get(e):null},findLog:function(t,e){var i=t+this.min_day;return this.find(function(t){return t.get("mjd")==i&&(!e||e(t))})},nextLog:function(t,e){var i=t+this.min_day;return this.find(function(t){return t.get("mjd")>i&&(!e||e(t))})},prevLog:function(t,e){var i=t+this.min_day;return _.last(this.filter(function(t){return t.get("mjd")<i&&(!e||e(t))}))},isEmpty:function(){var t=this.graph.field;return!this.find(function(e){return e.get(t)})},getType:function(t){var e,i;return this.isEmpty()||t>this.days()?"blank":(e=this.findLog(t))?e.get("type"):(i=this.prevLog(t))&&"injured"==i.get("type")?"injured_rest":"no_log"}}),MyASICS.LanguageSwitcher=Backbone.View.extend({el:".language-list",events:{"click a":"changeLocale"},changeLocale:function(t){t.preventDefault();var e=$(t.currentTarget).data("locale"),i=function(){location=t.currentTarget.href};MyASICS.User.isLoggedIn?($.cookie("locale",e,{path:"/"}),$.ajax({type:"PATCH",dataType:"json",data:{"user[locale]":e},url:MyASICS.User.Routes.settings,success:function(){i()}})):($.cookie("locale",e,{path:"/"}),i())}}),$(function(){setupLaps()});var TimeParsing={sec2hms:function(t){if((isNaN(t)||!isFinite(t))&&(t=0),!t||0==t)return"00:00:00";var e=Math.round(t%60),i=Math.floor(t/3600),n=Math.floor(t/60)-60*i;return result=[n,e],result=$.map(result,function(t){return formatHmsElement(t)}),i>0?result.unshift(i):result.unshift(0),result.join(":")},sec2ms:function(t){if((isNaN(t)||!isFinite(t))&&(t=0),!t||0==t)return"00:00";var e=Math.round(t%60),i=Math.floor(t/60);return $.map([i,e],function(t){return formatHmsElement(t)}).join(":")},hms2sec:function(t){if(!t||""==t)return 0;var e=0;if(t.match(/\d{1,}:\d\d:\d\d/)){var i=$.map(t.split(":"),function(t){return parseInt(t,10)});e=3600*i[0]+60*i[1]+i[2]}else{if(!t.match(/\d{1,2}:\d\d/))throw"unknow format: "+t;var i=$.map(t.split(":"),function(t){return parseInt(t,10)});e=60*i[0]+i[1]}return e}};$(function(){$(document).bind("afterReveal.dropdownbox",function(){setTimeout(function(){$("#dropdownbox .dropdownboxloading").length>0&&$("#dropdownbox .dropdownboxloading").remove()},250)}),$(".private-profile-message .action-button").on("click",function(t){t.preventDefault();var e=$(this).data(),i={};i[$("meta[name=csrf-param]").attr("content")]=$("meta[name=csrf-token]").attr("content"),$.ajax({type:e.method,url:e.path,data:i,dataType:"json",success:function(){$(".private-profile-message").remove()}})})}),MyASICS.Running={LogbookView:Backbone.View.extend({initialize:function(){this.controlsView=new MyASICS.Running.ControlsView({el:"#running-view .view-controls"}),this.grassView=new MyASICS.Running.GrassView({el:"#running-grass"}),this.tableView=new MyASICS.Running.LogbookTableView({el:"#running-view .running-list"}),this.ctaView=new MyASICS.Running.CtaView({el:"#running-cta-box"})}}),ControlsView:Backbone.View.extend({events:{"click .date-options .calendar":"showCalendar","click .rPickDate .close":"closeCalendar","click #rPickDateFromCall,  #rPickDateToCall":"toggleDatePicker","change #run-types-list input[type=checkbox]":"filterRunTypes","mouseenter #run-types-list #menu-filter li":"highlightRuns","mouseleave #run-types-list #menu-filter li":"dehighlightRuns"},initialize:function(){this.sanitizeData(),this.preloadDatePicker()},sanitizeData:function(){var t=MyASICS.Running.data;t.start_date=$.datepicker.parseDate("yy-mm-dd",t.start_date),t.end_date=$.datepicker.parseDate("yy-mm-dd",t.end_date)},preloadDatePicker:function(){var t=new Date;this.$("#rPickDateFrom").datepicker({changeYear:!0,changeMonth:!0,dayNamesMin:["S","M","T","W","T","F","S"],maxDate:t,onSelect:function(t){$("#rPickDateFromDate").val(t),$("#rPickDateTo").datepicker("option","minDate",advanceDate($(this).datepicker("getDate"),1))}}),this.$("#rPickDateTo").datepicker({changeYear:!0,changeMonth:!0,dayNamesMin:["S","M","T","W","T","F","S"],maxDate:t,minDate:$("#rPickDateFromDate").val(),onSelect:function(t){$("#rPickDateToDate").val(t),$("#rPickDateFrom").datepicker("option","maxDate",advanceDate($(this).datepicker("getDate"),-1))}})},showCalendar:function(t){this.$(".rPickDateDetail").show()},closeCalendar:function(t){$(".rPickDateDetail").hide()},toggleDatePicker:function(t){t.stopPropagation(),this.$("#rPickDateFrom").toggle(),this.$("#rPickDateTo").toggle(),this.$("#rPickDateFrom").datepicker("setDate",this.$("#rPickDateFromDate").val()),this.$("#rPickDateTo").datepicker("setDate",this.$("#rPickDateToDate").val()),this.$("#rPickDateFrom").datepicker("option","maxDate",advanceDate(this.$("#rPickDateTo").datepicker("getDate"),-1)),this.$("#rPickDateTo").datepicker("option","minDate",advanceDate(this.$("#rPickDateFrom").datepicker("getDate"),1)),this.$("#rPickDateFrom").datepicker("option","minDate",MyASICS.Running.data.run_min_date)},filterRunTypes:function(t){var e=this.$(t.currentTarget);e.hasClass("js-all-run-types")&&this.toggleAllRunTypes(e),(!e.hasClass("js-all-run-types")||e.is(":checked"))&&e.parents("form").submit()},toggleAllRunTypes:function(t){var e=t.is(":checked");$.each(this.$("#run-types-list").find("input[type=checkbox]"),function(t,i){$(i).prop("checked",e)})},highlightRuns:function(t){var e=t.currentTarget,i=this.$(e).find("input").val();"-1"==i&&(i=""),$(".running-list table tr[data-menu="+i+"]").addClass("highlight")},dehighlightRuns:function(t){$(".running-list table .highlight").removeClass("highlight")}}),GrassView:Backbone.View.extend({events:{"click .runPopup .dropdownboxed":"showDropdownbox","click #grass-tip":"toggleGrassTip"},initialize:function(){this.grassView=new MyASICS.Running.GraphView({el:"#running-grass .graph"}),this.grassView.logs.loadData(MyASICS.Running.data.grass_data)},showDropdownbox:function(t){t.preventDefault();var e=$(t.currentTarget),i=e.attr("href");"new"==e.data("type")&&(i=i+"&run[date]="+e.data("date")),$.dropdownboxWithSize(i,"752x900"),MyASICS.Utils.scrollToTop()},toggleGrassTip:function(){this.$("#illustration").toggleClass("hidden")}}),GraphView:MyASICS.GraphView.extend({options:{xInset:25,yInset:5,ordinateInterval:3,markFirstDate:!0,colors:{blank:"#F4F4F4",injured:"url(/assets/timeline_line_bg_2-6529568dad31aa2f23b61e2a9398c7e2c303646f03f83a3217547825e83e272e.gif)",event:"#002351",rest:"url(/assets/timeline_line_bg_3-ae33f2f37e88603a2e53ec2bf22cbaa87893e6ecd2fc5c2d4b40e88ae01e2b73.gif)",no_distance:"url(/assets/timeline_line_bg_no_distance-9a1707a3d97a40bbcfabedf49a6c5d28fc9f7d5d2f5405bc8147fad4408fc20e.gif",has_distance:"url(/assets/timeline_line_bg_have_distance-ee068569719cef9a670a1d18e83b2f8e01bedfb0be86ebcc1262b8a8821bde37.gif)",run_high:"url(/assets/timeline_line_bg_4-d318517ea91369750d146b0e0e1e31a81abcdccced085b2c2c71b2bc715bb897.gif)",run_med:"url(/assets/timeline_line_bg_1-50ffa838f3844cafa629a7e7d365596049520f0842b54aca393832032713ac44.gif)",run_low:"url(/assets/timeline_line_bg_5-af2d4a001d2c667e18ee3028a9fedcce0c673d9a1302366c08ac25881c48e942.gif)",fill:"#d1e8f4",point:"#285caf",line:"#97daf7",dateText:"#657C4D",dateMarker:"#B1B2B1",axis:"#B1B2B1"}},render:function(){this.drawColumns(),this.drawAxes()},drawOrdinate:function(){var t=this.path([[this.xP(-.5),this.yP(1)],[this.xP(-.5),this.yP(-.2)]],!0);t.attr({stroke:this.colors.axis,"stroke-width":"1px"});for(var e=0;e<=this.ordinateInterval;e+=1){var i=e/this.ordinateInterval;this.ordinateText(i)}},ordinateText:function(t){var e=this.text(this.xInset-10,this.yP(t),Math.round(this.maxPrimary*t),!0);e.attr({fill:this.colors.axis,"text-anchor":"end"});var i=this.path([[this.xInset,this.yP(t)],[this.xInset-5,this.yP(t)]],!0);i.attr("stroke",this.colors.axis)},onColumnMouseover:function(t,e){if(e<=this.logs.days()){var i=this.getColumnOptions(e).popup,n=this.yP(i),a=this.logs.findLog(e);this.showPopup(t,n,e,a)}},popupFormat:function(t,e){if(e)return{log:!0,date_html:l(mjd2Date(e.get("mjd")),"grass"),distance:e.get("dist_html"),rest:"rest"==e.get("type")?e.get("rest_html"):!1,time:e.get("time_html"),pace:e.get("pace_html"),edit_path:e.get("edit_path")};var i=t+this.logs.min_day;return{log:!1,date_html:l(mjd2Date(i),"grass"),date:l(mjd2Date(i))}},setMaxPrimary:function(){this.maxPrimary="distance_km"==this.field?30:24},getColumnOptions:function(t,e){var i,n=this.logs.getType(t);if(e||"injured_rest"==n||"no_log"==n)i={popup:1,y1:1,y2:1,fill:"white",opacity:0,stroke:!1};else if("blank"==n||"rest"==n||"injured"==n||"no_distance"==n)i={popup:1,y1:1,y2:1,fill:this.colors[n],stroke:!1};else{var a=this.interp(t);i={popup:this.percentage(a[0]),y1:this.percentage(a[0]),y2:this.percentage(a[2]),fill:this.colors[n],stroke:!1}}return i}}),LogbookTableView:Backbone.View.extend({initialize:function(){this.preloadPopup(),this.configOrderedColumn(),$.each(this.$el.find(".single-run"),function(t,e){new MyASICS.Running.SingleRunView({el:e})})},preloadPopup:function(){var t=MyASICS.Running.data,e=$.query.get("p"),i=$.query.get("r[run_id]");""!=e&&$.dropdownboxWithSize(t.new_run_path,"925x404"),""!=i&&(t.prompt_share_run_dialog?$.faceboxWithSize(t.share_run_dialog_path,"400x200",!0):t.prompt_profile&&$.faceboxWithSize(t.profile_path,"400x200",!0),setTimeout(function(){$("[data-id="+i+"]").click()},0))},configOrderedColumn:function(){this.$("th a.selected").parent().addClass("orderSel"),this.$(".down").parent().addClass("orderSelDown")}}),SingleRunView:Backbone.View.extend({events:{"click .headline":"showRunDetails","click .close-btn":"hideRunDetails","click .closeRunDetailsLink, .running-list .rActive":"closeDetails","click .js-add-gear":"addGear","click .js-promoted-products li":"addPromotedProduct","click .edit-btn":"prepareForDropdownbox","click .clear-gear-input":"clearGearInput","click .laps tr":"centreMap","keydown .gear-input":"switchGearInputAppendix","gearAdded .gear-input":"resetAddGearWidget"},initialize:function(){this.$(".gear-input").on("autocompleteopen",this.beforeAutocompleteMenuShow.bind(this)),this.$(".gear-input").on("autocompleteclose",this.afterAutocompleteMenuHide.bind(this)),this.$(".gear-input").keyup(function(t){if(13==t.which&&!this.$(".gear-input").hasClass("js-enter-from-autocomplete-menu")){var e=$(t.currentTarget);t.preventDefault();var i={"gear[name]":e.val(),run_id:e.data("run-id")};this.createGear(e,null,i)}}.bind(this))},centreMap:function(t){var e=$(t.currentTarget),i=e.data("index"),n=null;n=i>=this.options.routeMap.intervalMarkers.length?this.options.routeMap.endMarker:this.options.routeMap.intervalMarkers[i];var a=this.options.routeMap.generatePointByMarker(n);this.options.routeMap.map.setCenter(a)},switchBetweenTipAndPromotedProducts:function(t,e,i){t.val().length>0?(e.show(),i.hide()):(e.hide(),i.show())},switchGearInputAppendix:function(t){var e=$(t.currentTarget),i=e.parents(".js-add-gear");this.switchBetweenTipAndPromotedProducts(e,i.find(".add-gear-tip"),i.find(".js-promoted-products"))},prepareForDropdownbox:function(t){MyASICS.Utils.scrollToTop(),t.stopPropagation()},resetAddGearWidget:function(t){var e=$(t.currentTarget).parent(".js-add-gear");$(t.currentTarget).val(""),e.removeClass("active"),e.find(".js-promoted-products").hide(),e.find(".add-gear-tip").hide()},addGear:function(t){var e=$(t.currentTarget),i=e.find(".gear-input"),n=e.find(".gear-product-id");e.addClass("active"),this.switchBetweenTipAndPromotedProducts(i,e.find(".add-gear-tip"),e.find(".js-promoted-products")),i.focus(),gearAutocomplete(i,n,null,MyASICS.User.Gender,this.createGear,!0)},clearGearInput:function(t){var e=$(t.currentTarget);e.parents(".js-add-gear").find(".gear-input").val("")},addPromotedProduct:function(t){var e=$(t.currentTarget),i=$(".gear-input[data-run-id='"+e.data("run-id")+"']"),n={"gear[name]":e.data("product-name"),"gear[product_id]":e.data("product-id"),run_id:e.data("run-id")};this.createGear(i,null,n)},beforeAutocompleteMenuShow:function(){var t=$(arguments[0].target);return t.parents(".js-add-gear").find(".js-promoted-products").hide(),t.parents(".js-add-gear").find(".clear-gear-input").show(),!0},afterAutocompleteMenuHide:function(){var t=this.$el.find(".js-add-gear .gear-input");return this.switchBetweenTipAndPromotedProducts(t,t.parent().find(".add-gear-tip"),t.parents(".js-add-gear").find(".js-promoted-products")),t.parents(".js-add-gear").find(".clear-gear-input").hide(),!0},createGear:function(t,e,i){"undefined"==typeof i&&(i={"gear[name]":t.val(),"gear[product_id]":e.val(),run_id:t.data("run-id")}),$.ajax({type:"POST",context:t,url:MyASICS.Runs.Routes.addGear,data:i,success:function(t){_.templateSettings={interpolate:/\{\{(.+?)\}\}/g};var e=_.template($("#gear-template").html(),{productImageSrc:t.gear.thumb,gearName:t.gear.name});$(this).removeClass("js-enter-from-autocomplete-menu"),$(this).parent().before(e),$(this).trigger("gearAdded")}})},showRunDetails:function(t){var e=this.$(t.currentTarget);e.closest(".single-run").toggleClass("expanded"),this.maybeShowMap()},hideRunDetails:function(t){var e=this.$(t.currentTarget);e.closest("div.single-run").removeClass("expanded")},closeDetails:function(t){this.$(".rActive").removeClass("rActive"),this.$(".rEditC.show").removeClass("show")},maybeShowMap:function(){var t=this.$el.find("[data-map-path]:not(.loaded)");0!=t.length&&$.getJSON(t.data("map-path"),function(e){var i=MyASICS.RouteMaps.makeMap({map_dom_id:".single-run [data-run-id='"+t.data("run-id")+"'][data-map-path='"+t.data("map-path")+"']",centerLatLng:[e.center_latitude,e.center_longitude],zoom:e.zoom,bounds:e.bounds,disableDefaultUI:!0},e);this.options.routeMap=i,i.drawRoute(),i.highlightDifferentPaceRoute(this.$(".laps tbody tr")),t.addClass("loaded")}.bind(this))}}),CtaView:Backbone.View.extend({initialize:function(){this.nextRun=new MyASICS.Running.NextRunView({el:"#next-run"}),this.comparison=new MyASICS.widgets.views.Comparison({el:"#compare-performance"}),this.tips=new MyASICS.Running.TipsView({el:"#training-tips"})}}),NextRunView:Backbone.View.extend({events:{"click #log-this":"logRun"},logRun:function(t){MyASICS.Utils.scrollToTop()}}),TipsView:Backbone.View.extend({events:{"click .prevTip, .nextTip":"slideTips"},slideTips:function(t){t.currenTarget;t.preventDefault(),this.$(".tips-inner-box").load(t.target.href)}})},MyASICS.Running.PaceGraphView=Backbone.View.extend({events:{"hover .laps tbody tr":"focusLapData","mouseleave .laps tbody":"unfocusLapData"},focusLapData:function(t){this.selectLap($(t.currentTarget).data("index"))},unfocusLapData:function(t){this.mapView().highlightRouteSegment(this.route().length()+1,0)},selectLap:function(t){var e=this.lapAt(t);this.mapView().highlightRouteSegment(e.distanceOffset,e.distance),this.$(".laps [data-index]").removeClass("highlighted"),this.$(".laps [data-index="+t+"]").addClass("highlighted")},lapAt:function(t){return this.$(".laps [data-index="+t+"]").data()},mapView:function(){return this.options.mapView},route:function(){return this.options.mapView.route}}),MyASICS.NotificationView=Backbone.View.extend({render:function(){this.showNotification(),this.autoCloseNotification(this)},events:{"click .close-notification":"closeNotification"},showNotification:function(){this.$el.removeClass("closed").addClass("shown")},closeNotification:function(){this.$el.removeClass("shown").addClass("closed")},autoCloseNotification:function(t){this.options.timeout&&setTimeout(t.closeNotification.bind(t),this.options.timeout)}}),MyASICS.PerformanceGraphView=MyASICS.GraphView.extend({options:{xInset:35,offsetToTop:320,colors:{blank:["#F4F4F4","#F4F4F4"],no_log:["#e7f7fd","#d1e8f4"],injured:["url(/assets/performance/perf_injury_pattern-fdbe0419402b37356bb010697fcd39d14f25b688caaaefd8e42676856dcfb7af.gif)","#ed7e82"],injured_rest:["url(/assets/performance/perf_injury_pattern-fdbe0419402b37356bb010697fcd39d14f25b688caaaefd8e42676856dcfb7af.gif)","#ed7e82"],event:["#002351","#d1e8f4"],rest:["#002351","#d1e8f4"],run:["#d1e8f4","#285caf"],axis:"#E6E9EB",line:"#97daf7",hover:"white",dateMarker:"#E6E9EB",dateText:"#000"}},render:function(){this.raphael.clear(),this.drawColumns(),this.drawLines(),this.drawPoints(),this.drawAxes()},drawAxes:function(){this.drawAbscissa(),(this.drawOrdinateAxis&&!this.logs.isEmpty()||this.maxPrimary!=-(1/0))&&this.drawOrdinate(),this.fillBottomLeft()},drawPoints:function(){this.logs.each(function(t){this.point(t)},this)},drawLines:function(){if(this.markPoints&&!this.logs.isEmpty()){var t=this.field,e=this.interp(0),i=[[-.5,this.percentage(e[0])]];this.logs.each(function(e){var n=e.get(t);"injured"==e.get("type")?i.push([e.day(),null]):n&&i.push([e.day(),this.percentage(n)])},this),i.push([this.logs.days(),null]);var n=this.path(i);n.attr("stroke",this.colors.line)}},fillBottomLeft:function(){var t=this.path([[-1,this.yP(0)],[35,this.yP(0)],[35,this.yP(-1)],[-1,this.yP(-1)]],!0);t.attr({fill:"#F2F4F5",stroke:!1})},onColumnMouseover:function(t,e){var i=this.logs.findLog(e);if(i){var n=this.percentage(this.interp(e)[1]);this.showPopup(t,this.yP(n),e,i)}var a=this.getColumnOptions(e).hover;a&&this.changeColor(t.prev,a)},onColumnMouseout:function(t,e){$(".runPopup").hide();var i=this.getColumnOptions(e).fill;i&&this.changeColor(t.prev,i)},changeColor:function(t,e){t.node.style.fill="",t.attr("fill",e)},ordinateFormat:function(t,e){switch(t){case"time":return Math.round(e/60);case"pace_km":case"pace_mi":return MyASICS.Utils.int2ms(e)}return e},popupFormat:function(e,i){var n=i.get("type");return{date:l(mjd2Date(i.get("mjd")),"grass"),time:i.get("time")&&MyASICS.Utils.int2hms(i.get("time")),pace_km:i.get("pace_km")&&t("formats.%{pace}min/km",{pace:MyASICS.Utils.int2hms(i.get("pace_km"))}),pace_mi:i.get("pace_mi")&&t("formats.%{pace}min/mi",{pace:MyASICS.Utils.int2hms(i.get("pace_mi"))}),distance_km:i.get("distance_km")&&t("formats.%{count}km",{count:MyASICS.Utils.localizeDecimal(i.get("distance_km"))}),distance_mi:i.get("distance_mi")&&t("formats.%{count}mi",{count:MyASICS.Utils.localizeDecimal(i.get("distance_mi"))}),type:n}},getColumnOptions:function(t,e){var i,n={},a=this.logs.getType(t);if(e)n={y1:1,y2:1,opacity:0};else if("blank"==a||"injured_rest"==a)n={y1:1,y2:1};else if(i=this.logs.getValue(t))n={y1:this.percentage(i),y2:this.percentage(i)};else{var s=this.logs.nextLog(t);if(this.interpolatePoints&&(!s||"event"!=s.get("type"))){var r=this.interp(t);n={y1:this.percentage(r[0]),y2:this.percentage(r[2])}}}return _.defaults(n,{fill:this.colors[a][0],hover:this.colors[a][1],stroke:!1})},getPointOptions:function(t){var e={fill:this.colors.run[1],stroke:!1},i=t.get("type");return"event"==i?e.fill=this.colors.event[0]:this.markInjuries&&"injured"==i&&(e.fill=this.colors.injured[1]),e}}),MyASICS.PersonalBestView=Backbone.View.extend({el:".logContent",events:{"click .add":"validate"},validate:function(t){var e=this.validFormContent();e||t.preventDefault()},validFormContent:function(){var t=!0;return t=this.validateEventDate(t),t=this.validateRequiredContent(t)},validateEventDate:function(t){var e=void 0;try{e=this.$("#personal_best_event_date").val()}catch(i){}return"undefined"==typeof e&&(t=!1),t},validateRequiredContent:function(t){return $(".personal-best-form input[type=text]").each(function(){""==this.value?(t=!1,$(this).next(".error-message").show()):$(this).next(".error-message").hide()}),t}}),MyASICS.Plans.FormView=Backbone.View.extend({events:{"click button":MyASICS.Utils.preventDefault,"click #your-race-date":"editDate","change #plan_course_id":"changeCourse","change #plan_event_date":"changeEventDate","change .options":function(){this.table.load()},"click #save-plan-button":"savePlan","click #wday button[data-increment]":"changeSlide","click #show-all-runs.edit-mode":"showAllRuns","click #show-future-runs.edit-mode":"showFutureRuns","mouseover #show-help":"showHelp","mouseout #show-help":"hideHelp","mouseover #prediction-help":"showHelp","mouseout #prediction-help":"hideHelp"},showHelp:function(t){"show-help"!=$(t.target).attr("id")||$(t.target).hasClass("help-shown")||($(t.target).addClass("help-shown"),this.positionHelp()),this.$("#prediction-help").clearQueue().fadeIn(200)},hideHelp:function(t){this.$("#prediction-help").delay(1e3).fadeOut(200,function(){$(this).css("opacity","1")}),setTimeout(function(){this.$("#prediction-help").is(":visible")||$(t.target).removeClass("help-shown")},1300)},positionHelp:function(){var t=this.$("#show-help").position().left+this.$("#show-help").outerWidth(),e=this.$("#prediction .view").position().left+this.$("#prediction .view").outerWidth(),i=t>e?t:e,n=this.$("#prediction-help").outerWidth()-this.$("#prediction-help").width(),a=this.$("#form-actions").position().left-i;this.$("#prediction-help").css("left",i+"px"),this.$("#prediction-help").width(a-n)},showAllRuns:function(t){this.runsToShow=this.showAllRuns,this.table.calendar.showPastRuns(),this.$("#show-all-runs").hide(),this.$("#show-future-runs").show()},showFutureRuns:function(t){this.runsToShow=this.showFutureRuns,this.table.calendar.hidePastRuns(),this.$("#show-future-runs").hide(),this.$("#show-all-runs").show()},initialize:function(e){var i=this;this.$("#plan_event_date").datepicker({dateFormat:t("js.date_format")}).addClass("bindedPicker"),this.model.editMode()&&(this.$("#plan_event_date").data("editMode",!0),this.$("#plan_event_date").datepicker("option",{minDate:this.$("#previous_plan_id").data("min-event-date-in-day"),maxDate:this.$("#previous_plan_id").data("max-event-date-in-day")}),this.disableCourseSelector()),MyASICS.Plans.setMinEventDate(this.$("#plan_event_date"),this.$("#plan_course_id").val(),this.$("#plan_experience").val()),MyASICS.Plans.validateEventDate(this.$("#plan_event_date"),!0)||(this.editDate({currentTarget:this.$("#your-race-date")},!1),this.disableSaveOnValidationFail()),this.table=this.options.table,this.table.on("loading",this.render,this),this.table.on("loaded",this.render,this),this.runsToShow=this.showFutureRuns,this.tour=new MyASICS.Plans.TourView({el:this.el}),this.tour.on("start",function(){$("button#take-a-tour").hide()}),this.tour.on("end",function(){$("button#take-a-tour").show()});var n=document;$.browser.msie&&(parseInt($.browser.version)<=8?n=null:parseInt($.browser.version)<9&&(n=window)),n&&$(n).on("scroll",function(){i.tour.inProgress()||MyASICS.Plans.switchFixedPanel(i)}),this.predictor=new MyASICS.Plans.PlanPrediction(this.model),this.predictor.on("loading",this.render,this),this.predictor.on("loaded",this.firstRun,this),this.fourRunsOption=this.$("input[name='plan[days]'][value=4]").closest("li"),this.pendingRenders=0,this.predictor.update(this.$el);var a=this.$(".chrome #show-help");if(a.length>0){var s=this.$("#prediction .title span").width()+parseFloat(a.css("margin-left"))+parseFloat(a.css("padding-left"))+a.width();a.css("left",s+"px")}},firstRun:function(){this.predictor.off("loaded",this.firstRun,this),this.predictor.on("loaded",this.table.load,this.table),this.setRecommendation(this.predictor.recommendation(this.model.goal())),this.table.load()},render:function(){if(this.checkFrequencyOptions(),setTimeout(function(){var t=parseInt($("#ui-datepicker-div").css("left"))>0&&$("#ui-datepicker-div table.ui-datepicker-calendar").is(":visible");MyASICS.Plans.setMinEventDate(this.$("#plan_event_date"),this.$("#plan_course_id").val(),this.$("#plan_experience").val()),t&&this.$("#plan_event_date").datepicker("show")},1e3),this.model.isValid()){var t=this.rendering;t.improvement(this),this.predictor.isUpdating()||this.table.isLoading()?(this.$el.addClass("loading-table"),this.disableSaveOnUpdating()):(this.$el.removeClass("loading-table"),t.prediction(this),t.summary(this),this.enableSave())}else this.disableSaveOnValidationFail();return this.runsToShow(),this},disableCourseSelector:function(){this.$("#plan_course_id").attr("disabled",!0),this.$("#your-course").removeClass("editable")},setRecommendation:function(t){t&&!this.model.editMode()&&(MyASICS.Utils.setRadioGroup(this,"plan[days]",t.days),MyASICS.Utils.setRadioGroup(this,"plan[training_intensity]",t.training_intensity))},predictedSeconds:function(){var t=this.model.days(),e=this.model.trainingIntensity();return this.predictor.prediction({days:t,training_intensity:e})},changeCourse:function(t){MyASICS.Plans.setMinEventDate(this.$("#plan_event_date"),this.$("#plan_course_id").val(),this.$("#plan_experience").val());var e=$(t.currentTarget).find("option:selected").text();this.$("#your-course .content").text(e),MyASICS.Plans.validateEventDate(this.$("#plan_event_date"),!0)?this.predictor.update(this.$el):(this.editDate({currentTarget:this.$("#your-race-date")},!1),this.render())},changeEventDate:function(t){var e=$(t.currentTarget),i=e.closest("#your-race-date");MyASICS.Plans.validateEventDate(this.$("#plan_event_date"),!0)?(this.$("#save-plan-button").attr("disabled",null).removeClass("loading"),i.removeClass("editing").find(".content").text(e.val()),this.predictor.update(this.$el)):this.render()},editDetail:function(t){var e=$(t.currentTarget),i=e.hasClass("editing");return e.addClass("editing"),!i},editDate:function(t,e){this.editDetail(t),"undefined"==typeof e&&this.$("#plan_event_date").datepicker("show")},checkFrequencyOptions:function(){var t=parseInt(this.model.days());this.fourRunsOption.remove(),this.model.allows4Runs()?(this.$("#runs-per-week .options").append(this.fourRunsOption),MyASICS.Utils.setRadioGroup(this,"plan[days]",t)):t>3&&MyASICS.Utils.setRadioGroup(this,"plan[days]",3)},rendering:{prediction:function(t,e){null==e&&(e=t.predictedSeconds());var i="--:--:--";isNaN(e)||(i=MyASICS.Utils.hms(e));var n=t.$("#predicted-time").text();n==i||isNaN(e)||(t.$("#predicted-time").addClass("changed"),setTimeout(function(){t.$("#predicted-time").removeClass("changed")},0)),t.$("#predicted-time").text(i)},improvement:function(t){this._deltaPrediction(t,"days",{training_intensity:t.model.trainingIntensity()}),this._deltaPrediction(t,"training_intensity",{days:t.model.days()})},summary:function(e){var i=e.$("#your-race-date .content").text(),n=e.predictedSeconds();n=isNaN(n)?"":MyASICS.Utils.hms(n);var a=e.model.courseCode(),s=t("js.new_plan_summary."+a+"_at_%{prediction}_on_%{date}_html",{date:i,prediction:n});e.$("#summary-text").html(s).addClass("changed"),setTimeout(function(){e.$("#summary-text").removeClass("changed")},0)},_deltaPrediction:function(t,e,i){var n=t.predictedSeconds(),a=this;$("input[name='plan["+e+"]']").each(function(){var s=$(this).val();i[e]=s;var r=t.predictor.prediction(i);r=isNaN(r)?"\u2014":a._inMinutes(r-n),t.$("[data-"+e+"="+s+"]").text(r)})},_inMinutes:function(t){var e="m";return Math.abs(t)<60?(e="s",t=Math.round(t)):t=Math.round(t/60),(0>t?t:"+"+t)+e}},savePlan:function(t){if("facebox"==this.$el.attr("rel"))t.preventDefault(),showSignupForm();else if(this.$el.data("needs-confirmation")){t.preventDefault();var e=this,i=this.model.editMode()?$("#confirm-update-popup").html():$("#confirm-popup").html(),n=new MyASICS.Plans.ConfirmView({content:i,id:"#confirm-replace-plan"});n.on("confirmed",function(){$.facebox.close(),e.disableSaveOnUpdating(),e.el.submit()}),n.on("confirmationCancelled",function(){$.facebox.close()})}},disableSaveOnUpdating:function(){var t=this.$("#save-plan-button");t.data("enable-with")||(t.data("enable-with",t.val()),t.val(t.data("disable-with"))),t.attr("disabled","disabled").addClass("loading").val(t.data("disable-with"))},disableSaveOnValidationFail:function(){var t=this.$("#save-plan-button");t.attr("disabled","disabled").addClass("loading"),this.$el.addClass("loading-table"),t.data("enable-with")&&t.val(t.data("enable-with"))},enableSave:function(){if(this.model.isValid()){var t=this.$("#save-plan-button");t.attr("disabled",null).removeClass("loading").val(t.data("enable-with"))}},changeSlide:function(t){var e=parseFloat($(t.currentTarget).data("increment"));this.model.slide(e);this.table.load(),this.render()}}),MyASICS.Plans.PrepView=Backbone.View.extend({events:{"change #for-event":"setTrainingForEvent",change:"render","change #plan_course_id":function(t){MyASICS.Plans.setMinEventDate(this.$("#plan_event_date"),this.$("#plan_course_id").val(),this.$("#plan_experience").val()),this.validateEventDate()},"change #plan_experience":function(t){MyASICS.Plans.setMinEventDate(this.$("#plan_event_date"),this.$("#plan_course_id").val(),this.$("#plan_experience").val())},"focus [data-uncheck-on-focus] input":"clearCheckbox","focus input[data-uncheck-on-focus]":"clearCheckbox","change input[name='plan[event_date]'][type='checkbox']":"clearEventDate","change input[name='plan[goal]'][type='checkbox']":"clearGoalTime","change [name='plan[event_date]'][type=text]":function(t){this.validateEventDate()},"change select#plan_experience":function(){this.togglePerformanceTime(),this.validateEventDate();
},"change #performance_time input[type='text']":function(t){this.reformatHmsField(t)},"change .js-goal-time input[type='text']":function(t){this.reformatHmsField(t)},"change input[name='plan[gender]']":"validateGender","change #plan_age":"validateAge",submit:"validate"},initialize:function(){this.initEventDate(),this.loadHashParams();var t=$.url.param("c");if(t&&this.$("#plan_course_id").val(t),MyASICS.Plans.setMinEventDate(this.$("#plan_event_date"),this.$("#plan_course_id").val(),this.$("#plan_experience").val()),this.validateEventDate(),""!==this.$("#plan_event_date").val()){var e=this.$("#for-event");e.attr("checked",!0),this.setTrainingForEvent({target:e})}},initEventDate:function(){this.$("#plan_event_date").val(),this.$("#plan_event_date").data("min-date");this.$("#plan_event_date").datepicker({dateFormat:t("js.date_format")}).addClass("bindedPicker")},loadHashParams:function(){var t=this,e=document.location.hash.substr(1);if("/prep"==e.substr(0,5)){var i=e.split("?")[1];i&&(i=decodeURIComponent(i),_.each(i.split("&"),function(e){e=e.split("=");var i=e[0],n=e[1];n.length>0&&(t.$("select[name='"+i+"']").val(n),t.$("input[type=text][name='"+i+"']").val(n),t.$("input[type=number][name='"+i+"']").val(n),t.$("input[type=date][name='"+i+"']").val(n),t.$("input[type=checkbox][name='"+i+"'][value='"+n+"']").attr("checked",!0),MyASICS.Utils.setRadioGroup(t,i,n))}))}},render:function(){return $.browser.msie&&this.$("input[placeholder]").placeholder(),this},setTrainingForEvent:function(t){var e=!0;$(t.target).is(":checked")&&(e=!1),this.$(".goal-time").toggleClass("hidden",e),this.$(".event-date").toggleClass("hidden",e)},clearCheckbox:function(t){var e=$(t.target).closest("[data-uncheck-on-focus]").data("uncheck-on-focus");this.$(e).is(":checked")&&this.$(e).attr("checked",!1).trigger("change")},reformatHmsField:function(t){var e=$(t.target).closest(".hms-area").find("input[type=text]");if(this.validateHmsFields(e,!1,!0)){var i=3600*$(e[0]).val()+60*$(e[1]).val()+1*$(e[2]).val(),n=MyASICS.Utils.hms(i).split(":");$.each(e,function(t,e){(""!=$(e).val()||n[t].match(/[1-9]/))&&$(e).val(n[t])})}},togglePerformanceTime:function(){if(MyASICS.Plans.isBeginner(this.$("#plan_experience").val()))this.$("#performance_time").hide(),this.$("#performance_time").removeClass("has-error"),this.$("#performance_time input").val("");else{var t=this.$("#performance_time"),e="<div id='temp_holder'></div>";t.before(e),setTimeout(function(){t.show(),t.parent("div").remove("#temp_holder")},20)}},clearEventDate:function(e){var i=$(e.target).is(":checked");i?(this.$("[name='plan[event_date]'][type=text]").val("").attr("placeholder","").addClass("input-disabled"),this.$("#plan_event_date").parents(".js-event-date-container").removeClass("has-error").children(".error-message").html("").hide()):this.$("[name='plan[event_date]'][type=text]").attr("placeholder",t("js.date_format_full_year_for_placeholder")).removeClass("input-disabled")},clearGoalTime:function(e){var i=$(e.target).is(":checked");if(i)this.$(".js-goal-time input").val("").attr("placeholder","").addClass("input-disabled"),this.$(".js-goal-time input").parents(".hms-area").removeClass("has-error").children(".error-message").html("").hide();else{var n={0:t("js.placeholders.hours"),1:t("js.placeholders.minutes"),2:t("js.placeholders.seconds")};$.each(this.$(".js-goal-time input"),function(t,e){$(e).attr("placeholder",n[t]).removeClass("input-disabled")})}},validateEventDate:function(t){return t=MyASICS.Plans.validateEventDate(this.$("#plan_event_date"),t)},validate:function(t){var e=this.validFormContent();e?window.location.hash="/prep?"+this.$el.serialize():(t.preventDefault(),setTimeout(function(){this.$("input[type='submit']").val(this.$("input[type='submit']").data("origin-value")).attr("disabled",!1)}.bind(this),100))},validFormContent:function(){var t=!0,e=this.$("#performance_time.hms-area input[type='text']"),i=this.$(".js-goal-time.hms-area input[type='text']");return t=this.validateHmsFields(i,!1,t),MyASICS.Plans.isBeginner(this.$("#plan_experience").val())||(t=this.validateHmsFields(e,!0,t)),t=this.validateEventDate(t),t=this.validateGender(t),t=this.validateAge(t)},validateAge:function(t){var e=this.$("#plan_age"),i=MyASICS.Utils.transliterate(e.val());return e.val(i),isNaN(i)||0>=i||i>100?(t=!1,this.$("#plan_age").next(".error-message").addClass("visible")):this.$("#plan_age").next(".error-message").removeClass("visible"),t},validateGender:function(t){var e=this.$("input[name='plan[gender]']");return e.is(":checked")?this.$(".gender_area .error-message").removeClass("visible"):(t=!1,this.$(".gender_area .error-message").addClass("visible")),t},validateHmsFields:function(t,e,i){var n=!1,a=!0,s=!0;if(e){var r=!0;$.each(t,function(t,e){""==$(e).val()&&r?a=!1:(r=!1,a=!0)})}return $.each(t,function(t,e){var i=MyASICS.Utils.transliterate($(e).val());$(e).val(i),(isNaN(i)||0>i)&&(s=!1)}),s&&a||(n=!0,i=!1),n?$(t[0]).parents(".hms-area").addClass("has-error"):$(t[0]).parents(".hms-area").removeClass("has-error"),i}}),MyASICS.Plans.ConfirmView=Backbone.View.extend({events:{"click .confirm":"confirm","click .cancel":"cancelConfirmation"},initialize:function(t){$.faceboxContent(t.content),this.setElement($(t.id)[0])},confirm:function(t){$(t.currentTarget).is(":disabled")||($(t.currentTarget).attr("disabled","disabled"),this.trigger("confirmed"))},cancelConfirmation:function(){this.trigger("confirmationCancelled")}}),MyASICS.Plans.PlanPrediction=function(t){var e=this;this.data={},this.pendingUpdates=0,this.update=function(i){t.isValid()&&(e.data={},this.pendingUpdates+=1,e.trigger("loading"),$.getJSON(MyASICS.Plans.Routes.predictions+"?"+i.serialize(),function(t){e.data=t,e.pendingUpdates-=1,e.pendingUpdates<0&&(e.pendingUpdates=0),0==e.pendingUpdates&&e.trigger("loaded")}))},this.isUpdating=function(){return this.pendingUpdates>0},this.prediction=function(t){var e=this.data.predictions,i=NaN;return e&&(i=e[t.days][t.training_intensity]),Math.round(i)},this.recommendation=function(e){if(isNaN(e))return{days:t.days(),training_intensity:t.trainingIntensity()};for(var i=["mild","promising","difficult"];i.length>0;)for(var n=i.shift(),a=[2,3,4];a.length>0;){var s=a.shift();if(this.prediction({days:s,training_intensity:n})<e)return{days:s,training_intensity:n}}var s=this.allows4Runs?4:3;return{days:s,training_intensity:"difficult"}},_.extend(this,Backbone.Events)},MyASICS.Plans.Plan=function(t){var e=$(t);this.data={},this.get=function(t){return this.data[t]},this.isValid=function(){return MyASICS.Plans.validateEventDate(e.find("#plan_event_date"),!0)},this.goal=function(){var t=function(t){return""===t?0:parseInt(t)},i=t(e.find("[name='plan[goal_time_hms[hours]]']").val()),n=t(e.find("[name='plan[goal_time_hms[minutes]]']").val()),a=t(e.find("[name='plan[goal_time_hms[seconds]]']").val()),s=3600*i+60*n+a;return s>0?s:NaN},this.days=function(){return e.find("input[name='plan[days]']:checked").val()},this.trainingIntensity=function(){return e.find("input[name='plan[training_intensity]']:checked").val()},this.courseCode=function(){var t=e.find("#plan_course_id").val();for(code in MyASICS.Plans.Courses)if(MyASICS.Plans.Courses[code]==t)return code;return null},this.allows4Runs=function(){return"5km"!=this.courseCode()},this.slide=function(t){var i=e.find("input[name='plan[slide]']"),n=parseFloat(i.val());return t&&(n+=t,n+=10,n%=7,n-=3,i.val(n)),n},this.editMode=function(){return 0!=e.find("#previous_plan_id").length},_.extend(this,Backbone.Events)},MyASICS.Plans.TableView=Backbone.View.extend({load:function(){var t=this;jQuery.ajax({url:MyASICS.Plans.Routes.preview,data:$("form").serializeArray(),beforeSend:function(){t.loading()},success:function(e,i){t.loaded(e),t.calendar.markTodayAndPast(),t.calendar.hidePastRuns()},error:function(t,e,i){},type:"GET"})},initialize:function(){this.calendar=new MyASICS.Plans.CalendarView({el:this.$("#schedule")[0],disableLogRunForm:!0,page:"plan:show"}),this.pendingLoads=0},loading:function(){this.pendingLoads+=1,this.$("#schedule").addClass("loading-data"),this.trigger("loading")},loaded:function(t){this.pendingLoads-=1,this.pendingLoads<=0&&(this.pendingLoads=0,this.$("#schedule").removeClass("loading-data"),this.$("#schedule").html(t),this.calendar.render(),this.trigger("loaded")),this.model.editMode()||this.hidePrintedRests()},isLoading:function(){return this.pendingLoads>0},hidePrintedRests:function(){this.$("tr").each(function(t,e){$("td:last-child",e).hasClass("past")&&$(e).addClass("hidden")}),this.$("tr:visible:not(.phaseWrap):not(.weekdays):first").addClass("first-after-phase")}}),MyASICS.Plans.RunDetails=Backbone.Model.extend({initialize:function(t){if(this.get("runId"))this.set("description",""),this.set("durationData",this.durationData());else{var e=this.get("menu");this.set("description",MyASICS.Plans.RunDetails.menus[e].description),"F/C"==e&&this.set("comfortableDistance",this.get("dist")-this.get("fastDistance")),"R"!=e&&this.set("durationData",this.durationData())}},durationData:function(){function e(t){var e=MyASICS.Utils.Distance.factor("km",MyASICS.Utils.distanceUnits);return t*e}var i=this.get("paces")||_.compact([this.get("loggedPace")]);if(_.isEmpty(i))return"";if(this.has("comfortableDistance"))var n=[this.get("fastDistance"),this.get("comfortableDistance")];else var n=[this.get("dist")];if(this.has("duration"))var a=[this.get("duration")];else var a=_.map(i,function(t,i){var a=n[Math.floor(i/2)],s=e(t)*a;return MyASICS.Utils.int2hms(s)});var s=_.map(i,function(t){return MyASICS.Utils.int2ms(e(t))});if(i.length>1){var r=t("formats.%{pace_low}_%{pace_high}_min/"+MyASICS.Utils.distanceUnits,{pace_low:s[1],pace_high:s[0]}),o=t("js.%{time_low}_%{time_high}",{time_low:a[0],time_high:a[1]});if(n.length>1)var l=t("formats.%{pace_low}_%{pace_high}_min/"+MyASICS.Utils.distanceUnits,{pace_low:s[3],pace_high:s[2]}),h=t("js.%{time_low}_%{time_high}",{time_low:a[2],time_high:a[3]}),c="js.%{pace_range1}_for_%{time_range1}_then_%{pace_range2}_for_%{time_range2}_html",d={pace_range1:r,time_range1:o,pace_range2:l,time_range2:h};else var c="js.%{pace_range}_for_%{time_range}_html",d={time_range:o,pace_range:r}}else var c="js.%{pace}_for_%{time}_html",d={pace:t("formats.%{pace}min/"+MyASICS.Utils.distanceUnits,{pace:s[0]}),time:a[0]};return t(c,d)}}),MyASICS.Plans.CalendarView=Backbone.View.extend({events:{"click .phaseWrap":"togglePhaseDescription","click td.dnd":"showPopover","click #run-form-in-plan":function(t){t.stopImmediatePropagation()},"click td.dnd .close":"hidePopover",displayed:"setPhaseDescriptionVisibility"},initialize:function(){_.templateSettings={interpolate:/\{\{(.+?)\}\}/g};var t=this;MyASICS.EventCenter.on("reInitLogRunForm",function(){t.loadLogRunForm(t.$(".cell-selected"))}),$("body").on("click",function(e){0==$(e.target).parents("#run-form-in-plan, tr:not(.phaseWrap, .weekdays)").length&&($("#run-form-in-plan").remove(),t.$(".run-details").remove(),t.$("table tr td .planData").removeClass("cell-selected"))}),this.markTodayAndPast()},markTodayAndPast:function(){var t=this.$("td[data-date="+MyASICS.Utils.todayMjd()+"]");t.addClass("today");var e=t.data("date");this.$(".dnd").each(function(t,i){return $(i).data("date")<e?void $(i).addClass("past"):!1})},render:function(){this.setPhaseDescriptionVisibility(),MyASICS.Plans.RunDetails.menus=$.parseJSON(this.$("#menuTextData").text()),this.template=this.$el.find("#menuPopupTemplate").template(),this.fastDistance=this.$("#plan-table-v2").data("fastDistance"),this.$el.find(".phasesPrintHeight h4").setEqualHeight(),this.$el.find(".phasesPrintHeight h5").setEqualHeight(),this.$el.find(".MenusPrintHeight h4").setEqualHeight(),this.$el.find(".MenusPrintHeight h5").setEqualHeight(),this.$("#reschedule-title").hide(),this.$("#plan-title").show(),this.$("td.today .today-overlay").remove(),this.markCurrentMonth(),this.ieEventBackground(),this.adaptZindexForIE()},adaptZindexForIE:function(){$.browser.msie&&this.$("td.dnd").css("z-index",200)},cleanUpForRescheduling:function(){this.setPhaseDescriptionVisibility(),this.hidePopover(),this.$el.off()},ieEventBackground:function(){$.browser.msie&&this.$(".event").append("<div class='radialGradient'><div></div></div>")},setPhaseDescriptionVisibility:function(){this.$(".phaseTitle").removeClass("open").siblings(".phaseDescription").hide();var t=this.today().data("phase");$(".phase-"+t+" .phaseTitle").addClass("open").siblings(".phaseDescription").show()},togglePhaseDescription:function(t){var e=$(t.currentTarget);e.find(".phaseTitle").toggleClass("open"),e.find(".phaseDescription").slideToggle()},resetFirstVisibleTable:function(){this.$(".first-visible-table").removeClass("first-visible-table");var t=this.$("tr.phaseWrap:visible:first").parents("table"),e=t.prev("table:not('.showWeekdays')");this.$("#show-all-runs").is(":visible")&&e.is(":visible")?e.addClass("first-visible-table"):t.addClass("first-visible-table")},showPastRuns:function(t){this.$("#run-form-in-plan").remove(),this.$("tr.phaseWrap").removeClass("hidden"),this.$("tr").has("td.past").removeClass("hidden"),this.$("tr:not(.duplicated-week)").show(),this.resetFirstVisibleTable(),this.$(".first-after-phase").removeClass("first-after-phase")},today:function(){return this.$("td[data-date="+MyASICS.Utils.todayMjd()+"]")},markToday:function(){this.today().addClass("today")},hidePastRuns:function(t){this.$("tr.phaseWrap").next("tr").has("td.past").prev().addClass("hidden"),this.$("tr").has("td.past").addClass("hidden");var e=this.$("td.today"),i=e.data("phase");e.parents("tr").removeClass("hidden"),this.$(".phaseWrap.phase-"+i).last().removeClass("hidden");var n=e.data("date")-7,a=this.$(".pTdBox[data-date$='"+n+"']").parents("tr");if(!_.isEmpty(a)){a.removeClass("hidden");var i=a.find("td").first().data("phase");this.$(".phaseWrap.phase-"+i).last().removeClass("hidden")}this.resetFirstVisibleTable(),this.$("tr:visible:not(.phaseWrap):not(.weekdays):first").addClass("first-after-phase")},hideAllPhaseDescription:function(t){this.$(".phaseTitle").removeClass("open"),this.$(".phaseDescription").hide()},showAllPhaseDescription:function(t){this.$(".phaseTitle").addClass("open"),this.$(".phaseDescription").show()},showPopover:function(t){t&&(t.preventDefault(),t.stopPropagation());var e=$(t.currentTarget),i=mjd2Date(e.data("date")),n=new Date;return i.setHours(0,0,0,0),n.setHours(0,0,0,0),this.options.disableLogRunForm||i.getTime()>n.getTime()?this.showRunDescription(e):this.toggleLogRunForm(e),!1},hidePopover:function(t){return t&&(t.preventDefault(),t.stopPropagation()),"undefined"!=typeof this.popover&&null!=this.popover&&this.popover.remove(),window.mine=this,!1},clearUpLogRunFormAndDescription:function(){$("#run-form-in-plan").remove(),this.$(".run-details").remove()},showRunDescription:function(t){this.$("table tr td .planData").removeClass("cell-selected"),this.clearUpLogRunFormAndDescription(),t.css("z-index",999),"undefined"!=typeof this.popover&&null!=this.popover&&this.popover.remove();var e=$.extend(t.find(".planData").first().data(),t.data());e.fastDistance=this.fastDistance,this.runDetails=new MyASICS.Plans.RunDetails(e),this.popover=$.tmpl(this.template,this.runDetails.toJSON()),$.browser.msie&&$(this.popover).css("z-index",9999),t.find(".planData:first").stop().after(this.popover).parent()},toggleLogRunForm:function(t){var e=$("#run-form-in-plan"),i=e.data("date"),n=!!e.length,a=t.closest("td");n?(e.remove(),this.$("table tr td .planData").removeClass("cell-selected"),i!=a.data("date")&&(a.find(".planData").addClass("cell-selected"),this.loadLogRunForm(t))):(a.find(".planData").addClass("cell-selected"),this.loadLogRunForm(t))},loadLogRunForm:function(t){this.clearUpLogRunFormAndDescription();var e=$.extend(t.find(".planData").first().data(),t.data());e.fastDistance=this.fastDistance,this.runDetails=new MyASICS.Plans.RunDetails(e);var i=$.tmpl(this.$el.find("#logged-run-description").template(),this.runDetails.toJSON()),n=_.template(this.$("#log-run-from-plan-template").html(),{}),a=$(n).addClass("hidden");$("body").append(a),$("#run-form-in-plan .run-description").html(i),0==t.find(".rest").length&&$("#run-form-in-plan .did-not-do").show(),this.positionLogRunForm(t),new MyASICS.Plans.RunView(_.extend(e,{el:a[0],page:this.options.page}))},positionLogRunForm:function(t){var e=t.closest("td"),i=e.offset(),n=$("#run-form-in-plan"),a=i.top-n.outerHeight()+30,s=i.left-109;e.is(":first-child")&&(s+=109,n.children(".arrow-bottom").css("left","-115px")),e.is(":last-child")&&(s-=109,n.children(".arrow-bottom").css("left","103.5px")),n.css({position:"absoulte",top:a,left:s});var r=e.data("phase");n.addClass(r),n.data("date",e.data("date"))},isFinished:function(){var t=this.$(".planData.run:last").closest("[data-date]").data("date");return MyASICS.Utils.todayMjd()>t},markCurrentMonth:function(t){var e=new Date;e.setDate(1);var i=date2Mjd(e);e.setMonth(e.getMonth()+1);var n=date2Mjd(e),a=_.select(this.$el.find("td"),function(t){return $(t).data("date")>=i&&$(t).data("date")<n});$(a).addClass("current-month")},showOnlyWeeks:function(t){this.$("table:not(.showWeekdays) tr").each(function(e,i){var n=_.any(t,function(t){return $(i).find("td[data-date="+t.toString()+"]").length>0});if($(i).removeClass("first-after-phase"),n){$(i).show();var a=$(i).prevAll(".phaseWrap").first();a.show()}else $(i).hide()}),this.$("tr:not(:visible) + tr:not(.phaseWrap)").addClass("first-after-phase")},firstDate:function(){return parseInt(this.$(".planData.run, .planData.ran").first().closest("td").data("date"))},lastDate:function(){return parseInt(this.$(".planData.run, .planData.ran").last().closest("td").data("date"))},makeDatesVisible:function(t,e){var i=[],n=date2Mjd(beginningOfWeek(t));return n=_.max([n,this.firstDate()+1]),n=_.min([n,this.lastDate()-7*e+1]),_(e).times(function(t){i[i.length]=n+7*t}),this.showOnlyWeeks(i),beginningOfWeek(mjd2Date(n))}}),MyASICS.Plans.Rescheduleable=Backbone.View.extend({isDraggable:function(){return!("E"==this.$el.data("menu")||_.isNumber(this.$el.data("runId")))},isDroppable:function(){return!("E"==this.$(".planData").data("menu")||_.isNumber(this.$(".planData").data("runId")))},draggable:function(){return this._clickableForDrag(),this._draggable(),this},droppable:function(){return this._clickableForDrop(),this._droppable(),this},_clickableForDrag:function(){var t=this,e=t.day,i=t.day.calendar;return this.$el.on("click",function(n){!i.dragging&&t.isDraggable()&&(n.preventDefault(),n.stopPropagation(),i.draggingRun=t,i.originalDay=e,i.startDragging())}),t},_draggable:function(){var t=this,e=t.day,i=t.day.calendar;return t.isDraggable()?($(t.$el).draggable({revert:"invalid",helper:"clone",zIndex:10,start:function(n,a){i.revert=!0,i.draggingRun=t,i.originalDay=e,i.startDragging(),$(this).hide(),e.runs[1]&&e.runs[1].$el.show(),e.$el.droppable("destroy")},stop:function(t,n){i.stopDragging(),i.revert&&(e.runs[1]&&e.runs[1].$el.hide(),$(this).show())}}),t):t},_clickableForDrop:function(){var t=this,e=t.calendar;return t.$el.on("click",function(i){if(i.preventDefault(),i.stopPropagation(),e.dragging&&t.isDroppable()){if(!t.$(".overlay").hasClass("active")){var n=e.originalDay.$el.data("date"),a=t.$el.data("date");a!=n&&t.moveRunFrom(e.originalDay)}e.stopDragging()}}),t},_droppable:function(){var t=this,e=t.calendar;return t.isDroppable()?($(t.$el).droppable({hoverClass:"drophover",drop:function(i,n){var a=e.originalDay.$el.data("date"),s=t.$el.data("date");s!=a&&(e.revert=!1,t.moveRunFrom(e.originalDay))}}),t):t}}),MyASICS.Plans.RescheduleCalendarView=Backbone.View.extend({initialize:function(t){var e=this;this.control=t.control,this.calendar=t.calendar,this.control.find("#reschedule-save-button").on("click",function(){e.save()}),this.control.find("#reschedule-cancel-button").on("click",function(){e.cancel()}),this.on("reschedule:success",this.resetCalendar,this)},render:function(){var t=this;this.calendarTpl=this.calendar.$el.children().clone(),this.setElement(this.calendar.el),this.$el.attr("id","reschedule"),setTimeout(function(){t.days=t.initDays()},2),this.calendar.undelegateEvents(),this.calendar.cleanUpForRescheduling(),this.removeRest(),this.fixIEZindex(),this.$("#plan-table-v2 td:last-child").addClass("last"),this.$("#plan-table-v2 tr:last").addClass("last"),this.$(".phaseTitle s").hide(),this.$("td.today .date").append("<div class='today-overlay'></div>")},resetCalendar:function(){this.$el.attr("id","schedule"),this.undelegateEvents(),this.calendar.setElement(this.el),this.calendar.render()},fixIEZindex:function(){if($.browser.msie){var t=1e3;this.$("td.dnd").each(function(){$(this).css("zIndex",t),t-=2})}},initDays:function(){var t=this;return _.map(this.$("tr:not(.duplicated-week) td.dnd .pTdBox"),function(e){var i=new MyASICS.Plans.DayView({el:e,calendar:t,page:this.options.page});return _.each(i.$(".planData"),function(t){var e=new MyASICS.Plans.PlannedRunView({el:t,day:i,page:this.options.page});i.runs.push(e)},this),i},this)},save:function(){var t=this,e={authenticity_token:$("meta[name=csrf-token]").attr("content"),planned_runs:{}};return _.each(this.days,function(t){if(t.changed){_.map(t.runs,function(i){if(i.changed){var n=$.datepicker.formatDate("yy-mm-dd",mjd2Date(t.$el.data("date")));e.planned_runs[i.$el.data("id")]={date:n},0==_.indexOf(t.runs,i)?e.planned_runs[i.$el.data("id")].covered=0:e.planned_runs[i.$el.data("id")].covered=1}})}}),$.isEmptyObject(e.planned_runs)?(this.calendar.$el.html(this.calendarTpl),void this.trigger("reschedule:success")):void jQuery.ajax({url:$("#reschedule").data("reschedule-running-plan-path"),data:e,dataType:"json",type:"POST",beforeSend:function(){t.disableRescheduleButtons()},success:function(e,i){t.enableRescheduleButtons(),t.calendar.$el.html(e.plan_table),t.trigger("reschedule:success")},error:function(e,i,n){t.enableRescheduleButtons(),t.trigger("reschedule:error")}})},cancel:function(){this.calendar.$el.html(this.calendarTpl),this.resetCalendar(),this.trigger("reschedule:cancel")},enableRescheduleButtons:function(){var t=this.control.find("#reschedule-save-button"),e=this.control.find("#reschedule-cancel-button");t.text(t.data("enable-with")),t.attr("disabled",null).removeClass("loading"),e.attr("disabled",null).removeClass("loading")},disableRescheduleButtons:function(){var t=this.control.find("#reschedule-save-button"),e=this.control.find("#reschedule-cancel-button");t.text(t.data("disable-with")),t.attr("disabled","disabled").addClass("loading"),e.attr("disabled","disabled").addClass("loading")},startDragging:function(){this.dragging=!0,this.$el.addClass("dragging"),this.originalDay.$el.parent().addClass("selected"),this.originalDay.fixZindex(),this.dayOfWarning&&this.dayOfWarning.cancelWarning(),this.generateOverlay()},stopDragging:function(){this.dragging=!1,this.$el.removeClass("dragging"),this.originalDay.$el.parent().removeClass("selected"),this.originalDay.$el.removeClass("dragging"),this.originalDay.recoverZindex(),this.removeOverlay()},generateOverlay:function(){for(var t=(this.draggingRun.$el.data("original-date"),_.indexOf(this.days,this.originalDay)),e=this.days.length,i=t-1,n=t+1;i>=0||e>n;i--&&n++)i>=0&&(this.draggingRun.canMoveEarlier()?(this.days[i].$(".overlay").addClass("disabled"),this.days[i].runs.length>0&&(i=-1)):i=-1),e>n&&(this.draggingRun.canMoveLater()?(this.days[n].$(".overlay").addClass("disabled"),this.days[n].runs.length>0&&(n=e)):n=e);this.originalDay.$(".overlay").addClass("disabled"),this.$(".phaseWrap .overlay").addClass("active"),this.$(".pTdBox .overlay:not(.disabled)").addClass("active").parent().droppable("destroy")},removeOverlay:function(){var t=this;this.$(".phaseWrap .overlay").removeClass("active"),this.$(".pTdBox .overlay").removeClass("disabled").removeClass("active"),setTimeout(function(){_.each(t.days,function(t){t.droppable()})},2)},removeRest:function(){this.$(".rest.planData").remove()}}),MyASICS.Plans.DayView=MyASICS.Plans.Rescheduleable.extend({events:{"click .consecutiveHint .cancel":"cancelWarning","click .consecutiveHint .undo":"undoWarning"},initialize:function(t){this.calendar=t.calendar,this.runs=[],this.droppable()},minDate:function(){if(this.runs.length>0){var t=_.min(this.runs,function(t){return t.$el.data("original-date")});return t.$el.data("original-date")}},maxDate:function(){if(this.runs.length>0){var t=_.min(this.runs,function(t){return t.$el.data("original-date")});return t.$el.data("original-date")}},moveRunFrom:function(t){t.$(".run.planData").first().remove(),t.$(".run.planData").first().show();var e=t.runs.shift();e.day=this,this.changed=!0,e.changed=!0,this.runs[0]&&(this.runs[0].changed=!0),t.changed=!0,t.runs[0]&&(t.runs[0].changed=!0),this.runs.unshift(e),this.$(".run.planData").first().hide(),this.$(".date").after(e.draggable().$el.show()),this.detectConsecutiveRuns()},detectConsecutiveRuns:function(){var t=_.indexOf(this.calendar.days,this),e=this.calendar.days.length,i=this.calendar.days[t-1],n=this.calendar.days[t+1],a=function(t){return"J/W"==t?"J":t},s=a(this.calendar.draggingRun.$el.data("menu")),r=t>0&&i.runs.length>0&&a(i.runs[0].$el.data("menu")),o=e-1>t&&n.runs.length>0&&a(n.runs[0].$el.data("menu"));"J"!=s&&(r&&"J"!=r&&this.showWarning("left"),o&&"J"!=o&&this.showWarning("right"))},fixZindex:function(){this.originalDayZindex=this.$el.css("z-index"),this.originalTDZindex=this.$el.parent().css("z-index"),this.originalTableZindex=this.$el.parents("table").css("z-index"),this.$el.css("z-index",10),this.$el.parent().css("z-index",2e3),this.$el.parents("table").css("z-index",10)},recoverZindex:function(){this.$el.css("z-index",this.originalDayZindex),this.$el.parent().css("z-index",this.originalTDZindex),this.$el.parents("table").css("z-index",this.originalTableZindex)},fixZindexForWarning:function(){this.zIndexForWarning=this.$el.parent().css("z-index"),this.$el.parent().css("zIndex",2e3)},recoverZindexForWarning:function(){this.$el.parent().css("zIndex",this.zIndexForWarning)},showWarning:function(t){this.fixZindexForWarning(),this.warning=$.tmpl(this.calendar.$el.find("#consecutiveHintTemplate").template()),this.$el.append(this.warning),this.calendar.dayOfWarning=this,$(".consecutiveHint").addClass(t)},cancelWarning:function(t){this.recoverZindexForWarning(),this.calendar.dayOfWarning=null,this.warning.remove()},undoWarning:function(t){this.calendar.originalDay.moveRunFrom(this),this.cancelWarning()}}),MyASICS.Plans.PlannedRunView=MyASICS.Plans.Rescheduleable.extend({initialize:function(t){this.day=t.day,this.draggable()},canMoveEarlier:function(){if(this.day.runs.length>1){var t=_.min(this.day.runs.slice(1),function(t){return t.$el.data("original-date")});return this.$el.data("original-date")<t.$el.data("original-date")}return!0},canMoveLater:function(){if(this.day.runs.length>1){var t=_.max(this.day.runs.slice(1),function(t){return t.$el.data("original-date")});return this.$el.data("original-date")>t.$el.data("original-date")}return!0}}),MyASICS.Plans.MenuView=Backbone.View.extend({events:{"click #show-future-runs":"hidePastRuns","click #show-all-runs":"showPastRuns","mouseover #ics-container input":"focusIcsUrl","mouseenter #plan-options-toggle":"showPlanOptions","mouseleave #plan-options-toggle":"hideMenu","click #reschedule-runs-button":"startRescheduling"},initialize:function(t){var e=this;this.calendar=new MyASICS.Plans.CalendarView({el:t.calendar,page:"plan:show"}),this.calendar.render(),this.hidePastRuns();var i=document;$.browser.msie&&(parseInt($.browser.version)<=8?i=null:parseInt($.browser.version)<9&&(i=window)),i&&$(i).on("scroll",function(){this.pastHidden&&this.calendar.isFinished()||MyASICS.Plans.switchFixedPanel(e)}),this.rescheduler=new MyASICS.Plans.RescheduleCalendarView({control:this.$("#reschedule-title"),calendar:this.calendar,page:"plan:show"}),this.rescheduler.on("reschedule:success",this.stopRescheduling,this),this.rescheduler.on("reschedule:cancel",this.stopRescheduling,this)},startRescheduling:function(){MyASICS.EventCenter.trigger("startPlanRescheduling"),$("#plan-options-toggle").trigger("mouseleave"),this.$("#plan-title").hide(),this.$("#plan-actions").hide(),this.$("#reschedule-title").show(),this.rescheduler.render()},stopRescheduling:function(){this.$("#plan-title").show(),this.$("#plan-actions").show(),this.$("#reschedule-title").hide(),this.hidePastRuns()},showPastRuns:function(t){this.pastHidden=!1,this.$("#show-future-runs").show(),this.$("#show-all-runs").hide(),this.$("#back-to-top").show(),this.$("#plan-table-v2").show(),this.calendar.showPastRuns()},hidePastRuns:function(t){this.pastHidden=!0,this.$("#show-future-runs").hide(),this.$("#show-all-runs").show(),this.calendar.hidePastRuns(),this.calendar.isFinished()&&(this.$("#back-to-top").hide(),this.$("#plan-table-v2").hide())},focusIcsUrl:function(t){this.$("#ics-desc input").select()},showPlanOptions:function(t){$("#plan-options").show()},hideMenu:function(t){$(".dropdown-contents",t.currentTarget).hide()}}),MyASICS.Plans.Run=Backbone.Model.extend({initialize:function(){this.on("change:time_in_seconds",this.setPace,this),this.on("change:distance_in_metres",this.setPace,this),this.urlRoot=MyASICS.Plans.Routes.myRunning},url:function(){return this.isNew()?this.urlRoot:this.get("id")},validate:function(t){var e=[];return this.isCardinalOrNull(t.distance_in_metres)||e.push("distance_in_metres"),this.isCardinalOrNull(t.time_in_seconds)||e.push("time_in_seconds"),0!=e.length?e:null},isDistanceAndTimeEmpty:function(){var t=this.get("distance_in_metres"),e=this.get("time_in_seconds");return!(null!==t&&void 0!==t||null!==e&&void 0!==e)},isCardinalOrNull:function(t){return void 0===t||null===t||t>0},setPace:function(){var t=null,e=this.get("distance_in_metres"),i=this.get("time_in_seconds");e&&i&&(t=1e3*i/e),this.set({pace_in_seconds_per_km:t},{silent:!0})},toJSON:function(){var t=_.pick(this.attributes,"utf8","authenticity_token"),e=_.reduce(this.attributes,function(t,e,i){return!_.include(["utf8","authenticity_token","id"],i)&&e&&(t[i]=e),t},{});return e.distance_in_metres&&(e.distance_in_metres=Math.round(e.distance_in_metres)),_.extend(t,{run:e})}}),MyASICS.Plans.RunView=Backbone.View.extend({events:{"mouseenter .run-description":"showDescription","mouseleave .run-description":"hideDescription","click .close":"close"},render:function(){return this.form.render(),this},initialize:function(t){this.form=new MyASICS.Runs.RunFormView(_.extend(t,{el:this.el,page:this.options.page})),this.render(),this.$el.removeClass("hidden")},close:function(t){this.form.close(),this.off(),this.remove(),this.deselectCell()},deselectCell:function(){$("table tr td .planData").removeClass("cell-selected")},showDescription:function(){var t=this.$(".description");t.stop(),$.trim(t.text())&&t.slideDown("fast")},hideDescription:function(){this.$(".description").slideUp("fast")}}),MyASICS.Plans.TourView=Backbone.View.extend({events:{"click .tour-tooltip .close":"resetTour","click .tour-tooltip .continue":"showNext","click #take-a-tour":"showNext","click .tour-tooltip .not-now button":"resetTour"},tooltipData:[{targetSelector:".showWeekdays",direction:"top",description:"js.tour.step_1_%{count}_html",continueKey:"js.tour.step_1_continue"},{targetSelector:"#prediction .view",direction:"bottom",description:"js.tour.step_2_%{count}_html",continueKey:"js.tour.step_2_continue"},{direction:"bottom",targetSelector:"#runs-per-week",description:"js.tour.step_3_%{count}_%{days_per_week}_html",descriptionFn:function(){return{days_per_week:$("#runs-per-week input[checked]").val()}},continueKey:"js.tour.step_3_continue"},{direction:"bottom",targetSelector:"#training-intensity",description:"js.tour.step_4_%{count}_html",continueKey:"js.tour.step_4_continue"},{direction:"bottom",targetSelector:"tr.phaseWrap:visible:first",description:"js.tour.step_5_%{count}_%{phases}_%{course}_%{phaseDescription}_html",descriptionFn:function(){return{phases:this.$(".phaseWrap").length,course:this.$(".event .planData").data("title"),phaseDescription:this.$("tr.phaseWrap:first .phaseDescription").text()}},continueKey:"js.tour.step_5_continue"},{direction:"horizontal",targetSelector:"tr:visible .run:first",description:"js.tour.step_6_%{count}_%{run}_%{day}_"+MyASICS.Utils.distanceUnits+"_html",descriptionFn:function(){var t=this.$("tr:visible .run:first");return{day:l_wday(mjd2Date(t.closest("td").data("date"))),run:t.data("title")}},continueKey:"js.tour.step_6_continue"}],initialize:function(){this.template=$("#tour-tooltip").template(),this.layer=$("<div id='tour'></div>").appendTo(this.$el).hide(),this.resetTour()},countTooltips:function(){return this.tooltipNumber(this.tooltipData.length-1)},tooltipNumber:function(t){return _.select(this.tooltipData,function(e,i){return this.$(e.targetSelector).is(":visible")&&t>=i},this).length},resetTour:function(){
"undefined"!=typeof this.tooltip&&null!==this.tooltip&&(this.tooltip.remove(),this.trigger("end")),this.tooltip=null,this.tooltipIndex=0,this.layer.hide()},showNext:function(){if(this.layer.show(),"undefined"!=typeof this.tooltip&&null!==this.tooltip?this.tooltip.fadeOut("normal",function(){$(this).remove()}):this.trigger("start"),this.tooltipIndex>=this.tooltipData.length)return void this.resetTour();var e=this.tooltipData[this.tooltipIndex];if(!this.$(e.targetSelector).is(":visible"))return this.tooltipIndex++,this.showNext();_.isFunction(e.description)?e.content=e.description.call(this):e.content=t(e.description),e.id=this.tooltipIndex;var i={count:t("js.tour.%{number}_of_%{count}_html",{number:this.tooltipNumber(this.tooltipIndex),count:this.countTooltips()})};_.isFunction(e.descriptionFn)&&_.defaults(i,e.descriptionFn.call(this)),e.content=t(e.description,i),this.tooltip=$.tmpl(this.template,e),this.tooltip.find("p:first").addClass("first"),this.tooltip.appendTo(this.layer).fadeIn("normal"),this.offset(this.tooltip,this.$(e.targetSelector),e.direction),this.$(".tour-tooltip p:first").addClass("first"),this.tooltipIndex++},offset:function(t,e,i){if(0==e.length)return t.offset({left:this.$el.offset().left-t.outerWidth()/2+this.$el.outerWidth()/2,top:this.$el.offset().top});if(!i)var i="left";"horizontal"===i&&(i=e.offset().left-t.outerWidth()>e.parent().offset()?"left":"right");var n=$("<div class='arrow'></div>").appendTo(t);"left"===i?(t.offset({left:e.offset().left-t.outerWidth(),top:e.offset().top}),n.addClass("right")):"right"===i?(t.offset({left:e.offset().left+e.outerWidth(),top:e.offset().top}),n.addClass("left")):"top"===i?(t.offset({left:e.offset().left,top:e.offset().top-t.outerHeight()}),n.addClass("bottom")):"bottom"===i&&(t.offset({left:e.offset().left,top:e.offset().top+e.outerHeight()}),n.addClass("top")),scrollTo([t,e],"bottom")},inProgress:function(){return this.$(".tour-tooltip").is(":visible")}}),MyASICS.PublicProfileView=Backbone.View.extend({initialize:function(){this.$(".js-plan-run-tabs").tabs(),null!=this.options.planProgress&&this.$(".js-progress-bar").progressbar({value:this.options.planProgress}),this.checkBioTextNumbers(),this.showOrHideViewAll(),this.hidePersonalBests()},events:{"click .bio_inner .edit":"showUserProfileUpdateView","keyup #bio":"checkBioTextNumbers","click .submit":"validateFormContent","click .view-all":"viewAllPersonalBests","click .invite-friend":"showInviteFriend"},showInviteFriend:function(){$.faceboxContent(this.$(".js-invite-friend").html())},showOrHideViewAll:function(){var t=$(".personal-best-info").length;t>3&&$(".view-all").show()},hidePersonalBests:function(){for(var t=$(".personal-best-info"),e=t.length,i=0;e>i;i++)i>2&&$(t[i]).addClass("hidden")},viewAllPersonalBests:function(){for(var t=$(".personal-best-info.hidden"),e=t.length,i=0;e>i;i++)$(t[i]).removeClass("hidden"),$(".view-all").hide()},showUserProfileUpdateView:function(){$(".bio_inner").hide(),$(".facebook-like").hide(),$(".edit-user-profile").show()},checkBioTextNumbers:function(){var t=$("#bio").val().length;this.setBioCounterColor(t),$(".number").text(t)},validateFormContent:function(t){$("#bio").val().length>100&&t.preventDefault()},setBioCounterColor:function(t){90>t&&t>0?$(".counter").css("color","green"):t>=90&&100>=t?$(".counter").css("color","orange"):0==t?$(".counter").css("color","grey"):$(".counter").css("color","red")}}),MyASICS.Runs.RunFormView=Backbone.View.extend({events:{"change .js-share-run-bar-connected input[type='checkbox']":"setShareRunAttributes","submit form":"save","change .log-run-time input":"setTime","change #form-in-plan-distance":"setDistance","click #add-more-details":"showDropdownBox","click #didnt-do-this":"logARest","change #run_shared_run_attributes_text":"userChangedSharingText"},render:function(){this.updateDistanceTimeAndPace();var t=this.model.isDistanceAndTimeEmpty();return this.$(".error-message").removeClass("time-error").hide(),this.timeIsValid&&this.distanceIsValid&&!t?this.toggleBtn():(this.timeIsValid?this.distanceIsValid?t&&this.$(".error-message").hide().removeClass("time-error"):this.showErrorMsg("distance_in_metres"):this.showErrorMsg("time_in_seconds"),this.toggleBtn(!0)),this},initialize:function(t){var e=/km|mi|m/.exec(t.distance);this.units=e?e[0]:this.$("#run_current_units").val(),this.editRunPath=t.editRunPath,this.distanceIsValid=!0,this.timeIsValid=!0,this.initializeModel(t),this.render(),this.$el.removeClass("hidden"),t.noAutofocus||this.focusOnDistanceOrTime(),this.disableBtnIfDistanceAndTimeEmpty(),this.model.isNew()||(this.sharedRun=t.sharedRun),this.prepareSharedRunArea()&&(this.sharedRunView=new MyASICS.Runs.SharedRunFormView({el:this.$el.find(".js-shared-run-form-view"),page:this.options.page}),this.sharedRunView.render(),this.setShareRunAttributes())},prepareSharedRunArea:function(){if(this.model.isNew()||!this.model.get("hasSharedRun"))return!0;_.templateSettings={interpolate:/\{\{(.+?)\}\}/g};var e=this.sharedRun,i=_.template($("#edit-shared-run-template").html(),{text:e.text,twitterStatus:t("js.shared_run.share_to_twitter"),facebookStatus:t("js.shared_run.share_to_facebook"),weiboStatus:t("js.shared_run.share_to_weibo")});return this.$(".js-shared-run-text-area").html(i).addClass("shared"),this.prepareShareStatus(e.shared_to_facebook,this.$(".facebook-option input[type='checkbox']"),this.$(".js-facebook-status"),t("js.shared_run.shared_on_facebook"),e.facebook_connected,this.$(".js-connect-links .has-facebook-icon-on-link")),this.prepareShareStatus(e.shared_to_twitter,this.$(".twitter-option input[type='checkbox']"),this.$(".js-twitter-status"),t("js.shared_run.shared_on_twitter"),e.twitter_connected,this.$(".js-connect-links .has-twitter-icon-on-link")),this.prepareShareStatus(e.shared_to_weibo,this.$(".weibo-option input[type='checkbox']"),this.$(".js-weibo-status"),t("js.shared_run.shared_on_weibo"),e.weibo_connected,this.$(".js-connect-links .has-weibo-icon-on-link")),"undefined"==typeof e.shared_to_twitter||e.shared_to_twitter||this.$(".js-resharing-notice").show(),this.setShareRunAttributes(),this.$(".js-shared-run-text-area").show(),!1},prepareShareStatus:function(t,e,i,n,a,s){t?(e.attr("disabled",!0),i.html(n).addClass("shared")):a||(e.attr({disabled:!0,checked:!1}),i.html(s.attr("data-run-id",this.model.get("runId"))))},disableBtnIfDistanceAndTimeEmpty:function(){this.model.get("distance_in_metres")||this.model.get("time_in_seconds")||this.toggleBtn(!0)},focusOnDistanceOrTime:function(){var t=this.$("#form-in-plan-distance");t.focus(),t.val()&&this.$(".log-run-time input:first").focus()},close:function(t){this.off(),this.model.off()},initializeModel:function(t){var e={date:this.setDate(t.date)};e.source=this.$("#run_source").val(),"R"!=t.menu&&(e.id=t.updateRunPath,"undefined"!=typeof t.sharedRun&&(e.sharedRunId=t.sharedRun.id),e.runId=t.runId,e.hasSharedRun="object"==typeof t.sharedRun,t.dist&&(e.distance_in_metres=this.distanceInMetres(t.dist,e.units)),t.timeInSeconds&&(e.time_in_seconds=1*t.timeInSeconds),t.loggedPace&&(e.pace_in_seconds_per_km=t.loggedPace)),this.model=new MyASICS.Plans.Run(e),this.model.on("error",this.onError,this),this.model.on("change:distance_in_metres",this.onChangeDistance,this),this.model.on("change:time_in_seconds",this.onChangeTime,this)},onError:function(t,e){_.include(e,"time_in_seconds")&&(this.timeIsValid=!1),_.include(e,"distance_in_metres")&&(this.distanceIsValid=!1)},onChangeDistance:function(t){this.distanceIsValid=!0},onChangeTime:function(t){this.timeIsValid=!0},setDate:function(t){var e=mjd2Date(t);return e=[e.getFullYear(),e.getMonth()+1,e.getDate()].join("-"),this.$("input[name='run[date]']").val(e),e},save:function(t){if(t.preventDefault(),this.isSaveBtnDisabled)return this.showErrorMsg(0==this.timeIsValid?"time_in_seconds":"distance_in_metres"),!1;this.toggleBtn(!0,!0),this.undelegateEvents();var e=this;this.model.save(this.getEncodingAndAuthenticityToken(),{success:function(t,e){t.isNew()&&t.set("id",e.run.link,{silent:!0}),window.location=e._links.web_response.href},error:function(t,i){e.toggleBtn(!1,!0),e.showBackendErrorMsg(i.responseText),e.setElement("#run-form-in-plan")}})},logARest:function(t){this.$("#run_rest").attr("value",!0),this.model.set({rest:!0,rest_reason:"tired",pace:null},{silent:!0}),this.save(t)},metreConversions:{km:1e3,mi:1609.344,m:1},distanceInMetres:function(t,e){return e=e||this.units,null!=t?t*this.metreConversions[e]:null},distanceInUnits:function(t){t=t||this.units;var e=parseFloat((this.model.get("distance_in_metres")/this.metreConversions[t]).toFixed(3));return e?MyASICS.Utils.localizeDecimal(e):null},paceInSecondsPerUnits:function(t){t=t||this.units;var e=this.model.get("pace_in_seconds_per_km");return e?e*this.metreConversions[t]/1e3:null},formattedPace:function(){var t=this.paceInSecondsPerUnits(),e=null;return this.distanceIsValid&&this.timeIsValid&&t&&(e=MyASICS.Utils.ms(t)),e},floatOrNull:function(t){return t=""===$.trim(t)?null:parseFloat(MyASICS.Utils.delocalizeDecimal(t))},setTime:function(){this.timeIsValid=!0;var t=this.$(".log-run-time input"),e=this.floatOrNull(t[0].value),i=this.floatOrNull(t[1].value),n=this.floatOrNull(t[2].value),a=null;(0!=e||null!=n||0!=i&&null!=i)&&(_.any([e,i,n],_.isNumber)&&(a=3600*e+60*i+n),this.model.set({time_in_seconds:a}),this.render())},setDistance:function(t){this.distanceIsValid=!0;var e=this.distanceInMetres(this.floatOrNull(t.currentTarget.value));this.model.set({distance_in_metres:e}),this.render()},toggleBtn:function(t,e){var i=this.$(".button-area button");if(t?(i.addClass("disabled"),this.isSaveBtnDisabled=!0):(i.removeClass("disabled"),this.isSaveBtnDisabled=!1),e){var n=i.find("b").html(),a=i.attr("data-disabled-with");i.find("b").html(a),i.attr("data-disabled-with",n)}},showErrorMsg:function(t){this.$(".error-message").show().toggleClass("time-error","time_in_seconds"==t)},showSharingErrors:function(t){var e=_.chain(t).map(function(e,i){return i.match(/^shared_run\.share_to_.+/)?(delete t[i],e):void 0}).compact().value().join(" ");_.isEmpty(e)||this.$(".shared-run-container .js-backend").html(e).show()},errorsToStrings:function(t){return t=t.run||t||{},_.each(t,function(e,i){"string"==typeof e?t[i]=e:t[i]=e.join(" ")}),t},showBackendErrorMsg:function(t){var e=this.errorsToStrings($.parseJSON(t));this.showSharingErrors(e);var i=_.values(e).join(" ");_.isEmpty(i)||this.$(".js-backend.js-run").html(i).show()},updateDistanceTimeAndPace:function(){this.distanceIsValid&&this.$("#form-in-plan-distance").val(this.distanceInUnits());var t=this.$(".log-run-time input"),e=this.model.get("time_in_seconds");this.timeIsValid&&(e=e?MyASICS.Utils.hmsSplit(e):["","",""],_.each(e,function(e,i){i>0&&_.isNumber(e)&&10>e&&(e="0"+e),$(t[i]).val(e)}));var i=this.formattedPace();this.$(".log-run-pace span b").html(i||"--:--")},getEncodingAndAuthenticityToken:function(){return{utf8:"\u2713",authenticity_token:this.$('input[name$="authenticity_token"]').val()}},sharedRunAttributes:function(){var t=function(t){var e="input[name='run[shared_run_attributes][share_to_"+t+"]']";return this.$(e).is(":checked")?1:0},e={share_to_facebook:t("facebook"),share_to_twitter:t("twitter"),share_to_weibo:t("weibo"),text:this.$("#run_shared_run_attributes_text").val()};return this.sharedRunView&&(e.message_edited=this.sharedRunView.messageEdited),this.model.isNew()||void 0==this.model.get("sharedRunId")||(e.id=this.model.get("sharedRunId")),e},setShareRunAttributes:function(t){this.model.set({shared_run_attributes:this.sharedRunAttributes()},{silent:!0})},userChangedSharingText:function(t){this.setShareRunAttributes()},showDropdownBox:function(t){t.preventDefault();var e=this.editRunPath||$(t.currentTarget).attr("href");$.dropdownboxUrl(e,$(t.currentTarget),this.model.toJSON()),this.hideLogRunForm(),MyASICS.Utils.scrollToTop(),this.deselectCell()},hideLogRunForm:function(t){$("#run-form-in-plan").remove()},deselectCell:function(){$("table tr td .planData").removeClass("cell-selected")}}),MyASICS.Runs.SharedRunFormView=Backbone.View.extend({services:["twitter","facebook","weibo"],events:{"change .js-share-run-bar-connected input[type='checkbox']":"updateEnabledServices","change #run_shared_run_attributes_text":function(){this.markMessageAsEdited(),this.lengthLimitation()},"keydown #run_shared_run_attributes_text":"lengthLimitation"},initialize:function(){this.messageEdited=this.options.messageEdited||!1,this.lengthCounter=this.$("#length-counter"),this.sharingTitle=this.$(".js-sharing-title")},getCheckbox:function(t){return this.$("input[name='run[shared_run_attributes][share_to_"+t+"]'][type='checkbox']")},getConnectButton:function(t){return this.$("a.has-"+t+"-icon")},isChecked:function(t){return this.getCheckbox(t).is(":checked")},isAllChecked:function(){return _.every(this.services,function(t){return this.isChecked(t)},this)},isAllUnchecked:function(){return _.every(this.services,function(t){return!this.isChecked(t)},this)},isUnconnected:function(t){return this.getCheckbox(t).hasClass("js-unconnected")},render:function(){return this.switchMessageContent(),this.updateSharingTitle(),!0},markMessageAsEdited:function(){this.messageEdited=!0},updateEnabledServices:function(t){this.switchMessageContent(),this.updateSharingTitle();var e=this;setTimeout(function(){e.lengthLimitation()},500)},switchMessageContent:function(t){var e=this,i=function(){return _.some(e.services,function(t){return this.isChecked(t)&&this.isUnconnected(t)},e)},n=this.$(".js-shared-run-text-area"),a=this.$(".js-connection-area");this.isAllUnchecked()?(n.slideUp(),a.slideUp()):i()?(a.slideDown(),n.slideUp()):(n.slideDown(),a.slideUp())},updateSharingTitle:function(){if(0==this.sharingTitle.length||this.isAllUnchecked())return!0;var e="";this.isAllChecked()?e=t("js.shared_run.share_to_outside_services"):(this.isChecked("twitter")&&(e=t("js.shared_run.share_to_twitter")),this.isChecked("facebook")&&(e=t("js.shared_run.share_to_facebook")),this.isChecked("weibo")&&(e=t("js.shared_run.share_to_weibo"))),this.sharingTitle.html(e)},lengthLimitation:function(t,e){var i=this.$("#run_shared_run_attributes_text"),n=this.$(".js-connection-area"),a=MyASICS.Runs.lengthLimitation-i.val().length;0>a&&(this.isChecked("twitter")||this.isChecked("weibo"))?(i.closest("form").find("button[type='submit']").attr("disabled",!0),this.lengthCounter.addClass("over-limit")):(i.closest("form").find("button[type='submit']").attr("disabled",!1),this.lengthCounter.removeClass("over-limit")),!this.isChecked("twitter")&&!this.isChecked("weibo")||n.is(":visible")?this.lengthCounter.removeClass("over-limit").hide():this.lengthCounter.html(a).show()}}),MyASICS.widgets={models:{},views:{Comparison:Backbone.View.extend({events:{change:"render"},data:function(){return MyASICS.widgets.views.Comparison.data},initialize:function(){var t=this;this.$("#my-comparison .metrics").each(function(){var e=$(this),i=e.data("domain"),n=t.data().me[i];t.updateMeter(e,n)}),this.$("select option").each(function(){this.value&&!t.data()[this.value]&&$(this).remove()}),this.render()},render:function(){var t=this;this.$("#others-comparison").hide(),this.group()&&(this.$("#others-comparison").show(),this.$("#others-comparison .metrics").each(function(){var e=$(this);e.find("h4").text(t.$("select option:selected").text());var i=e.data("domain"),n=t.group();if(t.data()[n]){var a=t.data()[n][i];t.updateMeter(e,a)}}))},group:function(){return this.$("select").val()},updateMeter:function(e,i){var n=e.find(".meter-needle"),a=e.find(".label");if(i>.95&&1.05>i)var s=t("js.dashboard.perfect");else if("pace"===e.data("domain")){var r=Math.round(100*Math.abs(i-1));if(i)if(1>i)var s=t("js.dashboard.%{percent}_faster_planned_html",{percent:r});else var s=t("js.dashboard.%{percent}_slower_planned_html",{percent:r});else var s=t("js.dashboard.%{percent}_html",{percent:0})}else var o=Math.round(100*i),s=t("js.dashboard.%{percent}_of_planned_html",{percent:o});var l=n.innerWidth()/n.parent().innerWidth()*50;n.css("left",50*i-l+"%"),a.html(s),a.removeClass("left right").addClass(1>i?"left":"right")}})}},MyASICS.CookiesDisclosureView=Backbone.View.extend({events:{"click #accept-cookie":"setCookiesPolicy"},setCookie:function(t,e){document.cookie=t+"="+e+";path=/;expires=Thu, 01 Jan 2099 00:00:00 GMT"},setCookiesPolicy:function(){MyASICS.Utils.cookiesOk=!0,this.setCookie(MyASICS.Utils.CookiesPolicyKey,"true"),this.insertPageTags(),this.trigger("acceptCookies"),this.hideDisclosure()},insertPageTags:function(){var t=$("#page-tags-in-head"),e=$("#page-tags-in-body");t.length>0&&$("head").append(decodeURIComponent(t.text().trim())),e.length>0&&$("body").append(decodeURIComponent(e.text().trim()))},hideDisclosure:function(){this.$el.hide(500),$("header.with-cookie-disclosure").removeClass("with-cookie-disclosure")}}),/*!
 * Cropper v0.11.1
 * https://github.com/fengyuanchen/cropper
 *
 * Copyright (c) 2014-2015 Fengyuan Chen and contributors
 * Released under the MIT license
 *
 * Date: 2015-08-22T04:55:04.780Z
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function e(t){return"number"==typeof t&&!isNaN(t)}function i(t){return"undefined"==typeof t}function n(t,i){var n=[];return e(i)&&n.push(i),n.slice.apply(t,n)}function a(t,e){var i=n(arguments,2);return function(){return t.apply(e,i.concat(n(arguments)))}}function s(t){var e=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return e&&(e[1]!==f.protocol||e[2]!==f.hostname||e[3]!==f.port)}function r(t){var e="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+e}function o(t){var e,i=t.naturalWidth,n=t.naturalHeight;return i||(e=new Image,e.src=t.src,i=e.width,n=e.height),{naturalWidth:i,naturalHeight:n,aspectRatio:i/n}}function l(t){var i=[],n=t.rotate,a=t.scaleX,s=t.scaleY;return e(n)&&i.push("rotate("+n+"deg)"),e(a)&&e(s)&&i.push("scale("+a+","+s+")"),i.length?i.join(" "):"none"}function h(t,e){var i,n,a=at(t.degree)%180,s=(a>90?180-a:a)*Math.PI/180,r=st(s),o=rt(s),l=t.width,h=t.height,c=t.aspectRatio;return e?(i=l/(o+r/c),n=i/c):(i=l*o+h*r,n=l*r+h*o),{width:i,height:n}}function c(i,n){var a,s,r,o=t("<canvas>")[0],l=o.getContext("2d"),c=0,d=0,u=n.naturalWidth,p=n.naturalHeight,f=n.rotate,g=n.scaleX,m=n.scaleY,v=e(g)&&e(m)&&(1!==g||1!==m),y=e(f)&&0!==f,b=y||v,w=u,x=p;return v&&(a=u/2,s=p/2),y&&(r=h({width:u,height:p,degree:f}),w=r.width,x=r.height,a=r.width/2,s=r.height/2),o.width=w,o.height=x,b&&(c=-u/2,d=-p/2,l.save(),l.translate(a,s)),y&&l.rotate(f*Math.PI/180),v&&l.scale(g,m),l.drawImage(i,c,d,u,p),b&&l.restore(),o}function d(e,i){this.$element=t(e),this.options=t.extend({},d.DEFAULTS,t.isPlainObject(i)&&i),this.ready=!1,this.built=!1,this.complete=!1,this.rotated=!1,this.cropped=!1,this.disabled=!1,this.replaced=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var u=t(window),p=t(document),f=window.location,g="cropper",m="preview."+g,v="cropper-modal",y="cropper-hide",b="cropper-hidden",w="cropper-invisible",x="cropper-move",$="cropper-crop",_="cropper-disabled",C="cropper-bg",k="mousedown touchstart pointerdown MSPointerDown",S="mousemove touchmove pointermove MSPointerMove",M="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",D="wheel mousewheel DOMMouseScroll",T="dblclick",I="load."+g,P="error."+g,A="resize."+g,R="build."+g,j="built."+g,B="cropstart."+g,E="cropmove."+g,F="cropend."+g,V="crop."+g,L="zoom."+g,N=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,O="e",W="w",z="s",H="n",U="se",G="sw",q="ne",Y="nw",X="all",Z="crop",Q="move",K="zoom",J="none",tt=t.isFunction(t("<canvas>")[0].getContext),et=Math.sqrt,it=Math.min,nt=Math.max,at=Math.abs,st=Math.sin,rt=Math.cos,ot=parseFloat,lt={};t.extend(lt,{init:function(){var t,e=this.$element;if(e.is("img")){if(this.isImg=!0,this.originalUrl=t=e.attr("src"),!t)return;t=e.prop("src")}else e.is("canvas")&&tt&&(t=e[0].toDataURL());this.load(t)},trigger:function(e,i){var n=t.Event(e,i);return this.$element.trigger(n),n.isDefaultPrevented()},load:function(e){var i,n,a=this.options,o=this.$element,l="";e&&(this.url=e,o.one(R,a.build),this.trigger(R)||(a.checkImageOrigin&&s(e)&&(l=' crossOrigin="anonymous"',o.prop("crossOrigin")||(i=r(e))),this.$clone=n=t("<img"+l+' src="'+(i||e)+'">'),this.isImg?o[0].complete?this.start():o.one(I,t.proxy(this.start,this)):n.one(I,t.proxy(this.start,this)).one(P,t.proxy(this.stop,this)).addClass(y).insertAfter(o)))},start:function(){this.image=o(this.isImg?this.$element[0]:this.$clone[0]),this.ready=!0,this.build()},stop:function(){this.$clone.remove(),this.$clone=null}}),t.extend(lt,{build:function(){var e,i,n,a=this.options,s=this.$element,r=this.$clone;this.ready&&(this.built&&this.unbuild(),this.$container=s.parent(),this.$cropper=e=t(d.TEMPLATE),this.$canvas=e.find(".cropper-canvas").append(r),this.$dragBox=e.find(".cropper-drag-box"),this.$cropBox=i=e.find(".cropper-crop-box"),this.$viewBox=e.find(".cropper-view-box"),this.$face=n=i.find(".cropper-face"),s.addClass(b).after(e),this.isImg||r.removeClass(y),this.initPreview(),this.bind(),a.aspectRatio=ot(a.aspectRatio)||NaN,a.autoCrop?(this.cropped=!0,a.modal&&this.$dragBox.addClass(v)):i.addClass(b),a.guides||i.find(".cropper-dashed").addClass(b),a.center||i.find(".cropper-center").addClass(b),a.cropBoxMovable&&n.addClass(x).data("action",X),a.highlight||n.addClass(w),a.background&&e.addClass(C),a.cropBoxResizable||i.find(".cropper-line, .cropper-point").addClass(b),this.setDragMode(a.dragCrop?Z:a.movable?Q:J),this.render(),this.built=!0,this.setData(a.data),s.one(j,a.built),setTimeout(t.proxy(function(){this.trigger(j),this.complete=!0},this),0))},unbuild:function(){this.built&&(this.built=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)}}),t.extend(lt,{render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.options,e=this.$element,i=this.$container,n=this.$cropper;n.addClass(b),e.removeClass(b),n.css(this.container={width:nt(i.width(),ot(t.minContainerWidth)||200),height:nt(i.height(),ot(t.minContainerHeight)||100)}),e.addClass(b),n.removeClass(b)},initCanvas:function(){var e=this.container,i=e.width,n=e.height,a=this.image,s=a.aspectRatio,r={aspectRatio:s,width:i,height:n};n*s>i?r.height=i/s:r.width=n*s,r.oldLeft=r.left=(i-r.width)/2,r.oldTop=r.top=(n-r.height)/2,this.canvas=r,this.limitCanvas(!0,!0),this.initialImage=t.extend({},a),this.initialCanvas=t.extend({},r)},limitCanvas:function(e,i){var n,a,s=this.options,r=s.strict,o=this.container,l=o.width,h=o.height,c=this.canvas,d=c.aspectRatio,u=this.cropBox,p=this.cropped&&u,f=this.initialCanvas||c,g=f.width,m=f.height;e&&(n=ot(s.minCanvasWidth)||0,a=ot(s.minCanvasHeight)||0,n?(r&&(n=nt(p?u.width:g,n)),a=n/d):a?(r&&(a=nt(p?u.height:m,a)),n=a*d):r&&(p?(n=u.width,a=u.height,a*d>n?n=a*d:a=n/d):(n=g,a=m)),t.extend(c,{minWidth:n,minHeight:a,maxWidth:1/0,maxHeight:1/0})),i&&(r?p?(c.minLeft=it(u.left,u.left+u.width-c.width),c.minTop=it(u.top,u.top+u.height-c.height),c.maxLeft=u.left,c.maxTop=u.top):(c.minLeft=it(0,l-c.width),c.minTop=it(0,h-c.height),c.maxLeft=nt(0,l-c.width),c.maxTop=nt(0,h-c.height)):(c.minLeft=-c.width,c.minTop=-c.height,c.maxLeft=l,c.maxTop=h))},renderCanvas:function(t){var e,i,n=this.options,a=this.canvas,s=this.image;this.rotated&&(this.rotated=!1,i=h({width:s.width,height:s.height,degree:s.rotate}),e=i.width/i.height,e!==a.aspectRatio&&(a.left-=(i.width-a.width)/2,a.top-=(i.height-a.height)/2,a.width=i.width,a.height=i.height,a.aspectRatio=e,this.limitCanvas(!0,!1))),(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=it(nt(a.width,a.minWidth),a.maxWidth),a.height=it(nt(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.oldLeft=a.left=it(nt(a.left,a.minLeft),a.maxLeft),a.oldTop=a.top=it(nt(a.top,a.minTop),a.maxTop),this.$canvas.css({width:a.width,height:a.height,left:a.left,top:a.top}),this.renderImage(),this.cropped&&n.strict&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(e){var i,n=this.canvas,a=this.image;a.rotate&&(i=h({width:n.width,height:n.height,degree:a.rotate,aspectRatio:a.aspectRatio},!0)),t.extend(a,i?{width:i.width,height:i.height,left:(n.width-i.width)/2,top:(n.height-i.height)/2}:{width:n.width,height:n.height,left:0,top:0}),this.$clone.css({width:a.width,height:a.height,marginLeft:a.left,marginTop:a.top,transform:l(a)}),e&&this.output()},initCropBox:function(){var e=this.options,i=this.canvas,n=e.aspectRatio,a=ot(e.autoCropArea)||.8,s={width:i.width,height:i.height};n&&(i.height*n>i.width?s.height=s.width/n:s.width=s.height*n),this.cropBox=s,this.limitCropBox(!0,!0),s.width=it(nt(s.width,s.minWidth),s.maxWidth),s.height=it(nt(s.height,s.minHeight),s.maxHeight),s.width=nt(s.minWidth,s.width*a),s.height=nt(s.minHeight,s.height*a),s.oldLeft=s.left=i.left+(i.width-s.width)/2,s.oldTop=s.top=i.top+(i.height-s.height)/2,this.initialCropBox=t.extend({},s)},limitCropBox:function(t,e){var i,n,a=this.options,s=a.strict,r=this.container,o=r.width,l=r.height,h=this.canvas,c=this.cropBox,d=a.aspectRatio;t&&(i=ot(a.minCropBoxWidth)||0,n=ot(a.minCropBoxHeight)||0,c.minWidth=it(o,i),c.minHeight=it(l,n),c.maxWidth=it(o,s?h.width:o),c.maxHeight=it(l,s?h.height:l),d&&(c.maxHeight*d>c.maxWidth?(c.minHeight=c.minWidth/d,c.maxHeight=c.maxWidth/d):(c.minWidth=c.minHeight*d,c.maxWidth=c.maxHeight*d)),c.minWidth=it(c.maxWidth,c.minWidth),c.minHeight=it(c.maxHeight,c.minHeight)),e&&(s?(c.minLeft=nt(0,h.left),c.minTop=nt(0,h.top),c.maxLeft=it(o,h.left+h.width)-c.width,c.maxTop=it(l,h.top+h.height)-c.height):(c.minLeft=0,c.minTop=0,c.maxLeft=o-c.width,c.maxTop=l-c.height))},renderCropBox:function(){var t=this.options,e=this.container,i=e.width,n=e.height,a=this.cropBox;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=it(nt(a.width,a.minWidth),a.maxWidth),a.height=it(nt(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.oldLeft=a.left=it(nt(a.left,a.minLeft),a.maxLeft),a.oldTop=a.top=it(nt(a.top,a.minTop),a.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data("action",a.width===i&&a.height===n?Q:X),this.$cropBox.css({width:a.width,height:a.height,left:a.left,top:a.top}),this.cropped&&t.strict&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),this.complete?this.trigger(V,this.getData()):this.built||this.$element.one(j,t.proxy(function(){this.trigger(V,this.getData())},this))}}),t.extend(lt,{initPreview:function(){var e=this.url;this.$preview=t(this.options.preview),this.$viewBox.html('<img src="'+e+'">'),this.$preview.each(function(){var i=t(this);i.data(m,{width:i.width(),height:i.height(),original:i.html()}),i.html('<img src="'+e+'" style="display:block;width:100%;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important">')})},resetPreview:function(){this.$preview.each(function(){var e=t(this);e.html(e.data(m).original).removeData(m)})},preview:function(){var e=this.image,i=this.canvas,n=this.cropBox,a=e.width,s=e.height,r=n.left-i.left-e.left,o=n.top-i.top-e.top;this.cropped&&!this.disabled&&(this.$viewBox.find("img").css({width:a,height:s,marginLeft:-r,marginTop:-o,transform:l(e)}),this.$preview.each(function(){var i=t(this),h=i.data(m),c=h.width/n.width,d=h.width,u=n.height*c;u>h.height&&(c=h.height/n.height,d=n.width*c,u=h.height),i.width(d).height(u).find("img").css({width:a*c,height:s*c,marginLeft:-r*c,marginTop:-o*c,transform:l(e)})}))}}),t.extend(lt,{bind:function(){var e=this.options,i=this.$element,n=this.$cropper;t.isFunction(e.cropstart)&&i.on(B,e.cropstart),t.isFunction(e.cropmove)&&i.on(E,e.cropmove),t.isFunction(e.cropend)&&i.on(F,e.cropend),t.isFunction(e.crop)&&i.on(V,e.crop),t.isFunction(e.zoom)&&i.on(L,e.zoom),n.on(k,t.proxy(this.cropStart,this)),e.zoomable&&e.mouseWheelZoom&&n.on(D,t.proxy(this.wheel,this)),e.doubleClickToggle&&n.on(T,t.proxy(this.dblclick,this)),p.on(S,this._cropMove=a(this.cropMove,this)).on(M,this._cropEnd=a(this.cropEnd,this)),e.responsive&&u.on(A,this._resize=a(this.resize,this))},unbind:function(){var e=this.options,i=this.$element,n=this.$cropper;t.isFunction(e.cropstart)&&i.off(B,e.cropstart),t.isFunction(e.cropmove)&&i.off(E,e.cropmove),t.isFunction(e.cropend)&&i.off(F,e.cropend),t.isFunction(e.crop)&&i.off(V,e.crop),t.isFunction(e.zoom)&&i.off(L,e.zoom),n.off(k,this.cropStart),e.zoomable&&e.mouseWheelZoom&&n.off(D,this.wheel),e.doubleClickToggle&&n.off(T,this.dblclick),p.off(S,this._cropMove).off(M,this._cropEnd),e.responsive&&u.off(A,this._resize)}}),t.extend(lt,{resize:function(){var e,i,n,a=this.$container,s=this.container;!this.disabled&&s&&(n=a.width()/s.width,(1!==n||a.height()!==s.height)&&(e=this.getCanvasData(),i=this.getCropBoxData(),this.render(),this.setCanvasData(t.each(e,function(t,i){e[t]=i*n})),this.setCropBoxData(t.each(i,function(t,e){i[t]=e*n}))))},dblclick:function(){this.disabled||this.setDragMode(this.$dragBox.hasClass($)?Q:Z)},wheel:function(t){var e=t.originalEvent,i=e,n=ot(this.options.wheelZoomRatio)||.1,a=1;this.disabled||(t.preventDefault(),i.deltaY?a=i.deltaY>0?1:-1:i.wheelDelta?a=-i.wheelDelta/120:i.detail&&(a=i.detail>0?1:-1),this.zoom(-a*n,e))},cropStart:function(e){var i,n,a=this.options,s=e.originalEvent,r=s&&s.touches,o=e;if(!this.disabled){if(r){if(i=r.length,i>1){if(!a.zoomable||!a.touchDragZoom||2!==i)return;o=r[1],this.startX2=o.pageX,this.startY2=o.pageY,n=K}o=r[0]}if(n=n||t(o.target).data("action"),N.test(n)){if(this.trigger(B,{originalEvent:s,action:n}))return;e.preventDefault(),this.action=n,this.cropping=!1,this.startX=o.pageX||s&&s.pageX,this.startY=o.pageY||s&&s.pageY,n===Z&&(this.cropping=!0,this.$dragBox.addClass(v))}}},cropMove:function(t){var e,i=this.options,n=t.originalEvent,a=n&&n.touches,s=t,r=this.action;if(!this.disabled){if(a){if(e=a.length,e>1){if(!i.zoomable||!i.touchDragZoom||2!==e)return;s=a[1],this.endX2=s.pageX,this.endY2=s.pageY}s=a[0]}if(r){if(this.trigger(E,{originalEvent:n,action:r}))return;t.preventDefault(),this.endX=s.pageX||n&&n.pageX,this.endY=s.pageY||n&&n.pageY,this.change(s.shiftKey,r===K?n:null)}}},cropEnd:function(t){var e=t.originalEvent,i=this.action;this.disabled||i&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(v,this.cropped&&this.options.modal)),this.action="",this.trigger(F,{originalEvent:e,action:i}))}}),t.extend(lt,{change:function(t,e){var i,n,a=this.options,s=a.aspectRatio,r=this.action,o=this.container,l=this.canvas,h=this.cropBox,c=h.width,d=h.height,u=h.left,p=h.top,f=u+c,g=p+d,m=0,v=0,y=o.width,w=o.height,x=!0;switch(!s&&t&&(s=c&&d?c/d:1),a.strict&&(m=h.minLeft,v=h.minTop,y=m+it(o.width,l.width),w=v+it(o.height,l.height)),n={x:this.endX-this.startX,y:this.endY-this.startY},s&&(n.X=n.y*s,n.Y=n.x/s),r){case X:u+=n.x,p+=n.y;break;case O:if(n.x>=0&&(f>=y||s&&(v>=p||g>=w))){x=!1;break}c+=n.x,s&&(d=c/s,p-=n.Y/2),0>c&&(r=W,c=0);break;case H:if(n.y<=0&&(v>=p||s&&(m>=u||f>=y))){x=!1;break}d-=n.y,p+=n.y,s&&(c=d*s,u+=n.X/2),0>d&&(r=z,d=0);break;case W:if(n.x<=0&&(m>=u||s&&(v>=p||g>=w))){x=!1;break}c-=n.x,u+=n.x,s&&(d=c/s,p+=n.Y/2),0>c&&(r=O,c=0);break;case z:if(n.y>=0&&(g>=w||s&&(m>=u||f>=y))){x=!1;break}d+=n.y,s&&(c=d*s,u-=n.X/2),0>d&&(r=H,d=0);break;case q:if(s){if(n.y<=0&&(v>=p||f>=y)){x=!1;break}d-=n.y,p+=n.y,c=d*s}else n.x>=0?y>f?c+=n.x:n.y<=0&&v>=p&&(x=!1):c+=n.x,n.y<=0?p>v&&(d-=n.y,p+=n.y):(d-=n.y,p+=n.y);0>c&&0>d?(r=G,d=0,c=0):0>c?(r=Y,c=0):0>d&&(r=U,d=0);break;case Y:if(s){if(n.y<=0&&(v>=p||m>=u)){x=!1;break}d-=n.y,p+=n.y,c=d*s,u+=n.X}else n.x<=0?u>m?(c-=n.x,u+=n.x):n.y<=0&&v>=p&&(x=!1):(c-=n.x,u+=n.x),n.y<=0?p>v&&(d-=n.y,p+=n.y):(d-=n.y,p+=n.y);0>c&&0>d?(r=U,d=0,c=0):0>c?(r=q,c=0):0>d&&(r=G,d=0);break;case G:if(s){if(n.x<=0&&(m>=u||g>=w)){x=!1;break}c-=n.x,u+=n.x,d=c/s}else n.x<=0?u>m?(c-=n.x,u+=n.x):n.y>=0&&g>=w&&(x=!1):(c-=n.x,u+=n.x),n.y>=0?w>g&&(d+=n.y):d+=n.y;0>c&&0>d?(r=q,d=0,c=0):0>c?(r=U,c=0):0>d&&(r=Y,d=0);break;case U:if(s){if(n.x>=0&&(f>=y||g>=w)){x=!1;break}c+=n.x,d=c/s}else n.x>=0?y>f?c+=n.x:n.y>=0&&g>=w&&(x=!1):c+=n.x,n.y>=0?w>g&&(d+=n.y):d+=n.y;0>c&&0>d?(r=Y,d=0,c=0):0>c?(r=G,c=0):0>d&&(r=q,d=0);break;case Q:l.left+=n.x,l.top+=n.y,this.renderCanvas(!0),x=!1;break;case K:this.zoom(function(t,e,i,n){var a=et(t*t+e*e),s=et(i*i+n*n);return(s-a)/a}(at(this.startX-this.startX2),at(this.startY-this.startY2),at(this.endX-this.endX2),at(this.endY-this.endY2)),e),this.startX2=this.endX2,this.startY2=this.endY2,x=!1;break;case Z:n.x&&n.y&&(i=this.$cropper.offset(),u=this.startX-i.left,p=this.startY-i.top,c=h.minWidth,d=h.minHeight,n.x>0?n.y>0?r=U:(r=q,p-=d):n.y>0?(r=G,u-=c):(r=Y,u-=c,p-=d),this.cropped||(this.cropped=!0,this.$cropBox.removeClass(b)))}x&&(h.width=c,h.height=d,h.left=u,h.top=p,this.action=r,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY}}),t.extend(lt,{crop:function(){this.built&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(v),this.$cropBox.removeClass(b)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.built&&!this.disabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.cropped&&this.renderCropBox())},clear:function(){this.cropped&&!this.disabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(),this.renderCanvas(),this.$dragBox.removeClass(v),this.$cropBox.addClass(b))},replace:function(t){!this.disabled&&t&&(this.isImg&&this.$element.attr("src",t),this.options.data=null,this.load(t))},enable:function(){this.built&&(this.disabled=!1,this.$cropper.removeClass(_))},disable:function(){this.built&&(this.disabled=!0,this.$cropper.addClass(_))},destroy:function(){var t=this.$element;this.ready?(this.isImg&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass(b)):this.isImg?t.off(I,this.start):this.$clone&&this.$clone.remove(),t.removeData(g)},move:function(t,n){var a=this.canvas;i(n)&&(n=t),t=ot(t),n=ot(n),this.built&&!this.disabled&&this.options.movable&&(a.left+=e(t)?t:0,a.top+=e(n)?n:0,this.renderCanvas(!0))},zoom:function(t,e){var i,n,a=this.canvas;if(t=ot(t),t&&this.built&&!this.disabled&&this.options.zoomable){if(this.trigger(L,{originalEvent:e,ratio:t}))return;t=0>t?1/(1-t):1+t,i=a.width*t,n=a.height*t,a.left-=(i-a.width)/2,a.top-=(n-a.height)/2,a.width=i,a.height=n,this.renderCanvas(!0),this.setDragMode(Q)}},rotate:function(t){var e=this.image,i=e.rotate||0;t=ot(t)||0,this.built&&!this.disabled&&this.options.rotatable&&(e.rotate=(i+t)%360,this.rotated=!0,this.renderCanvas(!0))},scale:function(t,n){var a=this.image;i(n)&&(n=t),t=ot(t),n=ot(n),this.built&&!this.disabled&&this.options.scalable&&(a.scaleX=e(t)?t:1,a.scaleY=e(n)?n:1,this.renderImage(!0))},getData:function(e){var i,n,a=this.options,s=this.image,r=this.canvas,o=this.cropBox;return this.built&&this.cropped?(n={x:o.left-r.left,y:o.top-r.top,width:o.width,height:o.height},i=s.width/s.naturalWidth,t.each(n,function(t,a){a/=i,n[t]=e?Math.round(a):a})):n={x:0,y:0,width:0,height:0},a.rotatable&&(n.rotate=s.rotate||0),a.scalable&&(n.scaleX=s.scaleX||1,n.scaleY=s.scaleY||1),n},setData:function(i){var n,a=this.image,s=this.canvas,r={};t.isFunction(i)&&(i=i.call(this.$element)),this.built&&!this.disabled&&t.isPlainObject(i)&&(e(i.rotate)&&i.rotate!==a.rotate&&this.options.rotatable&&(a.rotate=i.rotate,this.rotated=!0,this.renderCanvas(!0)),n=a.width/a.naturalWidth,e(i.x)&&(r.left=i.x*n+s.left),e(i.y)&&(r.top=i.y*n+s.top),e(i.width)&&(r.width=i.width*n),e(i.height)&&(r.height=i.height*n),this.setCropBoxData(r))},getContainerData:function(){return this.built?this.container:{}},getImageData:function(){return this.ready?this.image:{}},getCanvasData:function(){var t,e=this.canvas;return this.built&&(t={left:e.left,top:e.top,width:e.width,height:e.height}),t||{}},setCanvasData:function(i){var n=this.canvas,a=n.aspectRatio;t.isFunction(i)&&(i=i.call(this.$element)),this.built&&!this.disabled&&t.isPlainObject(i)&&(e(i.left)&&(n.left=i.left),e(i.top)&&(n.top=i.top),e(i.width)?(n.width=i.width,n.height=i.width/a):e(i.height)&&(n.height=i.height,n.width=i.height*a),this.renderCanvas(!0))},getCropBoxData:function(){var t,e=this.cropBox;return this.built&&this.cropped&&(t={left:e.left,top:e.top,width:e.width,height:e.height}),t||{}},setCropBoxData:function(i){var n,a,s=this.cropBox,r=this.options.aspectRatio;t.isFunction(i)&&(i=i.call(this.$element)),this.built&&this.cropped&&!this.disabled&&t.isPlainObject(i)&&(e(i.left)&&(s.left=i.left),e(i.top)&&(s.top=i.top),e(i.width)&&i.width!==s.width&&(n=!0,s.width=i.width),e(i.height)&&i.height!==s.height&&(a=!0,s.height=i.height),r&&(n?s.height=s.width/r:a&&(s.width=s.height*r)),this.renderCropBox())},getCroppedCanvas:function(e){var i,n,a,s,r,o,l,h,d,u,p;return this.built&&this.cropped&&tt?(t.isPlainObject(e)||(e={}),p=this.getData(),i=p.width,n=p.height,h=i/n,t.isPlainObject(e)&&(r=e.width,o=e.height,r?(o=r/h,l=r/i):o&&(r=o*h,l=o/n)),a=r||i,s=o||n,d=t("<canvas>")[0],d.width=a,d.height=s,u=d.getContext("2d"),e.fillColor&&(u.fillStyle=e.fillColor,u.fillRect(0,0,a,s)),u.drawImage.apply(u,function(){var t,e,a,s,r,o,h=c(this.$clone[0],this.image),d=h.width,u=h.height,f=[h],g=p.x,m=p.y;return-i>=g||g>d?g=t=a=r=0:0>=g?(a=-g,g=0,t=r=it(d,i+g)):d>=g&&(a=0,t=r=it(i,d-g)),0>=t||-n>=m||m>u?m=e=s=o=0:0>=m?(s=-m,m=0,e=o=it(u,n+m)):u>=m&&(s=0,e=o=it(n,u-m)),f.push(g,m,t,e),l&&(a*=l,s*=l,r*=l,o*=l),r>0&&o>0&&f.push(a,s,r,o),f}.call(this)),d):void 0},setAspectRatio:function(t){var e=this.options;this.disabled||i(t)||(e.aspectRatio=ot(t)||NaN,this.built&&(this.initCropBox(),this.cropped&&this.renderCropBox()))},setDragMode:function(t){var e,i,n=this.options;this.ready&&!this.disabled&&(e=n.dragCrop&&t===Z,i=n.movable&&t===Q,t=e||i?t:J,this.$dragBox.data("action",t).toggleClass($,e).toggleClass(x,i),n.cropBoxMovable||this.$face.data("action",t).toggleClass($,e).toggleClass(x,i))}}),t.extend(d.prototype,lt),d.DEFAULTS={aspectRatio:NaN,data:null,preview:"",strict:!0,responsive:!0,checkImageOrigin:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,dragCrop:!0,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,mouseWheelZoom:!0,wheelZoomRatio:.1,touchDragZoom:!0,cropBoxMovable:!0,cropBoxResizable:!0,doubleClickToggle:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},d.setDefaults=function(e){t.extend(d.DEFAULTS,e)},d.TEMPLATE='<div class="cropper-container"><div class="cropper-canvas"></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',d.other=t.fn.cropper,t.fn.cropper=function(e){var a,s=n(arguments,1);return this.each(function(){var i,n=t(this),r=n.data(g);if(!r){if(/destroy/.test(e))return;n.data(g,r=new d(this,e))}"string"==typeof e&&t.isFunction(i=r[e])&&(a=i.apply(r,s))}),i(a)?this:a},t.fn.cropper.Constructor=d,t.fn.cropper.setDefaults=d.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=d.other,this}}),MyASICS.RouteMaps=new function(){function t(t){var e=t.segments();if(0==e.length)return"";var i=[].concat(e[0].waypoints),n=_(e).chain().rest().pluck("waypoints").map(function(t){return _(t).rest()}).flatten().value();return i=i.concat(n),i.map(function(t){return[t.lat,t.lng].join(",")}).join(";")}this.makeMap=function(t,e){this.routeView=MyASICS.MapAdapter.RouteMapView(null,t);var i=new MyASICS.RouteMaps.Route(this.deserializeRoute(e.waypoints));return i.retrace=e.retrace,this.routeView.route=i,this.routeView},this.serializeRoute=t,this.deserializeRoute=function(t){t=t.replace(/;{3,}/g,";;").replace(/;+$/,"");var e=_.map(t.split(";;"),function(t,e){return t=_.map(t.split(";"),function(t){var e=t.split(",");return{lat:parseFloat(e[0]),lng:parseFloat(e[1]),distance:NaN}}),{waypoints:t}}),i=0;return _(e).each(function(t){i=this.routeView.updateRouteSegmentDistances(t,i)}.bind(this)),{segments:e}}},MyASICS.RouteMaps.Route=function(t){function e(t){this._route=t}return e.prototype.firstWaypoint=function(){var t=this._route.segments[0];return t&&t.waypoints[0]},e.prototype.lastWaypoint=function(){if(this._route.segments&&this._route.segments.length>0){var t=_.last(this._route.segments);return _.last(t.waypoints)}},e.prototype.addSegment=function(t){this._route.segments.push({waypoints:t})},e.prototype.segments=function(){return this._route.segments},e.prototype.removeLastSegment=function(){return this._route.segments.pop()},e.prototype.removeAllSegments=function(){this._route.segments=[]},e.prototype.length=function(){var t=this.lastWaypoint();return"undefined"!=typeof t?t.distance:NaN},e.prototype.isLoop=function(){var t=this.firstWaypoint(),e=this.lastWaypoint();return t&&e&&t.lat==e.lat&&t.lng==e.lng},e}(MyASICS.RouteMaps),MyASICS.MapAdapter={RouteEditor:function(t,e,i){var n,a=MyASICS.Map.currentMap||MyASICS.Map.defaultMap;switch(a){case MyASICS.Map.googleMap:n=new MyASICS.RouteMaps.GoogleRouteEditor({el:t,location:e,detectLocation:i});break;case MyASICS.Map.baiduMap:n=new MyASICS.RouteMaps.BaiduRouteEditor({el:t,location:e,detectLocation:i})}return n},RouteMapView:function(t,e){var i,n=MyASICS.Map.currentMap||MyASICS.Map.defaultMap;switch(n){case MyASICS.Map.googleMap:i=new MyASICS.RouteMaps.GoogleRouteMapView(t,e);break;case MyASICS.Map.baiduMap:i=new MyASICS.RouteMaps.BaiduRouteMapView(t,e)}return i}},function(t){t.fn.serializeObject=function(){var e=this,i={},n={},a={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};return this.build=function(t,e,i){return t[e]=i,t},this.push_counter=function(t){return void 0===n[t]&&(n[t]=0),n[t]++},t.each(t(this).serializeArray(),function(){if(a.validate.test(this.name)){for(var n,s=this.name.match(a.key),r=this.value,o=this.name;void 0!==(n=s.pop());)o=o.replace(new RegExp("\\["+n+"\\]$"),""),n.match(a.push)?r=e.build([],e.push_counter(o),r):n.match(a.fixed)?r=e.build([],n,r):n.match(a.named)&&(r=e.build({},n,r));i=t.extend(!0,i,r)}}),i}}(jQuery);